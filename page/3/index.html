<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"reoger.tk","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="reoger">
<meta property="og:type" content="website">
<meta property="og:title" content="reoger的记录">
<meta property="og:url" content="http://reoger.tk/page/3/index.html">
<meta property="og:site_name" content="reoger的记录">
<meta property="og:description" content="reoger">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="reoger">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://reoger.tk/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>reoger的记录</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">reoger的记录</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">--以后的你会感激现在那么努力的自己</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/04/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87%E5%B9%B6%E6%B7%BB%E5%8A%A0%E8%BE%B9%E6%A1%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/04/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87%E5%B9%B6%E6%B7%BB%E5%8A%A0%E8%BE%B9%E6%A1%86/" class="post-title-link" itemprop="url">自定义View之将图片显示圆形图片并添加边框</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-04 16:44:55" itemprop="dateCreated datePublished" datetime="2018-08-04T16:44:55+08:00">2018-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:11:36" itemprop="dateModified" datetime="2020-04-12T23:11:36+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h1><p><img src="http://ovec6nnof.bkt.clouddn.com/image1.png" alt="效果预览"></p>
<p>本次的图片效果是基于上一篇博客的三种方法进行扩展实现图片的外边框效果。上一篇博客的<a href="https://blog.csdn.net/Reoger/article/details/81394579" target="_blank" rel="noopener">传送门</a>。<br>下面开始进行到整体，针对上次实现圆形图片的三个方式添加一个外边框效果。</p>
<h1 id="使用PorterDuffXfermode方式来实现"><a href="#使用PorterDuffXfermode方式来实现" class="headerlink" title="使用PorterDuffXfermode方式来实现"></a>使用PorterDuffXfermode方式来实现</h1><p>我们使用这个方式实现圆形图片的原理是通过图片的设置图片的叠加显示效果。还是这张图：<br><img src="https://upload-images.jianshu.io/upload_images/2041548-d964105abf4be5d9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/312" alt="官方的说明图"></p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>实现圆形图片，我们只需要绘制一个圆，并将模式设置为<code>SRC_IN</code>即可。但是我们需要在外围添加一个边框的话，就不会那么简单了。我们需要绘制三次图片，通过合理的设置他们的<code>Xfermode</code>模式来达到我们的要求。具体步骤为：</p>
<ol>
<li>将原图片绘制出来(如果有需要，进行必要的比例缩放处理，使其是一个正方形)</li>
<li>绘制一个等大的正方形，颜色为边框要显示的颜色。(这一步的目的是为了将外围的边框也绘制出来)</li>
<li>绘制一个半径为二分之一边长减去边框长度的圆，模式为<code>DST_OUT</code></li>
<li>绘制一个半径为二分之一边长的圆，模式为<code>DST_IN</code><br>通过上面四步，基本就实现了我们想要的外边框的效果。<br>用图表示为：<br><img src="http://ovec6nnof.bkt.clouddn.com/%E6%BC%94%E7%A4%BA%E6%96%87%E7%A8%BF1.png" alt=""><br>具体细节可以参考代码实现。<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2>自定义view<code>CircleImageView1</code>的代码如下。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView1 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    public static final int DEFAULT_BORDER_WIDTH &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private Paint mBorderPaint;</span><br><span class="line">    private Shape mShape;</span><br><span class="line">    private Shape mBorderShape;</span><br><span class="line">    private float mRadius;</span><br><span class="line">    private float mBorderWidth;</span><br><span class="line">    private int mBorderColor;</span><br><span class="line">    private PorterDuffXfermode mBorderDuffMode;</span><br><span class="line">    private Bitmap mBorderBitmap;</span><br><span class="line"></span><br><span class="line">    private float[] outerRadii &#x3D; new float[8];</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(AttributeSet attrs) &#123;</span><br><span class="line">        if (attrs !&#x3D; null) &#123;</span><br><span class="line">            TypedArray a &#x3D; getContext().obtainStyledAttributes(attrs, R.styleable.CircleImageView1);</span><br><span class="line">            mBorderWidth &#x3D; a.getDimensionPixelSize(R.styleable.CircleImageView1_circle_border_width1, DEFAULT_BORDER_WIDTH);</span><br><span class="line">            mBorderColor &#x3D; a.getInt(R.styleable.CircleImageView1_circle_border_color1, Color.BLACK);</span><br><span class="line">            a.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">        setLayerType(LAYER_TYPE_HARDWARE, null);</span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setColor(Color.BLACK);</span><br><span class="line">        mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.DST_IN));</span><br><span class="line"></span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH) &#123;</span><br><span class="line">            mBorderPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">            mBorderPaint.setColor(mBorderColor);</span><br><span class="line">            mBorderPaint.setFilterBitmap(true);</span><br><span class="line">            mBorderDuffMode &#x3D; new PorterDuffXfermode(PorterDuff.Mode.DST_OUT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int width &#x3D; getMeasuredWidth();</span><br><span class="line">        int height &#x3D; getMeasuredHeight();</span><br><span class="line">        int min &#x3D; Math.min(width, height);</span><br><span class="line">        mRadius &#x3D; min &#x2F; 2;</span><br><span class="line">        setMeasuredDimension(min, min);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">        super.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        if (changed) &#123;</span><br><span class="line">            if (mShape &#x3D;&#x3D; null) &#123;</span><br><span class="line">                Arrays.fill(outerRadii, mRadius);</span><br><span class="line">                mShape &#x3D; new RoundRectShape(outerRadii, null, null);</span><br><span class="line">                if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH &amp;&amp; mBorderShape &#x3D;&#x3D; null) &#123;</span><br><span class="line">                    mBorderShape &#x3D; new RoundRectShape(outerRadii, null, null);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            mShape.resize(getWidth(), getHeight());</span><br><span class="line">            if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH &amp;&amp; mBorderShape !&#x3D; null) &#123;</span><br><span class="line">                mBorderShape.resize(getWidth() - mBorderWidth * 2, getHeight() - mBorderWidth * 2);</span><br><span class="line">                makeStrokeBitmap();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        int saveCount &#x3D; canvas.getSaveCount();</span><br><span class="line">        canvas.save();</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH &amp;&amp; mBorderShape !&#x3D; null &amp;&amp; mBorderBitmap !&#x3D; null) &#123;</span><br><span class="line">            int i &#x3D; canvas.saveLayer(0, 0, getMeasuredWidth(), getMeasuredHeight(), null, Canvas.ALL_SAVE_FLAG);</span><br><span class="line">            &#x2F;&#x2F;1.绘制外边框颜色的正方形</span><br><span class="line">            mBorderPaint.setXfermode(null);</span><br><span class="line">            canvas.drawBitmap(mBorderBitmap, 0, 0, mBorderPaint);</span><br><span class="line">            &#x2F;&#x2F;2.适当画布的中心位置</span><br><span class="line">            canvas.translate(mBorderWidth, mBorderWidth);</span><br><span class="line">            &#x2F;&#x2F;3.绘制减去边框长度的图片，模式为DST_OUT</span><br><span class="line">            mBorderPaint.setXfermode(mBorderDuffMode);</span><br><span class="line">            mBorderShape.draw(canvas, mBorderPaint);</span><br><span class="line">            canvas.restoreToCount(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (mShape !&#x3D; null) &#123;</span><br><span class="line">            mShape.draw(canvas, mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restoreToCount(saveCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void makeStrokeBitmap() &#123;</span><br><span class="line">        if (mBorderWidth &lt;&#x3D; 0) return;</span><br><span class="line"></span><br><span class="line">        int w &#x3D; getMeasuredWidth();</span><br><span class="line">        int h &#x3D; getMeasuredHeight();</span><br><span class="line"></span><br><span class="line">        if (w &#x3D;&#x3D; 0 || h &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        releaseBorderBitmap();</span><br><span class="line"></span><br><span class="line">        mBorderBitmap &#x3D; Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);</span><br><span class="line">        Canvas c &#x3D; new Canvas(mBorderBitmap);</span><br><span class="line">        Paint p &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        p.setColor(mBorderColor);</span><br><span class="line">        c.drawRect(new RectF(0, 0, w, h), p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void releaseBorderBitmap() &#123;</span><br><span class="line">        if (mBorderBitmap !&#x3D; null) &#123;</span><br><span class="line">            mBorderBitmap.recycle();</span><br><span class="line">            mBorderBitmap &#x3D; null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext()).load(url).into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在代码中使用到了自定义的属性，所以需要在<code>value/attrs</code>文件中添加支持，代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;declare-styleable name&#x3D;&quot;CircleImageView1&quot;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_border_width1&quot; format&#x3D;&quot;dimension&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_border_color1&quot; format&#x3D;&quot;color&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_border_overlay1&quot; format&#x3D;&quot;boolean&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_fill_color1&quot; format&#x3D;&quot;color&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_circle_background_color1&quot; format&#x3D;&quot;color&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;declare-styleable&gt;</span><br><span class="line">&lt;&#x2F;resources&gt;</span><br></pre></td></tr></table></figure>
使用也很简单，在xml中使用的代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.example.cm.circleview.view2.CircleImageView1</span><br><span class="line">           android:id&#x3D;&quot;@+id&#x2F;image2_id1&quot;</span><br><span class="line">           app:circle_border_width1&#x3D;&quot;5dp&quot;</span><br><span class="line">           app:circle_border_color1&#x3D;&quot;#fff&quot;</span><br><span class="line">           android:layout_width&#x3D;&quot;200dp&quot;</span><br><span class="line">           android:layout_height&#x3D;&quot;200dp&quot;</span><br><span class="line">           android:layout_marginTop&#x3D;&quot;10dp&quot;</span><br><span class="line">           android:layout_marginBottom&#x3D;&quot;10dp&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
通过java代码设置图片来源，代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    public static final String URL &#x3D; &quot;https:&#x2F;&#x2F;timgsa.baidu.com&#x2F;timg?image&amp;quality&#x3D;80&amp;size&#x3D;b9999_10000&amp;sec&#x3D;1533911636&amp;di&#x3D;04ec95ec44a1623d52b20ff08727ac78&amp;imgtype&#x3D;jpg&amp;er&#x3D;1&amp;src&#x3D;http%3A%2F%2Fimg4.duitang.com%2Fuploads%2Fitem%2F201312%2F05%2F20131205172342_P3nwv.jpeg&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        CircleImageView1 circleImageView21 &#x3D; findViewById(R.id.image2_id1);</span><br><span class="line">        circleImageView21.build(URL);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>能够实现对图片不同边框形状的支持。</p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>实现较复杂，性能代价也比较高，且不支持设置外边框透明度。</p>
<h1 id="使用BitmapShader重新绘制实现圆形图片"><a href="#使用BitmapShader重新绘制实现圆形图片" class="headerlink" title="使用BitmapShader重新绘制实现圆形图片"></a>使用BitmapShader重新绘制实现圆形图片</h1><h2 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h2><p>和上一种方式比起来，第二种方式就显得简单很多了。主要思路就是利用<code>bitmapShader</code>将原图绘制出来，然后通过<code>canvas.drawCircle</code>绘制我们想要的边框即可。</p>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><p>这里只贴出自定义view<code>CircleImageView2</code>的代码，完整代码可以参考我后面给出的代码链接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class CircleImageView2 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    public static final int DEFAULT_BORDER_WIDTH &#x3D; 0;</span><br><span class="line">    private Paint mBorderPaint;</span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private int mRadius;</span><br><span class="line">    private Matrix mMatrix;</span><br><span class="line">    private int mBorderWidth;</span><br><span class="line">    private int mBorderColor;</span><br><span class="line">    private BitmapShader mBitmapShader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(AttributeSet attrs) &#123;</span><br><span class="line">        if (attrs !&#x3D; null) &#123;</span><br><span class="line">            TypedArray a &#x3D; getContext().obtainStyledAttributes(attrs, R.styleable.CircleImageView2);</span><br><span class="line">            mBorderWidth &#x3D; a.getDimensionPixelSize(R.styleable.CircleImageView2_circle_border_width2, DEFAULT_BORDER_WIDTH);</span><br><span class="line">            mBorderColor &#x3D; a.getInt(R.styleable.CircleImageView2_circle_border_color2, Color.BLACK);</span><br><span class="line">            a.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">        super.setScaleType(ScaleType.CENTER_CROP);</span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setAntiAlias(true);</span><br><span class="line">        mMatrix &#x3D; new Matrix();</span><br><span class="line"></span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH) &#123;</span><br><span class="line">            mBorderPaint &#x3D; new Paint();</span><br><span class="line">            mBorderPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">            mBorderPaint.setAntiAlias(true);</span><br><span class="line">            mBorderPaint.setColor(mBorderColor);</span><br><span class="line">            mBorderPaint.setStrokeWidth(mBorderWidth);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(), getMeasuredWidth());</span><br><span class="line">        mRadius &#x3D; min &#x2F; 2;</span><br><span class="line">        setMeasuredDimension(min, min);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">        super.onLayout(changed, left, top, right, bottom);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        if (mBitmapShader &#x3D;&#x3D; null) &#123;</span><br><span class="line">            Bitmap bitmap &#x3D; drawableToBitmap(getDrawable());</span><br><span class="line">            &#x2F;&#x2F;CLAMP表示，当所画图形的尺寸大于Bitmap的尺寸的时候，会用Bitmap四边的颜色填充剩余空间。</span><br><span class="line">            &#x2F;&#x2F;REPEAT表示，当我们绘制的图形尺寸大于Bitmap尺寸时，会用Bitmap重复平铺整个绘制的区域</span><br><span class="line">            &#x2F;&#x2F;MIRROR与REPEAT类似，当绘制的图形尺寸大于Bitmap尺寸时，MIRROR也会用Bitmap重复平铺整个绘图区域，与REPEAT不同的是，两个相邻的Bitmap互为镜像。</span><br><span class="line">            if (bitmap &#x3D;&#x3D; null) &#123;</span><br><span class="line">                super.onDraw(canvas);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mBitmapShader &#x3D; new BitmapShader(bitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class="line">            &#x2F;&#x2F;这里可以进行图片相关的处理，注释的代码是设置比例缩放</span><br><span class="line">&#x2F;&#x2F;            float mScale &#x3D; (mRadius * 2.0f) &#x2F; Math.min(bitmap.getHeight(), bitmap.getWidth());</span><br><span class="line">&#x2F;&#x2F;            mMatrix.setScale(mScale, mScale);</span><br><span class="line">&#x2F;&#x2F;            mBitmapShader.setLocalMatrix(mMatrix);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mPaint.setShader(mBitmapShader);</span><br><span class="line">        canvas.drawCircle(mRadius, mRadius, mRadius, mPaint);</span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH) &#123;</span><br><span class="line">            canvas.drawCircle(mRadius, mRadius, mRadius-mBorderWidth&#x2F;2, mBorderPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Bitmap drawableToBitmap(Drawable drawable) &#123;</span><br><span class="line">        if (drawable &#x3D;&#x3D; null)</span><br><span class="line">            return null;</span><br><span class="line">        if (drawable instanceof BitmapDrawable) &#123;</span><br><span class="line">            return ((BitmapDrawable) drawable).getBitmap();</span><br><span class="line">        &#125;</span><br><span class="line">        int width &#x3D; drawable.getIntrinsicWidth();</span><br><span class="line">        int height &#x3D; drawable.getIntrinsicHeight();</span><br><span class="line">        &#x2F;&#x2F;ARGB_8888 表示颜色色由4个8位组成即32位</span><br><span class="line">        Bitmap bitmap &#x3D; Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</span><br><span class="line">        Canvas canvas &#x3D; new Canvas(bitmap);</span><br><span class="line">        drawable.setBounds(0, 0, width, height);</span><br><span class="line">        drawable.draw(canvas);</span><br><span class="line">        return bitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与用这种方式实现没有边框的圆形图片相比，并添加复杂的逻辑，只是再次基础上画了一个圆，我们将画圆的画笔<code>setStrokeWidth</code>设置我们要实现的边框即可。</p>
<h2 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h2><p>实现比较简单，支持复杂的图片处理。</p>
<h2 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h2><p>需要两次处理<code>drawable</code>，性能还是有一点的开销。</p>
<h1 id="通过clipPath裁剪的方式"><a href="#通过clipPath裁剪的方式" class="headerlink" title="通过clipPath裁剪的方式"></a>通过clipPath裁剪的方式</h1><h2 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h2><p>我们在裁剪好的图片上画一个圆边框即可。与第二种方式实现圆类似。</p>
<h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView3 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    public static final int DEFAULT_BORDER_WIDTH &#x3D; 0;</span><br><span class="line">    private float mRadius;</span><br><span class="line">    private int mBorderWidth;</span><br><span class="line">    private int mBorderColor;</span><br><span class="line">    private Paint mBorderPaint;</span><br><span class="line">    private Path mPath;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context) &#123;</span><br><span class="line">        this(context,null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs,0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(@Nullable AttributeSet attrs) &#123;</span><br><span class="line">        if (attrs!&#x3D;null)&#123;</span><br><span class="line">            TypedArray a &#x3D; getContext().obtainStyledAttributes(attrs, R.styleable.CircleImageView3);</span><br><span class="line">            mBorderWidth &#x3D; a.getDimensionPixelSize(R.styleable.CircleImageView3_circle_border_width3, DEFAULT_BORDER_WIDTH);</span><br><span class="line">            mBorderColor &#x3D; a.getInt(R.styleable.CircleImageView3_circle_border_color3, Color.BLACK);</span><br><span class="line">            a.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH)&#123;</span><br><span class="line">            mBorderPaint &#x3D; new Paint();</span><br><span class="line">            mBorderPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">            mBorderPaint.setAntiAlias(true);</span><br><span class="line">            mBorderPaint.setColor(mBorderColor);</span><br><span class="line">            mBorderPaint.setStrokeWidth(mBorderWidth);</span><br><span class="line">        &#125;</span><br><span class="line">        mPath &#x3D; new Path();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(),getMaxWidth());</span><br><span class="line">        mRadius &#x3D; min&#x2F;2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        mPath.addCircle(mRadius, mRadius, mRadius,Path.Direction.CW);</span><br><span class="line">        canvas.clipPath(mPath);</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        canvas.drawCircle(mRadius, mRadius, mRadius-mBorderWidth&#x2F;2, mBorderPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h2><p>实现简单，不需要额外操作<code>drawble</code>，简单粗暴。</p>
<h2 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h2><p>不支持复杂的图片处理。</p>
<p>源代码链接:<a href="https://github.com/Reoger/CurtomViewTest" target="_blank" rel="noopener">https://github.com/Reoger/CurtomViewTest</a><br>上一篇链接:<a href="https://blog.csdn.net/Reoger/article/details/81394579" target="_blank" rel="noopener">https://blog.csdn.net/Reoger/article/details/81394579</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/02/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E6%88%90%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/02/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E6%88%90%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87/" class="post-title-link" itemprop="url">自定义View之将图片裁剪成圆形图片</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-02 16:44:55" itemprop="dateCreated datePublished" datetime="2018-08-02T16:44:55+08:00">2018-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:11:41" itemprop="dateModified" datetime="2020-04-12T23:11:41+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="自定义View之将图片裁剪成圆形图片"><a href="#自定义View之将图片裁剪成圆形图片" class="headerlink" title="自定义View之将图片裁剪成圆形图片"></a>自定义View之将图片裁剪成圆形图片</h1><h2 id="使用PorterDuffXfermode方式来实现"><a href="#使用PorterDuffXfermode方式来实现" class="headerlink" title="使用PorterDuffXfermode方式来实现"></a>使用PorterDuffXfermode方式来实现</h2><p>在使用这中方式之前，我们有必要弄清楚<code>PorterBuddx</code>究竟是什么。<br>简单来说，他是定义的一种图像融合的方式，具体的模式有如下几种，效果如图：<br><img src="https://upload-images.jianshu.io/upload_images/2041548-d964105abf4be5d9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/312" alt="官方的说明图"></p>
<p>在次，不多做介绍，想深入了解<code>PorterDuffXfermode</code>可以参考<a href="https://www.jianshu.com/p/d11892bbe055" target="_blank" rel="noopener">各个击破搞明白PorterDuff.Mode</a><br>本次使用mode是<code>SRCIN</code>,由图效果可知，我们需要在原图上绘制一个圆，原图与我们绘制得圆重叠得区域就会显示出来，原理很简单，下面开始代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView1 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private Shape mShape;</span><br><span class="line">    private float mRadius;</span><br><span class="line"></span><br><span class="line">    private float[] outerRadii &#x3D; new float[8];;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context) &#123;</span><br><span class="line">        this(context,null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context,attrs,0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView() &#123;</span><br><span class="line">        setLayerType(LAYER_TYPE_HARDWARE,null);</span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setColor(Color.BLACK);</span><br><span class="line">        &#x2F;&#x2F;注意这里，将画笔的PorterDuffXfermode模式设置为了DST_IN模式！！！</span><br><span class="line">        mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.DST_IN));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int width &#x3D; getMeasuredWidth();</span><br><span class="line">        int height &#x3D; getMeasuredHeight();</span><br><span class="line">        int min &#x3D; Math.min(width,height);</span><br><span class="line">        mRadius &#x3D; min&#x2F;2;</span><br><span class="line">        setMeasuredDimension(min,min);</span><br><span class="line">        &#x2F;&#x2F;因为是圆，所以要设置为长宽相等</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">        super.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        if (changed)&#123;</span><br><span class="line">            if (mShape &#x3D;&#x3D; null)&#123;</span><br><span class="line">                Arrays.fill(outerRadii,mRadius);</span><br><span class="line">                mShape &#x3D; new RoundRectShape(outerRadii,null,null);</span><br><span class="line">                &#x2F;&#x2F;</span><br><span class="line">            &#125;</span><br><span class="line">            mShape.resize(getWidth(),getHeight());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        int saveCount &#x3D; canvas.getSaveCount();</span><br><span class="line">        canvas.save();</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        if (mShape !&#x3D; null)&#123;</span><br><span class="line">            mShape.draw(canvas,mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restoreToCount(saveCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 这里直接使用Glide库来加载图片，也可以在xml文件或者java代码中设置图片</span><br><span class="line">    public void build(String url)&#123;</span><br><span class="line">        Glide.with(getContext()).load(url).into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在布局中的引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;ScrollView xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class="line">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:background&#x3D;&quot;#333&quot;</span><br><span class="line">    tools:context&#x3D;&quot;com.example.cm.circleview.MainActivity&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center_horizontal&quot;</span><br><span class="line">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;com.example.cm.circleview.view.CircleImageView1</span><br><span class="line">            android:layout_marginTop&#x3D;&quot;10dp&quot;</span><br><span class="line">            android:layout_marginBottom&#x3D;&quot;10dp&quot;</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;image_id1&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;200dp&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;200dp&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;ScrollView&gt;</span><br></pre></td></tr></table></figure>
<p>通过java代码设置图片来源，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    public static final String URL &#x3D; &quot;https:&#x2F;&#x2F;timgsa.baidu.com&#x2F;timg?image&amp;quality&#x3D;80&amp;size&#x3D;b9999_10000&amp;sec&#x3D;1533271076118&amp;di&#x3D;&quot; +</span><br><span class="line">            &quot;4ef2b0b50abb957177874a76d828126a&amp;imgtype&#x3D;0&amp;src&#x3D;http%3A%2F%2Fwww.91danji.com%2Fattachments%2F201503%2F24%2F11%2F3q8s74tc8.jpeg&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        CircleImageView1 circleImageView1 &#x3D; findViewById(R.id.image_id1);</span><br><span class="line">        circleImageView1.build(URL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为项目使用到了<code>Glide</code>,所以需要在module的<code>build.grade</code>文件中添加必要的依赖，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;com.github.bumptech.glide:glide:3.8.0&#39;</span><br></pre></td></tr></table></figure>
<p>因为图片来自网路，需在<code>androidMainFest</code>中添加联网权限。<br>显示效果如图：<br><img src="http://ovec6nnof.bkt.clouddn.com/dump_4314198875772344884.png" alt="效果图"></p>
<p>此次的实现都是最简单的实现，没有添加额外的逻辑，代码比较少，便于理解。<br>后续会在这个的基础上添加稍微复杂点的图像处理。</p>
<h3 id="使用小结"><a href="#使用小结" class="headerlink" title="使用小结"></a>使用小结</h3><p>通过该方式使得图片展现成圆形，需要开启硬件加速，否则图片的渲染效果达不到理想的效果，具体原因可以参照：<a href="https://blog.csdn.net/hqdoremi/article/details/8307496" target="_blank" rel="noopener">硬件加速 setlayertype</a>。<br>我们可以通过<code>shape</code>或者<code>drawable</code>来绘制圆，使用然后通过图片的叠加显示来显示我们需要的原型图片的效果。这种方式就是通过绘制一个圆盖在原来的图片上，通过设置两张图片叠加显示效果来实现显示圆角图片</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>该方式不需要操作原来的<code>drawable</code>,使用起来风险比较小，也比较方便。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>需要启动硬件加速，否则可能会出现意想不到的结果。</p>
<h2 id="使用BitmapShader重新绘制实现圆形图片"><a href="#使用BitmapShader重新绘制实现圆形图片" class="headerlink" title="使用BitmapShader重新绘制实现圆形图片"></a>使用BitmapShader重新绘制实现圆形图片</h2><p>整体思路： 通过对原来图片进行处理，将原图片裁剪成圆形然后绘制展示。<br>贴上<code>CircleImageView2</code>的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView2 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private int mRadius;</span><br><span class="line">    private float mScale;</span><br><span class="line">    private Matrix mMatrix;</span><br><span class="line"></span><br><span class="line">    private BitmapShader mBitmapShader;</span><br><span class="line"></span><br><span class="line">    public static final String TAG &#x3D; &quot;CircleImageView2&quot;;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(AttributeSet attrs) &#123;</span><br><span class="line"></span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setAntiAlias(true);</span><br><span class="line">        mMatrix &#x3D; new Matrix();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(), getMeasuredWidth());</span><br><span class="line">        mRadius &#x3D; min &#x2F; 2;</span><br><span class="line">        setMeasuredDimension(min, min);</span><br><span class="line">        &#x2F;&#x2F;强制设置成宽度和高度一致</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        if (mBitmapShader &#x3D;&#x3D; null) &#123;</span><br><span class="line">            Bitmap bitmap &#x3D; drawableToBitmap(getDrawable());</span><br><span class="line">            &#x2F;&#x2F;CLAMP表示，当所画图形的尺寸大于Bitmap的尺寸的时候，会用Bitmap四边的颜色填充剩余空间。</span><br><span class="line">            &#x2F;&#x2F;REPEAT表示，当我们绘制的图形尺寸大于Bitmap尺寸时，会用Bitmap重复平铺整个绘制的区域</span><br><span class="line">            &#x2F;&#x2F;MIRROR与REPEAT类似，当绘制的图形尺寸大于Bitmap尺寸时，MIRROR也会用Bitmap重复平铺整个绘图区域，与REPEAT不同的是，两个相邻的Bitmap互为镜像。</span><br><span class="line">            mBitmapShader &#x3D; new BitmapShader(bitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class="line">            &#x2F;&#x2F;计算缩放比例</span><br><span class="line">            mScale &#x3D; (mRadius * 2.0f) &#x2F; Math.min(bitmap.getHeight(), bitmap.getWidth());</span><br><span class="line">            mMatrix.setScale(mScale, mScale);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;设置图片缩放</span><br><span class="line">        mBitmapShader.setLocalMatrix(mMatrix);</span><br><span class="line">        mPaint.setShader(mBitmapShader);</span><br><span class="line">        canvas.drawCircle(mRadius, mRadius, mRadius, mPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 将圆图片转化成bitmap</span><br><span class="line">    private Bitmap drawableToBitmap(Drawable drawable) &#123;</span><br><span class="line">        if (drawable instanceof BitmapDrawable) &#123;</span><br><span class="line">            return ((BitmapDrawable) drawable).getBitmap();</span><br><span class="line">        &#125;</span><br><span class="line">        int width &#x3D; drawable.getIntrinsicWidth();</span><br><span class="line">        int height &#x3D; drawable.getIntrinsicHeight();</span><br><span class="line">        &#x2F;&#x2F;ARGB_8888 表示颜色色由4个8位组成即32位</span><br><span class="line">        Bitmap bitmap &#x3D; Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</span><br><span class="line">        Canvas canvas &#x3D; new Canvas(bitmap);</span><br><span class="line">        drawable.setBounds(0, 0, width, height);</span><br><span class="line">        drawable.draw(canvas);</span><br><span class="line">        return bitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现逻辑：</strong><br>首先将获得的<code>drawable</code>转化成<code>bitmap</code>,然后通过<a href="https://www.cnblogs.com/tianzhijiexian/p/4298660.html" target="_blank" rel="noopener">BitmapShader</a>处理<code>bitmap</code>,并将其设置给画笔，当使用此画笔绘制时，该<code>bitmap</code>就会展示出来，如此我们只需要使用画布绘制一个圆形即可。</p>
<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><p>可以实现对图片复杂的处理，可扩展性较强。</p>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><p>实现起来较为复杂，且有对</p>
<h1 id="通过clipPath裁剪的方式"><a href="#通过clipPath裁剪的方式" class="headerlink" title="通过clipPath裁剪的方式"></a>通过clipPath裁剪的方式</h1><p>这种方式最简单暴力，直接在原来的图片上进行裁剪就ok了，如果不需要对图片进行处理的画，推荐用这种方式，因为，简单，粗暴！<br>直接上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView3 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    private float mRadius;</span><br><span class="line">    private Path mPath;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context) &#123;</span><br><span class="line">        this(context,null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs,0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView() &#123;</span><br><span class="line">        mPath &#x3D; new Path();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(),getMaxWidth());</span><br><span class="line">        mRadius &#x3D; min&#x2F;2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        mPath.addCircle(mRadius, mRadius, mRadius,Path.Direction.CW);</span><br><span class="line">        canvas.clipPath(mPath);</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>没什么好说的，关键就一句<code>canvas.clipPath(mPath);</code>，需要关注一下<a href="https://blog.csdn.net/xiangzhihong8/article/details/78278931" target="_blank" rel="noopener">path</a>的用法。</p>
<h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><p>简单粗暴，不涉及<code>drwable</code> 相关的操作，效率较高，实现也简单。</p>
<h3 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h3><p>因为是对图片的直接剪裁，不能实现对图片相关的处理，也没有抗锯齿效果，如果图片不是正方形图片可能会影响最终的效果。</p>
<p>源程序下载地址:<a href="https://github.com/Reoger/CurtomViewTest" target="_blank" rel="noopener">https://github.com/Reoger/CurtomViewTest</a></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>上述三种方式都能实现圆形图片的需求，但是各有优缺点。如果只是需要展示圆形图片而不需要对图片进行任何处理，可以选用第三种方式，需要对图片进行比较复杂的处理的画，则推荐第一种或者第二种方式。<br>本篇博客到此结束，下一篇将会使用上述的三种方式实现圆形外边框的效果。</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/lmj623565791/article/details/42094215" target="_blank" rel="noopener">Android Xfermode 实战 实现圆形、圆角图片</a></li>
<li><a href="https://blog.csdn.net/lmj623565791/article/details/24555655" target="_blank" rel="noopener">Android 完美实现图片圆角和圆形（对实现进行分析</a></li>
<li><a href="https://blog.csdn.net/a369414641/article/details/53198671" target="_blank" rel="noopener">Android圆形图片不求人，自定义View实现（BitmapShader使用）</a></li>
<li><a href="https://www.jianshu.com/p/626dbd93207d" target="_blank" rel="noopener">关于圆角ImageView的几种实现方式</a></li>
<li><a href="https://blog.csdn.net/iispring/article/details/50500106" target="_blank" rel="noopener">Android中Canvas绘图之Shader使用图文详解</a></li>
<li><a href="https://github.com/gavinliu/ShapedImageView" target="_blank" rel="noopener">ShapedImageView</a></li>
<li><a href="https://github.com/hdodenhof/CircleImageView" target="_blank" rel="noopener">CircleImageView</a></li>
<li><a href="https://blog.csdn.net/harvic880925/article/details/52039081" target="_blank" rel="noopener">自定义控件三部曲之绘图篇（十八）——BitmapShader与望远镜效果</a></li>
<li><a href="https://blog.csdn.net/aigestudio/article/details/41960507" target="_blank" rel="noopener">自定义控件其实很简单5/12</a></li>
<li><a href="https://blog.csdn.net/xiangzhihong8/article/details/78278931" target="_blank" rel="noopener">Android开发之Path详解</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/30/%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E6%90%AD%E5%BB%BASS(R)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/30/%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E6%90%AD%E5%BB%BASS(R)/" class="post-title-link" itemprop="url">一键脚本搭建SS/搭建SSR服务并开启BBR加速</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-30 15:44:55" itemprop="dateCreated datePublished" datetime="2018-07-30T15:44:55+08:00">2018-07-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:07:40" itemprop="dateModified" datetime="2020-04-12T23:07:40+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AC%E8%BD%BD/" itemprop="url" rel="index"><span itemprop="name">转载</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一键脚本搭建SS-搭建SSR服务并开启BBR加速"><a href="#一键脚本搭建SS-搭建SSR服务并开启BBR加速" class="headerlink" title="一键脚本搭建SS/搭建SSR服务并开启BBR加速"></a>一键脚本搭建SS/搭建SSR服务并开启BBR加速</h1><p> 2018年1月20日 497条评论 127,696次阅读 293人点赞</p>
<p>自己写的一键搭建shadowsocks/搭建shadowsocksR的shell脚本，一键脚本适用<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr</a>上的和<a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener">搬瓦工</a>所有机型（CentOS、Ubuntu、Debian），搭建ss服务器支持所有<strong>客户端类型</strong>，本机你是iOS，Android，Windows，Mac，或者是Linux，搭建ss/ssr都是适用的科学上网方式。一键脚本搭建SS/SSR服务器，<strong>绝对没有任何问题</strong>，任何问题欢迎留言。一键脚本内容包括一键搭建shadowsocks/一键搭建shadowsocksR+一键开启bbr加速，适合新手小白。</p>
<p><strong>纯新手</strong>也可以搭建ss/ssr，录了个<strong>视频教程</strong>，不想看文字的可以看视频，或者结合起来一起看：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/#vultrss" target="_blank" rel="noopener">搭建ss视频教程</a>。</p>
<p>文章目录</p>
<ul>
<li><a href="#shadowsocks" title="什么是shadowsocks">什么是shadowsocks</a></li>
<li><a href="#ssssr" title="一键脚本搭建ss/ssr支持系统版本">一键脚本搭建ss/ssr支持系统版本</a></li>
<li><a href="#i" title="代理服务器购买">代理服务器购买</a></li>
<li><a href="#Linux" title="连接远程Linux服务器">连接远程Linux服务器</a></li>
<li><a href="#SSSSR" title="一键搭建SS/搭建SSR服务">一键搭建SS/搭建SSR服务</a><ul>
<li><a href="#shadowsocks-2" title="一键搭建shadowsocks">一键搭建shadowsocks</a></li>
<li><a href="#shadowsocksR" title="一键搭建shadowsocksR">一键搭建shadowsocksR</a></li>
</ul>
</li>
<li><a href="#BBR" title="一键开启BBR加速">一键开启BBR加速</a></li>
<li><a href="#shadowsocksshadowsockR" title="客户端搭建shadowsocks/shadowsockR代理实现科学上网">客户端搭建shadowsocks/shadowsockR代理实现科学上网</a><ul>
<li><a href="#ss" title="客户端搭建ss代理">客户端搭建ss代理</a></li>
<li><a href="#ssr" title="客户端搭建ssr代理">客户端搭建ssr代理</a></li>
</ul>
</li>
<li><a href="#vultrss" title="vultr搭建ss视频教程">vultr搭建ss视频教程</a></li>
<li><a href="#i-2" title="一键脚本更新日志">一键脚本更新日志</a></li>
</ul>
<h2 id="什么是shadowsocks"><a href="#什么是shadowsocks" class="headerlink" title="什么是shadowsocks"></a><strong>什么是shadowsocks</strong></h2><p>shadowsocks可以指一种SOCKS5的加密传输协议，也可以指基于这种加密协议的各种数据传输包。</p>
<p><strong>shadowsocks实现科学上网原理？</strong>shadowsocks正常工作需要服务器端和客户端两端合作实现，首先，客户端（本机）通过ss（shadowsocks）对正常的访问请求进行SOCK5加密，将加密后的访问请求传输给ss服务器端，服务器端接收到客户端的加密请求后，解密得到原始的访问请求，根据请求内容访问指定的网站（例如Google，YouTube，Facebook，instagram等），得到网站的返回结果后，再利用SOCKS5加密并返回给客户端，客户端通过ss解密后得到正常的访问结果，于是就可以实现你直接访问该网站的“假象”。</p>
<p><strong>为什么选择shadowsocks？</strong>不限终端（安卓，苹果，Windows，Mac都可用），流量便宜（服务器500G只要15元），方便（一键脚本，不需要专业知识）。</p>
<p><strong>为什么要自己搭建ss/ssr？</strong>你也许会觉得买ss服务也很方便，但是你得要考虑以下几个问题。首先，买的ss服务，限制很多，终端可能只能同时在线2个，每个月就一点点流量可能价格却不便宜，有时候还被别人做手脚，流量跑的贼快；其次，别人收钱跑路怎么办？很多这种情况的；更重要的是，如第一个问题中描述的shadowsocks原理，如果有心人做了一点手脚，是可以得到你的访问记录的；而自己搭建ss/ssr服务，一键脚本也就10来分钟就可以搞定。</p>
<h2 id="一键脚本搭建ss-ssr支持系统版本"><a href="#一键脚本搭建ss-ssr支持系统版本" class="headerlink" title="一键脚本搭建ss/ssr支持系统版本"></a><strong>一键脚本搭建ss/ssr支持系统版本</strong></h2><p>脚本系统支持：CentOS 6+，Debian 7+，Ubuntu 12+</p>
<p>注：这个脚本支持的系统版本是指ss服务器的版本（都没看过也没关系，不影响搭建），你本机是Windows、Mac、Linux，或者你想用手机端搭建ss/ssr服务器，安卓和苹果，都是可以的。</p>
<h2 id="代理服务器购买"><a href="#代理服务器购买" class="headerlink" title="代理服务器购买"></a><strong>代理服务器购买</strong></h2><p>作为跳板的代理服务器推荐<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr</a>和<a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener">搬瓦工</a>，一是因为本脚本在这两家的所有VPS都做了测试，二是因为都是老牌VPS服务商，不怕跑路。</p>
<p>推荐你们使用Vultr：<a href="https://www.flyzy2005.win/goto/vultr" target="_blank" rel="noopener">优惠注册链接</a>，购买图解与节点推荐可以参考<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr购买图解步骤</a>，最低月付2.5刀，也是目前博主自用以及运行小站的VPS，月付方便，随时重置。</p>
<p>对于宽带是电信或者是联通的用户，可以试一下搬瓦工的CN2<strong>电信/联通直连线路</strong>（季付/半年付/年付），<strong>GT线路</strong>详情可以参考<a href="https://www.flyzy2005.win/vps/bandwagon-cn2/" target="_blank" rel="noopener">搬瓦工洛杉矶CN2 GT线路测评</a>。如果想体验最优的<strong>GIA线路</strong>，也可以尝试搬瓦工CN2 GIA线路（<strong>强力推荐</strong>，效果爆炸，全程CN2，年付平均下来一个月30元左右，晚上高峰时期线路也不拥堵。2018年5月15日正式启动，<a href="https://www.flyzy2005.win/vps/bandwagonhost-cn2-gia/" target="_blank" rel="noopener">搬瓦工洛杉矶CN2 GIA线路测评</a>），当然你也可以直接用<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr</a>，搬瓦工暂时不支持月付。</p>
<p>Vultr和搬瓦工上的所有机型是绝对可以一键脚本搭建shadowsocks/搭建shadowsocksR+开启bbr加速成功的，任何问题<strong>欢迎留言</strong>~</p>
<h2 id="连接远程Linux服务器"><a href="#连接远程Linux服务器" class="headerlink" title="连接远程Linux服务器"></a><strong>连接远程Linux服务器</strong></h2><p>购买完成后根据<a href="https://www.flyzy2005.win/tech/linux/xshell-connect-linux/" target="_blank" rel="noopener">Windows通过Xshell连接Linux</a>或者<a href="https://www.flyzy2005.win/tech/linux/mac-connect-vps-linux/" target="_blank" rel="noopener">Mac通过Terminal远程连接Linux</a>即可。</p>
<p>你如果身边没有电脑，一定要搞什么手机搭建ss服务器 <img src="https://www.flyzy2005.win/wp-content/themes/Kratos/images/smilies/symbols.png" alt=":symbols:"> 也是可以的，毕竟一键脚本只需要复制几行脚本命令就行了。iOS用户可以使用Termius这个工具，直接在App Store下载就行。Android没有用过，反正能ssh连接的软件就行~</p>
<h2 id="一键搭建SS-搭建SSR服务"><a href="#一键搭建SS-搭建SSR服务" class="headerlink" title="一键搭建SS/搭建SSR服务"></a><strong>一键搭建SS/搭建SSR服务</strong></h2><p>注意，shadowsocks/shadowsocksR这两个<strong>只需要搭建一个</strong>就可以了！！！！SS与SSR之间的比较一直是各有各的说法，王婆卖瓜自卖自夸。我用的是SS，因为SS的iOS版本比较容易下载，并且被没有觉得ss容易被探查到~</p>
<h3 id="一键搭建shadowsocks"><a href="#一键搭建shadowsocks" class="headerlink" title="一键搭建shadowsocks"></a><strong>一键搭建shadowsocks</strong></h3><p>在<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">购买VPS</a>并用<a href="https://www.flyzy2005.win/tech/linux/xshell-connect-linux/" target="_blank" rel="noopener">Xshell连接上你刚购买的VPS</a>后，你将看到如下图所示的界面：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/vutlr-connect-result.png" alt="vutlr-connect-result"></p>
<p>如红框中所示，root@vult（root@ubuntu）说明已经连接成功了，之后你只需要<strong>在绿色光标处直接复制以下代码</strong>就可以了（直接复制即可，如每段代码下方截图中所示）。</p>
<p>1.下载一键搭建ss脚本文件（直接在绿色光标处复制该行命令回车即可，<strong>只需要执行一次</strong>，卸载ss后也不需要重新下载）</p>
<p> <textarea class="crayon-plain print-no" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" readonly="readonly" wrap="soft" data-settings="dblclick">git clone <a href="https://github.com/flyzy2005/ss-fly" target="_blank" rel="noopener">https://github.com/flyzy2005/ss-fly</a></textarea></p>
<p> <code>git clone https://github.com/flyzy2005/ss-fly</code></p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/shadowsocks-ss-fly-clone.png" alt="shadowsocks-ss-fly-clone"></p>
<p>如果提示<code>bash: git: command not found</code>，则先安装git：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Centos执行这个： yum -y install git</span><br><span class="line">Ubuntu&#x2F;Debian执行这个： apt-get -y install git</span><br></pre></td></tr></table></figure>


<p>2.运行搭建ss脚本代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -i flyzy2005.com 1024</span><br></pre></td></tr></table></figure>

<p>其中<strong>flyzy2005.com</strong>换成你要设置的shadowsocks的密码即可（这个<strong>flyzy2005.com</strong>就是你ss的密码了，是需要填在客户端的密码那一栏的），密码随便设置，最好<strong>只包含字母+数字</strong>，一些特殊字符可能会导致冲突。而第二个参数<strong>1024</strong>是<strong>端口号</strong>，也可以不加，不加默认是1024~（<strong>举个例子</strong>，脚本命令可以是ss-fly/ss-fly.sh -i qwerasd，也可以是ss-fly/ss-fly.sh -i qwerasd 8585，后者指定了服务器端口为8585，前者则是默认的端口号1024，两个命令设置的ss密码都是qwerasd）：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/shadowsocks-install.png" alt="shadowsocks-install"></p>
<p>界面如下就表示一键搭建ss成功了：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-success-new.png" alt="ss-fly-success-new"></p>
<p>注：如果需要改密码或者改端口，只需要重新<strong>再执行一次搭建ss脚本代码</strong>就可以了，或者修改<code>/etc/shadowsocks.json</code>这个配置文件。</p>
<p>3.相关ss操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">修改配置文件：vim &#x2F;etc&#x2F;shadowsocks.json</span><br><span class="line"></span><br><span class="line">停止ss服务：ssserver -c &#x2F;etc&#x2F;shadowsocks.json -d stop</span><br><span class="line"></span><br><span class="line">启动ss服务：ssserver -c &#x2F;etc&#x2F;shadowsocks.json -d start</span><br><span class="line"></span><br><span class="line">重启ss服务：ssserver -c &#x2F;etc&#x2F;shadowsocks.json -d restart</span><br></pre></td></tr></table></figure>
<p>4.卸载ss服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -uninstall</span><br></pre></td></tr></table></figure>

<h3 id="一键搭建shadowsocksR"><a href="#一键搭建shadowsocksR" class="headerlink" title="一键搭建shadowsocksR"></a><strong>一键搭建shadowsocksR</strong></h3><p><strong>再次提醒</strong>，如果安装了SS，就不需要再安装SSR了，如果要改装SSR，请按照上一部分内容的教程先卸载SS！！！</p>
<p>1.下载一键搭建ssr脚本（<strong>只需要执行一次</strong>，卸载ssr后也不需要重新执行）</p>
<p><code>git clone https://github.com/flyzy2005/ss-fly</code>，此步骤与一键搭建ss一致，可以参考：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/#shadowsocks" target="_blank" rel="noopener">下载脚本</a></p>
<p>2.运行搭建ssr脚本代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -ssr</span><br></pre></td></tr></table></figure>

<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-insall-ssr.png" alt="ss-fly-insall-ssr"></p>
<p>3.输入对应的参数</p>
<p>执行完上述的脚本代码后，会进入到输入参数的界面，包括服务器端口，密码，加密方式，协议，混淆。可以直接输入回车选择默认值，也可以输入相应的值选择对应的选项：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-bbr-options.png" alt="ss-fly-ssr-options"></p>
<p>全部选择结束后，会看到如下界面，就说明搭建ssr成功了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Congratulations, ShadowsocksR server install completed!</span><br><span class="line"></span><br><span class="line">Your Server IP        :你的服务器ip</span><br><span class="line"></span><br><span class="line">Your Server Port      :你的端口</span><br><span class="line"></span><br><span class="line">Your Password :你的密码</span><br><span class="line"></span><br><span class="line">Your Protocol :你的协议</span><br><span class="line"></span><br><span class="line">Your obfs :你的混淆</span><br><span class="line"></span><br><span class="line">Your Encryption Method:your_encryption_method</span><br><span class="line"></span><br><span class="line">Welcome to visit:https:&#x2F;&#x2F;shadowsocks.be&#x2F;9.html</span><br><span class="line"></span><br><span class="line">Enjoy it!</span><br></pre></td></tr></table></figure>

<p>4.相关操作ssr命令<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">启动：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks start</span><br><span class="line"></span><br><span class="line">停止：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks stop</span><br><span class="line"></span><br><span class="line">重启：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks restart</span><br><span class="line"></span><br><span class="line">状态：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks status</span><br><span class="line"></span><br><span class="line">配置文件路径：&#x2F;etc&#x2F;shadowsocks.json</span><br><span class="line"></span><br><span class="line">日志文件路径：&#x2F;var&#x2F;log&#x2F;shadowsocks.log</span><br><span class="line"></span><br><span class="line">代码安装目录：&#x2F;usr&#x2F;local&#x2F;shadowsocks</span><br></pre></td></tr></table></figure><br>5.卸载ssr服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;shadowsocksR.sh uninstall</span><br></pre></td></tr></table></figure>

<h2 id="一键开启BBR加速"><a href="#一键开启BBR加速" class="headerlink" title="一键开启BBR加速"></a><strong>一键开启BBR加速</strong></h2><p>BBR是Google开源的一套内核加速算法，可以让你搭建的shadowsocks/shadowsocksR速度上一个台阶，本一键搭建ss/ssr脚本支持一键升级最新版本的内核并开启BBR加速。</p>
<p>BBR支持4.9以上的，如果低于这个版本则会自动下载最新内容版本的内核后开启BBR加速并重启，如果高于4.9以上则自动开启BBR加速，执行如下脚本命令即可自动开启BBR加速：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -bbr</span><br></pre></td></tr></table></figure>

<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-bbr-success-new.png" alt="ss-fly-bbr-success-new"></p>
<p>装完后需要重启系统，输入y即可立即重启，或者之后输入<code>reboot</code>命令重启。</p>
<p>判断BBR加速有没有开启成功。输入以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br></pre></td></tr></table></figure>

<p>如果返回值为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_available_congestion_control &#x3D; bbr cubic reno</span><br></pre></td></tr></table></figure>

<p>后面有bbr，则说明已经开启成功了。</p>
<h2 id="客户端搭建shadowsocks-shadowsockR代理实现科学上网"><a href="#客户端搭建shadowsocks-shadowsockR代理实现科学上网" class="headerlink" title="客户端搭建shadowsocks/shadowsockR代理实现科学上网"></a><strong>客户端搭建shadowsocks/shadowsockR代理实现科学上网</strong></h2><h3 id="客户端搭建ss代理"><a href="#客户端搭建ss代理" class="headerlink" title="客户端搭建ss代理"></a><strong>客户端搭建ss代理</strong></h3><p>各种客户端版本下载地址：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/ss-clients-download/" target="_blank" rel="noopener">各版本shadowsocks客户端下载地址</a></p>
<p>以Windows为例（<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-pc-windows-config/" target="_blank" rel="noopener">shadowsocks电脑版（windows）客户端配置教程</a>）：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/shadowsocks-pc-windows.png" alt="shadowsocks-pc-windows"></p>
<p>在状态栏右击shadowsocks，勾选<strong>开机启动</strong>和<strong>启动系统代理</strong>，在<strong>系统代理模式</strong>中选择<strong>PAC模式</strong>，<strong>服务器</strong>-&gt;<strong>编辑服务器</strong>，一键安装shadowsocks的脚本默认服务器端口是1024，加密方式是aes-256-cfb，密码是你设置的密码，ip是你自己的VPS ip，保存即可~</p>
<p><strong>PAC模式</strong>是指国内可以访问的站点直接访问，不能直接访问的再走shadowsocks代理~</p>
<p>OK！一键脚本搭建shadowsocks完毕！科学上网吧，兄弟！<a href="https://www.flyzy2005.win/go/go.php?url=https://www.google.com/" target="_blank" rel="noopener">Google</a></p>
<h3 id="客户端搭建ssr代理"><a href="#客户端搭建ssr代理" class="headerlink" title="客户端搭建ssr代理"></a><strong>客户端搭建ssr代理</strong></h3><p>各种客户端版本下载地址：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocksr/ss-ssr-clients/" target="_blank" rel="noopener">各版本SS客户端&amp;SSR客户端官方下载地址</a></p>
<p>以Windows为例：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ssr-pc-windows-config.png" alt="ssr-pc-windows-config"></p>
<p>在状态栏右击shadowsocksR，在<strong>系统代理模式</strong>中选择<strong>PAC模式</strong>，再左击两次状态栏的图标打开编辑服务器界面，如上图所示，按照自己的服务器配置填充内容<strong>，</strong>保存即可~</p>
<p><strong>PAC模式</strong>是指国内可以访问的站点直接访问，不能直接访问的再走shadowsocksR代理~</p>
<p>OK！一键脚本搭建shadowsocksR完毕！科学上网吧，兄弟！<a href="https://www.flyzy2005.win/go/go.php?url=https://www.google.com/" target="_blank" rel="noopener">Google</a></p>
<h2 id="vultr搭建ss视频教程"><a href="#vultr搭建ss视频教程" class="headerlink" title="vultr搭建ss视频教程"></a><strong>vultr搭建ss视频教程</strong></h2><p>应读者要求录了个视频教程，如果你觉得这些文字还不够生动，不够清楚的话，可以看一下视频教程。</p>
<p>视频获取方式：关注微信公众号<strong>flyzy小站</strong>，发送<strong>视频</strong>即可获得。</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2017/12/flyzy.jpg" alt="flyzy小站"></p>
<h2 id="一键脚本更新日志"><a href="#一键脚本更新日志" class="headerlink" title="一键脚本更新日志"></a><strong>一键脚本更新日志</strong></h2><p>一键脚本源码：<a href="https://www.flyzy2005.win/go/go.php?url=https://github.com/flyzy2005/ss-fly" target="_blank" rel="noopener">一键搭建shadowoscks/搭建shadowsocksR并开启bbr内核加速</a></p>
<p>2018年1月20日，上传一键安装shadowsocks脚本</p>
<p>2018年1月24日，添加升级内核并开启BBR加速功能</p>
<p>2018年3月28日，将升级内核&amp;&amp;开启BBR加速集成在一个命令中</p>
<p>2018年4月4日，添加一键安装shadowsocksR功能（调用的teddysun大大的<a href="https://www.flyzy2005.win/go/go.php?url=https://shadowsocks.be/9.html" target="_blank" rel="noopener">一键搭建SSR脚本</a> <img src="https://www.flyzy2005.win/wp-content/themes/Kratos/images/smilies/eek.png" alt=":eek:"> ）</p>
<p>2018年4月27日，支持Ubuntu/CentOS/Debian</p>
<p>2018年5月29日，支持<a href="https://www.flyzy2005.win/v2ray/how-to-build-v2ray/" target="_blank" rel="noopener">一键安装V2Ray</a></p>
<p>关注公众号<strong>flyzy小站</strong>，上面有一些搭建shadowsocks<strong>常见问题</strong>的总结<del>如果还是不行，欢迎在公众号留言</del></p>
<p><strong>声明</strong>：本文只作为技术分享，请遵守相关法律，严禁做违法乱纪的事情！</p>
<p>Telegram频道已经开通，关注<a href="https://www.flyzy2005.win/go/?https://t.me/flyzythink" target="_blank" rel="noopener">flyzythink</a>，随手分享正能量，了解VPS优惠与补货<br>Telegram群组已经开通，加入<a href="https://www.flyzy2005.win/go/?https://t.me/flyzyxiaozhan" target="_blank" rel="noopener">flyzy小站</a>，FREE TO TALK<br>QQ群开通：780593286 <a href="https://www.flyzy2005.win/go/?url=https://shang.qq.com/wpa/qunwpa?idkey=1e8e1c9e5c8056b05aaaa5e34f6dc9faa7b655610cc790884043b738ceebb753" target="_blank" rel="noopener"><img src="//pub.idqqimg.com/wpa/images/group.png" alt="flyzy小站" title="flyzy小站"></a></p>
<h3 id="原创声明"><a href="#原创声明" class="headerlink" title="原创声明"></a>原创声明</h3><p>该日志由 <a href="https://www.flyzy2005.win" target="_blank" rel="noopener" title="flyzy小站">flyzy小站</a> 于2018年01月20日发表在<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/" target="_blank" rel="noopener">shadowsocks</a>分类下， 你可以<a href="#respond">发表评论</a>，并在保留<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/" target="_blank" rel="noopener">原文地址</a>及作者的情况下转载到你的网站或博客。<br>转载请注明: <a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/" target="_blank" rel="noopener" title="本文固定链接 https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/">一键脚本搭建SS/搭建SSR服务并开启BBR加速 | flyzy小站</a><br>关键字: <a href="https://www.flyzy2005.win/tag/bbr%e4%b8%80%e9%94%ae/" target="_blank" rel="noopener">bbr一键</a>, <a href="https://www.flyzy2005.win/tag/shadowsock/" target="_blank" rel="noopener">shadowsock</a>, <a href="https://www.flyzy2005.win/tag/ss-ssr%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">ss/ssr脚本</a>, <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e6%90%ad%e5%bb%bass%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">一键搭建ss脚本</a>, <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e8%84%9a%e6%9c%ac%e6%90%ad%e5%bb%bassr/" target="_blank" rel="noopener">一键脚本搭建ssr</a>, <a href="https://www.flyzy2005.win/tag/fan-qiang/" target="_blank" rel="noopener">科学上网</a></p>
<p> <img src="https://www.flyzy2005.win/wp-content/uploads/2017/12/flyzy.jpg" alt="weinxin"><br> <strong>我的微信公众号</strong></p>
<p> “flyzy小站”：关注VPS测评与优惠，玩机教程，技术分享，留言及时回复</p>
<p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
<p> <a href="https://www.flyzy2005.win/tag/bbr%e4%b8%80%e9%94%ae/" target="_blank" rel="noopener">bbr一键</a> <a href="https://www.flyzy2005.win/tag/shadowsock/" target="_blank" rel="noopener">shadowsock</a> <a href="https://www.flyzy2005.win/tag/ss-ssr%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">ss/ssr脚本</a> <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e6%90%ad%e5%bb%bass%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">一键搭建ss脚本</a> <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e8%84%9a%e6%9c%ac%e6%90%ad%e5%bb%bassr/" target="_blank" rel="noopener">一键脚本搭建ssr</a> <a href="https://www.flyzy2005.win/tag/fan-qiang/" target="_blank" rel="noopener">科学上网</a></p>
<p> <a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/ss-clients-download/" target="_blank" rel="noopener" title="各版本shadowsocks客户端下载地址">&lt; 上一篇</a></p>
<p> <a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/free-ss-account/" target="_blank" rel="noopener" title="科学上网ss账号分享">下一篇 &gt;</a></p>
<h3 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h3><ul>
<li><a href="https://www.flyzy2005.win/v2ray/how-to-build-v2ray/" target="_blank" rel="noopener" title="一键脚本搭建V2Ray V2Ray配置与优化">一键脚本搭建V2Ray V2Ray配置与优化</a></li>
<li><a href="https://www.flyzy2005.win/tech/shadowsocks-google-scholar/" target="_blank" rel="noopener" title="shadowsocks无法打开谷歌学术或出现验证码">shadowsocks无法打开谷歌学术或出现验证码</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-mac-os-config/" target="_blank" rel="noopener" title="shadowsocks电脑版（Mac）客户端配置教程">shadowsocks电脑版（Mac）客户端配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-android-config/" target="_blank" rel="noopener" title="shadowsocks手机版（Android/安卓）客户端影梭配置教程">shadowsocks手机版（Android/安卓）客户端影梭配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-iphone-ios-config/" target="_blank" rel="noopener" title="shadowsocks手机版（iOS/苹果）客户端配置教程">shadowsocks手机版（iOS/苹果）客户端配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-pc-windows-config/" target="_blank" rel="noopener" title="shadowsocks电脑版（windows）客户端配置教程">shadowsocks电脑版（windows）客户端配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/ss-clients-baidu-cloud-download/" target="_blank" rel="noopener" title="各版本shadowsocks客户端百度云下载地址">各版本shadowsocks客户端百度云下载地址</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-manager-config/" target="_blank" rel="noopener" title="shadowsocks-manager实现ss多用户管理与流量限制">shadowsocks-manager实现ss多用户管理与流量限制</a></li>
</ul>
<h4 id="热门标签"><a href="#热门标签" class="headerlink" title="热门标签"></a>热门标签</h4><p> <a href="https://www.flyzy2005.win/tag/%e6%90%ac%e7%93%a6%e5%b7%a5/" target="_blank" rel="noopener">搬瓦工</a> <a href="https://www.flyzy2005.win/tag/linux/" target="_blank" rel="noopener">Linux</a> <a href="https://www.flyzy2005.win/tag/shadowsock%e9%85%8d%e7%bd%ae/" target="_blank" rel="noopener">shadowsock配置</a> <a href="https://www.flyzy2005.win/tag/multi-users/" target="_blank" rel="noopener">多用户</a> <a href="https://www.flyzy2005.win/tag/java%e7%bc%96%e7%a8%8b%e6%80%9d%e6%83%b3%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0/" target="_blank" rel="noopener">Java编程思想读书笔记</a> <a href="https://www.flyzy2005.win/tag/baidu-union/" target="_blank" rel="noopener">百度联盟</a> <a href="https://www.flyzy2005.win/tag/vps/" target="_blank" rel="noopener">VPS</a> <a href="https://www.flyzy2005.win/tag/iptables/" target="_blank" rel="noopener">iptables</a> <a href="https://www.flyzy2005.win/tag/jvm/" target="_blank" rel="noopener">JVM</a> <a href="https://www.flyzy2005.win/tag/shadowsock/" target="_blank" rel="noopener">shadowsock</a> <a href="https://www.flyzy2005.win/tag/utils/" target="_blank" rel="noopener">工具</a> <a href="https://www.flyzy2005.win/tag/seo/" target="_blank" rel="noopener">SEO</a> <a href="https://www.flyzy2005.win/tag/wordpress/" target="_blank" rel="noopener">WordPress</a> <a href="https://www.flyzy2005.win/tag/vultr/" target="_blank" rel="noopener">vultr</a> <a href="https://www.flyzy2005.win/tag/digitalocean/" target="_blank" rel="noopener">DigitalOcean</a> <a href="https://www.flyzy2005.win/tag/ss/" target="_blank" rel="noopener">ss</a> <a href="https://www.flyzy2005.win/tag/fan-qiang/" target="_blank" rel="noopener">科学上网</a> <a href="https://www.flyzy2005.win/tag/build-page/" target="_blank" rel="noopener">建站</a> <a href="https://www.flyzy2005.win/tag/data-structure/" target="_blank" rel="noopener">数据结构</a> <a href="https://www.flyzy2005.win/tag/cn2-vps%e6%8e%a8%e8%8d%90/" target="_blank" rel="noopener">CN2 vps推荐</a></p>
<h4 id="VPS推荐"><a href="#VPS推荐" class="headerlink" title="VPS推荐"></a>VPS推荐</h4><p>| <a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener"><img src="https://www.flyzy2005.win/wp-content/uploads/2018/04/bandwagon.png" alt="搬瓦工优惠券优惠码"></a><br><a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener"><strong>搬瓦工：</strong>年付最低仅需18.79美元</a> |<br>| <a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener"><img src="https://www.flyzy2005.win/wp-content/uploads/2018/06/vultr-logo-300-new.png" alt="vultr优惠码"></a><br><a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener"><strong>Vultr：</strong>15个数据中心，最低2.5美元/月</a> |<br>| <a href="https://www.flyzy2005.win/vps/gigsgigscloud-hk-vps/" target="_blank" rel="noopener"><img src="https://www.flyzy2005.win/wp-content/uploads/2018/07/ggc-logo.png" alt="gigsgigscloud优惠码"></a><br><a href="https://www.flyzy2005.win/vps/gigsgigscloud-hk-vps/" target="_blank" rel="noopener"><strong>GigsGigsCloud：</strong>香港VPS，三网直连</a> |</p>
<h4 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h4><ul>
<li><a href="https://www.vultryhw.com" target="_blank" rel="noopener" title="Vultr优惠网 分享Vultr的最新优惠券/优惠码/优惠活动">Vultr优惠网</a></li>
<li><a href="https://www.bwgyhw.com" target="_blank" rel="noopener" title="搬瓦工优惠网 分享BandwagonHost的最新优惠卷/优惠码/优惠活动">搬瓦工优惠网</a></li>
<li><a href="https://www.flyzy2005.win/go/?url=https://shang.qq.com/wpa/qunwpa?idkey=1e8e1c9e5c8056b05aaaa5e34f6dc9faa7b655610cc790884043b738ceebb753" target="_blank" rel="noopener" title="flyzy小站QQ交流群">QQ群组</a></li>
<li><a href="https://www.flyzy2005.win/go/go.php?url=https://t.me/flyzyxiaozhan" target="_blank" rel="noopener" title="加入群组，随意聊天">Telegram群组</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/27/%E6%82%AC%E6%B5%AE%E7%AA%97%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/27/%E6%82%AC%E6%B5%AE%E7%AA%97%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93/" class="post-title-link" itemprop="url">悬浮窗使用小结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-27 09:44:55" itemprop="dateCreated datePublished" datetime="2018-07-27T09:44:55+08:00">2018-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:11:11" itemprop="dateModified" datetime="2020-04-12T23:11:11+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="window简介"><a href="#window简介" class="headerlink" title="window简介"></a>window简介</h1><p>Window 有三种类型，分别是应用 Window、子 Window 和系统 Window。应用类 Window 对应一个 Acitivity，子 Window 不能单独存在，需要依附在特定的父 Window 中，比如常见的一些 Dialog 就是一个子 Window。系统 Window是需要声明权限才能创建的 Window，比如 Toast 和系统状态栏都是系统 Window。</p>
<p>Window 是分层的，每个 Window 都有对应的 z-ordered，层级大的会覆盖在层级小的 Window 上面，这和 HTML 中的 z-index 概念是完全一致的。在三种 Window 中，应用 Window 层级范围是 1<del>99，子 Window 层级范围是 1000</del>1999，系统 Window 层级范围是 2000<del>2999，我们可以用一个表格来直观的表示：<br>|Window|层级|<br>|—|—-|<br>|应用 Window|1</del>99|<br>|子 Window|1000<del>1999|<br>|应用 Window|2000</del>2999|<br>这些层级范围对应着 WindowManager.LayoutParams 的 type 参数，如果想要 Window 位于所有 Window 的最顶层，那么采用较大的层级即可，很显然系统 Window 的层级是最大的，当我们采用系统层级时，需要声明权限。</p>
<h1 id="悬浮窗简单使用"><a href="#悬浮窗简单使用" class="headerlink" title="悬浮窗简单使用"></a>悬浮窗简单使用</h1><p>悬浮窗通过<code>WindowManager</code>来实现，它提供的三个重要的方法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void addView(View view, ViewGroup.LayoutParams params);</span><br><span class="line">public void updateViewLayout(View view, ViewGroup.LayoutParams params);</span><br><span class="line">public void removeView(View view);</span><br></pre></td></tr></table></figure>
<p>我们只需要将需要显示的view添加到<code>windowManager</code>中即可。但是因为是系统层的显示，在<code>addView</code>时需要必要的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name&#x3D;&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>并且在android 6.0及以上的版本时，还需要申请动态权限，这里就不展开了。</p>
<h1 id="悬浮窗工具类"><a href="#悬浮窗工具类" class="headerlink" title="悬浮窗工具类"></a>悬浮窗工具类</h1><p>通过一个工具类实现通过悬浮窗实现类似于toast的效果。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">public class FloatWindowManager &#123;</span><br><span class="line"></span><br><span class="line">    private WindowManager.LayoutParams mParams;</span><br><span class="line">    private WindowManager mWindowManager;</span><br><span class="line"></span><br><span class="line">    private boolean mIsRunning &#x3D; false;</span><br><span class="line">    private boolean mIsAutoDisMiss &#x3D; true;</span><br><span class="line"></span><br><span class="line">    private TimerTask mTask;</span><br><span class="line">    private Timer mTimer;</span><br><span class="line"></span><br><span class="line">    public final static int DEFAULT_FINISH_TIME &#x3D; 2000;</span><br><span class="line">    private int mAutoDismissTime &#x3D; DEFAULT_FINISH_TIME;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager() &#123;</span><br><span class="line">        mWindowManager &#x3D; (WindowManager) HostHelper.getAppContext().getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">        mParams &#x3D; new WindowManager.LayoutParams();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager initParams() &#123;</span><br><span class="line">        if (mParams !&#x3D; null) &#123;</span><br><span class="line">            if (Build.VERSION.SDK_INT &gt;&#x3D; 26) &#123;</span><br><span class="line">                mParams.type &#x3D; WindowManager.LayoutParams.TYPE_PHONE;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                mParams.type &#x3D; WindowManager.LayoutParams.TYPE_SYSTEM_ALERT;</span><br><span class="line">            &#125;</span><br><span class="line">            mParams.flags &#x3D; WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_SCALED</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_LAYOUT_INSET_DECOR</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN;</span><br><span class="line">            mParams.format &#x3D; PixelFormat.RGBA_8888;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setLocation(int x,int y,int width,int height)&#123;</span><br><span class="line">        if (mParams!&#x3D;null)&#123;</span><br><span class="line">            mParams.x &#x3D; x;</span><br><span class="line">            mParams.y &#x3D; y;</span><br><span class="line">            mParams.height &#x3D; height;</span><br><span class="line">            mParams.width &#x3D; width;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setGravity(int gravity)&#123;</span><br><span class="line">        if (mParams!&#x3D;null)&#123;</span><br><span class="line">            mParams.gravity &#x3D; gravity;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setAnim(int anim)&#123;</span><br><span class="line">        if (mParams!&#x3D;null)&#123;</span><br><span class="line">            mParams.windowAnimations &#x3D; anim;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setAutoDismiss(boolean autoDismiss)&#123;</span><br><span class="line">        this.mIsAutoDisMiss &#x3D; autoDismiss;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public boolean show(View view) &#123;</span><br><span class="line">        if(CloudConfigUtils.getToastActivityShow())&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                if (mWindowManager !&#x3D; null &amp;&amp; mParams!&#x3D;null &amp;&amp; !mIsRunning) &#123;</span><br><span class="line">                    mWindowManager.addView(view, mParams);</span><br><span class="line">                    if (mIsAutoDisMiss)&#123;</span><br><span class="line">                        finishByTime(view);</span><br><span class="line">                    &#125;</span><br><span class="line">                    Log.d(&quot;FloatWindowManager&quot;,&quot; view is added!&quot;);</span><br><span class="line">                    mIsRunning &#x3D; true;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                mIsRunning &#x3D; false;</span><br><span class="line">                Log.d(&quot;FloatWindowManager&quot;, &quot;addView go something wrong!&quot;);</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void finishByTime(final View view)&#123;</span><br><span class="line">        mTimer &#x3D; new Timer();</span><br><span class="line">        mTask &#x3D; new TimerTask() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                finisSelf(view);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        mTimer.schedule(mTask, mAutoDismissTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void finisSelf(final View view)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            if (mWindowManager !&#x3D;null &amp;&amp; mParams!&#x3D;null &amp;&amp; mIsRunning)&#123;</span><br><span class="line">                mWindowManager.removeView(view);</span><br><span class="line">                mIsRunning &#x3D; false;</span><br><span class="line">                if (mTask!&#x3D;null)</span><br><span class="line">                    mTask &#x3D; null;</span><br><span class="line">                if (mTimer!&#x3D;null)</span><br><span class="line">                    mTimer &#x3D; null;</span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(&quot;FloatWindowManager&quot;,&quot; view is remove!&quot;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            mIsRunning &#x3D; false;</span><br><span class="line">            if (mTask!&#x3D;null)</span><br><span class="line">                mTask &#x3D; null;</span><br><span class="line">            if (mTimer!&#x3D;null)</span><br><span class="line">                mTimer &#x3D; null;</span><br><span class="line">            Log.d(&quot;FloatWindowManager&quot;, &quot;remove go something wrong!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用也很简单，只需要一行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;自定义view</span><br><span class="line">final AccountToastLayout layout &#x3D; new AccountToastLayout(mContext);</span><br><span class="line">&#x2F;&#x2F;通知测量自定义view的宽和高</span><br><span class="line">layout.measure(View.MeasureSpec.UNSPECIFIED,View.MeasureSpec.UNSPECIFIED);</span><br><span class="line">int weight &#x3D; layout.getMeasuredWidth();</span><br><span class="line">final int height &#x3D; layout.getMeasuredHeight();</span><br><span class="line">FloatWindowManager windowManager &#x3D; new FloatWindowManager();</span><br><span class="line">windowManager.initParams().setAutoDismiss(true).setAnim(R.style.anim).setGravity(Gravity.BOTTOM|Gravity.END)</span><br><span class="line">                    .setLocation(0,y,weight,height).show(layout);</span><br></pre></td></tr></table></figure>

<h2 id="windowManager中相关属性的介绍"><a href="#windowManager中相关属性的介绍" class="headerlink" title="windowManager中相关属性的介绍"></a>windowManager中相关属性的介绍</h2><h3 id="type字段介绍"><a href="#type字段介绍" class="headerlink" title="type字段介绍"></a>type字段介绍</h3><table>
<thead>
<tr>
<th>value</th>
<th>key</th>
<th align="center">作用</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>2031</td>
<td><code>TYPE_ACCESSIBILITY_OVERLAY</code></td>
<td align="center">用于拦截用户交互而不更改窗口，可访问性服务可以内省。</td>
<td>added in API level 22</td>
</tr>
<tr>
<td>2</td>
<td><code>TYPE_APPLICATION</code></td>
<td align="center">正常的应用程序窗口。token必须是标识activity所属window的标记。</td>
<td>added in API level 1</td>
</tr>
<tr>
<td>1003</td>
<td><code>TYPE_APPLICATION_ATTACHED_DIALOG</code></td>
<td align="center">类似于<code>TYPE_APPLICATION_PANEL</code>,但窗口的布局与顶层窗口的布局相同，而不是其容器的子窗口。</td>
<td>added in API level 3</td>
</tr>
<tr>
<td>1001</td>
<td><code>TYPE_APPLICATION_MEDIA</code></td>
<td align="center">用于显示媒体的窗口（例如视频）。这些窗口显示在其附加窗口后面。</td>
<td>added in API level 3</td>
</tr>
</tbody></table>
<p>….</p>
<h3 id="flag字段介绍"><a href="#flag字段介绍" class="headerlink" title="flag字段介绍"></a>flag字段介绍</h3><p>看这里<a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams" target="_blank" rel="noopener">https://developer.android.com/reference/android/view/WindowManager.LayoutParams</a></p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/yhaolpz/article/details/68936932" target="_blank" rel="noopener">Android 带你彻底理解 Window 和 WindowManager</a></li>
<li><a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams" target="_blank" rel="noopener">https://developer.android.com/reference/android/view/WindowManager.LayoutParams</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/20/PopupWindow%20%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/20/PopupWindow%20%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/" class="post-title-link" itemprop="url">PopupWindow 使用实例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-20 22:44:55" itemprop="dateCreated datePublished" datetime="2018-07-20T22:44:55+08:00">2018-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:05:09" itemprop="dateModified" datetime="2020-04-12T23:05:09+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="PopupWindow-使用实例"><a href="#PopupWindow-使用实例" class="headerlink" title="PopupWindow 使用实例"></a>PopupWindow 使用实例</h1><p><code>popupWindows</code>是一个弹出框的界面载体，类似于<code>AlertDialog</code>，但它比<code>AlertDialog</code>更加灵活，能更加精确的指定其所在的位置。<br>下面记录一下自定义popupWindows的使用。</p>
<h1 id="自定会CustomPopup，继承自PopupWindow"><a href="#自定会CustomPopup，继承自PopupWindow" class="headerlink" title="自定会CustomPopup，继承自PopupWindow"></a>自定会<code>CustomPopup</code>，继承自<code>PopupWindow</code></h1><p>具体代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class CustomPopup extends PopupWindow &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; PopupWindow中控件点击事件回调接口</span><br><span class="line">    private IPopuWindowListener mOnClickListener;</span><br><span class="line">    &#x2F;&#x2F;PopupWindow布局文件中的Button</span><br><span class="line">    private Button alarm_pop_btn;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @param s</span><br><span class="line">     * @description 构造方法</span><br><span class="line">     * @author ldm</span><br><span class="line">     * @time 2016&#x2F;9&#x2F;30 9:14</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public CustomPopup(Context mContext, int width, int height, IPopuWindowListener listener) &#123;</span><br><span class="line">        super(mContext);</span><br><span class="line"></span><br><span class="line">        this.mOnClickListener &#x3D; listener;</span><br><span class="line">        &#x2F;&#x2F;获取布局文件</span><br><span class="line">        View mContentView &#x3D; LayoutInflater.from(mContext).inflate(R.layout.popupwindow_layout, null);</span><br><span class="line">        &#x2F;&#x2F;设置布局</span><br><span class="line">        setContentView(mContentView);</span><br><span class="line">        &#x2F;&#x2F; 设置弹窗的宽度和高度</span><br><span class="line">&#x2F;&#x2F;        setWidth(width);</span><br><span class="line">&#x2F;&#x2F;        setHeight(height);</span><br><span class="line">        setWidth(WindowManager.LayoutParams.MATCH_PARENT);</span><br><span class="line">        setHeight(WindowManager.LayoutParams.WRAP_CONTENT);</span><br><span class="line">        &#x2F;&#x2F;设置能否获取到焦点</span><br><span class="line">        setFocusable(false);</span><br><span class="line">        &#x2F;&#x2F;设置PopupWindow进入和退出时的动画效果</span><br><span class="line">        setAnimationStyle(R.style.MyPopupWindow);</span><br><span class="line">        setTouchable(true); &#x2F;&#x2F; 默认是true，设置为false，所有touch事件无响应，而被PopupWindow覆盖的Activity部分会响应点击</span><br><span class="line">        &#x2F;&#x2F; 设置弹窗外可点击,此时点击PopupWindow外的范围，Popupwindow不会消失</span><br><span class="line">        setOutsideTouchable(false);</span><br><span class="line">        &#x2F;&#x2F;外部是否可以点击，设置Drawable原因可以参考：http:&#x2F;&#x2F;blog.csdn.net&#x2F;harvic880925&#x2F;article&#x2F;details&#x2F;49278705</span><br><span class="line">        setBackgroundDrawable(new BitmapDrawable());</span><br><span class="line">        &#x2F;&#x2F; 设置弹窗的布局界面</span><br><span class="line">        initUI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 初始化弹窗列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private void initUI() &#123;</span><br><span class="line">        &#x2F;&#x2F;获取到按钮</span><br><span class="line">        alarm_pop_btn &#x3D; (Button) getContentView().findViewById(R.id.alarm_pop_btn);</span><br><span class="line">        &#x2F;&#x2F;设置按钮点击事件</span><br><span class="line">        alarm_pop_btn.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View view) &#123;</span><br><span class="line">                if (null !&#x3D; mOnClickListener) &#123;</span><br><span class="line">                    mOnClickListener.dispose();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 显示弹窗列表界面</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void show(View view) &#123;</span><br><span class="line">        int[] location &#x3D; new int[2];</span><br><span class="line">        view.getLocationOnScreen(location);</span><br><span class="line">        &#x2F;&#x2F;Gravity.BOTTOM设置在view下方，还可以根据location来设置PopupWindowj显示的位置</span><br><span class="line">        int x &#x3D; location[0];</span><br><span class="line">        int y &#x3D; location[1];</span><br><span class="line">        showAtLocation(view, Gravity.BOTTOM, x, y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @param null</span><br><span class="line">     * @author ldm</span><br><span class="line">     * @description 点击事件回调处理接口</span><br><span class="line">     * @time 2016&#x2F;7&#x2F;29 15:30</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public interface IPopuWindowListener &#123;</span><br><span class="line">        void dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="xml资源文件"><a href="#xml资源文件" class="headerlink" title="xml资源文件"></a>xml资源文件</h1><p>布局资源文件：<code>popupwindow_layout.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class="line">    android:background&#x3D;&quot;#ffffff&quot;</span><br><span class="line">    android:padding&#x3D;&quot;20dp&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:clickable&#x3D;&quot;true&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center&quot;</span><br><span class="line">        android:textColor&#x3D;&quot;@android:color&#x2F;holo_orange_dark&quot;</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;alarm_pop_btn&quot;</span><br><span class="line">        android:text&#x3D;&quot;确定&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_marginTop&#x3D;&quot;20dp&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_marginBottom&#x3D;&quot;10dp&quot;</span><br><span class="line">        android:clickable&#x3D;&quot;true&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center&quot;</span><br><span class="line">        android:text&#x3D;&quot;取消&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>类型资源文件<code>styles</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;style name&#x3D;&quot;MyPopupWindow&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;item name&#x3D;&quot;android:windowEnterAnimation&quot;&gt;@anim&#x2F;pop_in&lt;&#x2F;item&gt;</span><br><span class="line">      &lt;item name&#x3D;&quot;android:windowExitAnimation&quot;&gt;@anim&#x2F;pop_out&lt;&#x2F;item&gt;</span><br><span class="line">  &lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>动画资源文件<code>pop_in</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;set xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;&gt;</span><br><span class="line">    &lt;scale</span><br><span class="line">        android:duration&#x3D;&quot;200&quot;</span><br><span class="line">        android:fromXScale&#x3D;&quot;0&quot;</span><br><span class="line">        android:fromYScale&#x3D;&quot;0&quot;</span><br><span class="line">        android:pivotX&#x3D;&quot;50%&quot;</span><br><span class="line">        android:pivotY&#x3D;&quot;50%&quot;</span><br><span class="line">        android:toXScale&#x3D;&quot;0.8&quot;</span><br><span class="line">        android:toYScale&#x3D;&quot;0.5&quot; &#x2F;&gt;</span><br><span class="line">    &lt;alpha</span><br><span class="line">        android:duration&#x3D;&quot;200&quot;</span><br><span class="line">        android:fromAlpha&#x3D;&quot;0.0&quot;</span><br><span class="line">        android:toAlpha&#x3D;&quot;1.0&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;set&gt;</span><br></pre></td></tr></table></figure>
<p>动画资源文件和<code>pop_out</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;set xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;scale</span><br><span class="line">        android:fromXScale&#x3D;&quot;0.8&quot;</span><br><span class="line">        android:fromYScale&#x3D;&quot;0.5&quot;</span><br><span class="line">        android:pivotX&#x3D;&quot;50%&quot;</span><br><span class="line">        android:pivotY&#x3D;&quot;50%&quot;</span><br><span class="line">        android:toXScale&#x3D;&quot;0&quot;</span><br><span class="line">        android:toYScale&#x3D;&quot;0&quot;</span><br><span class="line">        android:duration&#x3D;&quot;200&quot;&#x2F;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;alpha</span><br><span class="line">        android:duration&#x3D;&quot;200&quot;</span><br><span class="line">        android:fromAlpha&#x3D;&quot;1.0&quot;</span><br><span class="line">        android:toAlpha&#x3D;&quot;0.0&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;set&gt;</span><br></pre></td></tr></table></figure>

<h1 id="在activity中进行调用"><a href="#在activity中进行调用" class="headerlink" title="在activity中进行调用"></a>在activity中进行调用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class MainActivity extends AppCompatActivity implements CustomPopup.IPopuWindowListener &#123;</span><br><span class="line"></span><br><span class="line">    private CustomPopup alarmPopup;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void testPopupWindow2(View view)&#123;</span><br><span class="line">        &#x2F;&#x2F;初始化PopupWindow这里通过数据200来设置PopupWindow高度</span><br><span class="line">        alarmPopup&#x3D;new CustomPopup(MainActivity.this, ViewGroup.LayoutParams.MATCH_PARENT, 200, this);&#x2F;&#x2F;这里的this是指当前Activity实现了PopupWindow中IPopuWindowListener接口</span><br><span class="line">        &#x2F;&#x2F;弹出PopupWindow</span><br><span class="line">        alarmPopup.show(view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void dispose() &#123;</span><br><span class="line">        if (alarmPopup.isShowing()) &#123;</span><br><span class="line">            alarmPopup.dismiss();&#x2F;&#x2F;关闭PopupWindow</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>end</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/harvic880925/article/details/49272285" target="_blank" rel="noopener">https://blog.csdn.net/harvic880925/article/details/49272285</a></li>
<li><a href="https://blog.csdn.net/true100/article/details/52785496" target="_blank" rel="noopener">https://blog.csdn.net/true100/article/details/52785496</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/18/%E6%97%8B%E8%BD%AC%E5%9B%BE%E5%83%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/18/%E6%97%8B%E8%BD%AC%E5%9B%BE%E5%83%8F/" class="post-title-link" itemprop="url">旋转图像</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-18 00:00:48" itemprop="dateCreated datePublished" datetime="2018-07-18T00:00:48+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:14:03" itemprop="dateModified" datetime="2020-04-12T23:14:03+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="48-旋转图像-Rotate-Image"><a href="#48-旋转图像-Rotate-Image" class="headerlink" title="48. 旋转图像(Rotate Image)"></a><a href="https://leetcode-cn.com/problems/rotate-image/description/" target="_blank" rel="noopener">48. 旋转图像(Rotate Image)</a></h3><p>题目难度： <strong>中等</strong></p>
<p>给定一个 <em>n _× _n</em> 的二维矩阵表示一个图像。</p>
<p>将图像顺时针旋转 90 度。</p>
<p><strong>说明：</strong></p>
<p>你必须在旋转图像，这意味着你需要直接修改输入的二维矩阵。<strong>请不要</strong>使用另一个矩阵来旋转图像。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">给定 **matrix** &#x3D; </span><br><span class="line">[</span><br><span class="line">  [1,2,3],</span><br><span class="line">  [4,5,6],</span><br><span class="line">  [7,8,9]</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">**原地**旋转输入矩阵，使其变为:</span><br><span class="line">[</span><br><span class="line">  [7,4,1],</span><br><span class="line">  [8,5,2],</span><br><span class="line">  [9,6,3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>示例 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">给定 **matrix** &#x3D;</span><br><span class="line">[</span><br><span class="line">  [ 5, 1, 9,11],</span><br><span class="line">  [ 2, 4, 8,10],</span><br><span class="line">  [13, 3, 6, 7],</span><br><span class="line">  [15,14,12,16]</span><br><span class="line">], </span><br><span class="line"></span><br><span class="line">**原地**旋转输入矩阵，使其变为:</span><br><span class="line">[</span><br><span class="line">  [15,13, 2, 5],</span><br><span class="line">  [14, 3, 4, 1],</span><br><span class="line">  [12, 6, 8, 9],</span><br><span class="line">  [16, 7,10,11]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><h4 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h4><p>先上线交换，再斜角交换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">例如，原数组</span><br><span class="line">[</span><br><span class="line">  [1,2,3],</span><br><span class="line">  [4,5,6],</span><br><span class="line">  [7,8,9]</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">上下替换后：</span><br><span class="line">[</span><br><span class="line">  [7,8,9],</span><br><span class="line">  [4,5,6],</span><br><span class="line">  [1,2,3]</span><br><span class="line">],</span><br><span class="line">然后再斜角替换:</span><br><span class="line">[</span><br><span class="line">  [7,4,1],</span><br><span class="line">  [8,5,2],</span><br><span class="line">  [9,6,3]</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>实现代码。<br>Language: <strong>Java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">int</span> len = matrix.length;</span><br><span class="line">        <span class="comment">//上下反转</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len/<span class="number">2</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;len;j++)&#123;</span><br><span class="line">               <span class="keyword">int</span> temp = matrix[i][j];</span><br><span class="line">                matrix[i][j] = matrix[len-i-<span class="number">1</span>][j];</span><br><span class="line">                matrix[len-i-<span class="number">1</span>][j] = temp;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//斜角反转</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;len;j++)&#123;</span><br><span class="line">                <span class="keyword">int</span> temp = matrix[i][j];</span><br><span class="line">                 matrix[i][j] =  matrix[j][i];</span><br><span class="line">                matrix[j][i] =  temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="思路二："><a href="#思路二：" class="headerlink" title="思路二："></a>思路二：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public void rotate(int[][] matrix) &#123;</span><br><span class="line">        int N &#x3D; matrix.length;</span><br><span class="line">        int M, row, col, nextRow, nextCol, now, next, offset;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; N &#x2F; 2; i++) &#123;  &#x2F;&#x2F;圈数</span><br><span class="line">            M &#x3D; (i + 1) * 2 + (N &amp; 1);</span><br><span class="line">            for (int j &#x3D; 0; j &lt; M - 1; j++) &#123;  &#x2F;&#x2F;该圈的长度</span><br><span class="line">                offset &#x3D; N &#x2F; 2 - i - 1;</span><br><span class="line">                row &#x3D; 0;</span><br><span class="line">                col &#x3D; j;</span><br><span class="line">                now &#x3D; matrix[+offset][col + offset];</span><br><span class="line">                for (int k &#x3D; 0; k &lt; 4; k++) &#123;   &#x2F;&#x2F;换4个</span><br><span class="line">                    nextRow &#x3D; col;</span><br><span class="line">                    nextCol &#x3D; M - 1 - row;</span><br><span class="line">                    next &#x3D; matrix[nextRow + offset][nextCol + offset];</span><br><span class="line">                    matrix[nextRow + offset][nextCol + offset] &#x3D; now;</span><br><span class="line">                    now &#x3D; next;</span><br><span class="line">                    row &#x3D; nextRow;</span><br><span class="line">                    col &#x3D; nextCol;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/14/%E7%A7%BB%E5%8A%A8%E9%9B%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/14/%E7%A7%BB%E5%8A%A8%E9%9B%B6/" class="post-title-link" itemprop="url">移动零</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-14 17:22:48" itemprop="dateCreated datePublished" datetime="2018-07-14T17:22:48+08:00">2018-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:14:09" itemprop="dateModified" datetime="2020-04-12T23:14:09+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="283-移动零-Move-Zeroes"><a href="#283-移动零-Move-Zeroes" class="headerlink" title="283. 移动零(Move Zeroes)"></a><a href="https://leetcode-cn.com/problems/move-zeroes/description/" target="_blank" rel="noopener">283. 移动零(Move Zeroes)</a></h3><p>题目难度： <strong>简单</strong></p>
<p>给定一个数组 <code>nums</code>，编写一个函数将所有 <code>0</code> 移动到数组的末尾，同时保持非零元素的相对顺序。</p>
<p><strong>示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**输入:** &#96;[0,1,0,3,12]&#96;</span><br><span class="line">**输出:** &#96;[1,3,12,0,0]&#96;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>:</p>
<ol>
<li>必须在原数组上操作，不能拷贝额外的数组。</li>
<li>尽量减少操作次数。</li>
</ol>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h3 id="解题思路："><a href="#解题思路：" class="headerlink" title="解题思路："></a>解题思路：</h3><h4 id="暴力解法。"><a href="#暴力解法。" class="headerlink" title="暴力解法。"></a>暴力解法。</h4><p>从后往前遍历，当发现有0时，就其移动到最后，这个移动最后并不是仅仅将这个0和最后一个数字对调，而是将这个0之后所有的数字都往前挪一位。此法简单，暴力，时间复杂度较高，但是容易想到。代码如下：<br>Language: <strong>Java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=nums.length-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] == <span class="number">0</span>)&#123;</span><br><span class="line">                move(nums,i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> target)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=target;i&lt;nums.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            nums[i] = nums[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        nums[nums.length-<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="将0过滤掉"><a href="#将0过滤掉" class="headerlink" title="将0过滤掉"></a>将0过滤掉</h4><p>从0开始遍历数组，维护一个指针pos用于表示当前非零数组的位置，维护一个指针i用于表示当前数组遍历的位置。<br>以<code>[0,1,0,3,12]</code>为例，进行说明。<br>从0开始遍历数组，发现第一个数字为0，此时pos不做任何改变，仍然为0。<br>第二个数字为1，此时有<code>nums[pos] = nums[i]</code> 即<code>nums[0] = nums[1]</code>，且<code>pos++</code>,即此时pos=1;<br>到第三个数字又为0，此时又不做任何改变。<br>到第四个数字的时候，我们即又<code>num[1] = num[3]</code>,且<code>pos++</code> ，即此时pos = 2.<br>如此我们就通过pos指针将数组中的0过滤掉了，最后我们添加相应的0到数组后面即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public void moveZeroes(int[] nums) &#123;</span><br><span class="line">        int pos &#x3D; 0;</span><br><span class="line">        for(int i &#x3D; 0; i &lt; nums.length; i++)&#123;</span><br><span class="line">            if(nums[i] !&#x3D; 0)&#123;</span><br><span class="line">                nums[pos]&#x3D; nums[i];</span><br><span class="line">                pos++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for(;pos&lt;nums.length; pos++)&#123;</span><br><span class="line">            nums[pos] &#x3D; 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/13/%E5%8A%A0%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/13/%E5%8A%A0%E4%B8%80/" class="post-title-link" itemprop="url">加一</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-13 11:45:48" itemprop="dateCreated datePublished" datetime="2018-07-13T11:45:48+08:00">2018-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:11:02" itemprop="dateModified" datetime="2020-04-12T23:11:02+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="66-加一-Plus-One"><a href="#66-加一-Plus-One" class="headerlink" title="66. 加一(Plus One)"></a><a href="https://leetcode-cn.com/problems/plus-one/description/" target="_blank" rel="noopener">66. 加一(Plus One)</a></h3><p>题目难度： <strong>简单</strong></p>
<p>给定一个<strong>非负整数</strong>组成的<strong>非空</strong>数组，在该数的基础上加一，返回一个新的数组。</p>
<p>最高位数字存放在数组的首位， 数组中每个元素只存储一个数字。</p>
<p>你可以假设除了整数 0 之外，这个整数不会以零开头。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">**输入:** [1,2,3]</span><br><span class="line">**输出:** [1,2,4]</span><br><span class="line">**解释:** 输入数组表示数字 123。</span><br></pre></td></tr></table></figure>

<p><strong>示例 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">**输入:** [4,3,2,1]</span><br><span class="line">**输出:** [4,3,2,2]</span><br><span class="line">**解释:** 输入数组表示数字 4321。</span><br></pre></td></tr></table></figure>



<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>就是大数相加的思想，将数组倒叙，加1大于9就进一位，最后的进位标志为1时，说明需要扩充数组。实现如下<br>Language: <strong>Java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] plusOne(<span class="keyword">int</span>[] digits) &#123;</span><br><span class="line">          <span class="keyword">int</span> len = digits.length;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">int</span> temp =<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=len-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">int</span> md = digits[i]+temp;</span><br><span class="line">            <span class="keyword">if</span>(md&gt;<span class="number">9</span>)&#123;</span><br><span class="line">                temp =<span class="number">1</span>;</span><br><span class="line">                list.add(<span class="number">0</span>,md-<span class="number">10</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                temp = <span class="number">0</span>;</span><br><span class="line">                list.add(<span class="number">0</span>,md);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(temp ==<span class="number">1</span> )&#123;</span><br><span class="line">            list.add(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">            len ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> res[] = <span class="keyword">new</span> <span class="keyword">int</span>[len];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;list.size();i++)&#123;</span><br><span class="line">            res[i] = list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/11/%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86%20II/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/11/%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86%20II/" class="post-title-link" itemprop="url">两个数组的交集 II(</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-11 10:55:48" itemprop="dateCreated datePublished" datetime="2018-07-11T10:55:48+08:00">2018-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:07:58" itemprop="dateModified" datetime="2020-04-12T23:07:58+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="350-两个数组的交集-II-Intersection-of-Two-Arrays-II"><a href="#350-两个数组的交集-II-Intersection-of-Two-Arrays-II" class="headerlink" title="350. 两个数组的交集 II(Intersection of Two Arrays II)"></a><a href="https://leetcode-cn.com/problems/intersection-of-two-arrays-ii/description/" target="_blank" rel="noopener">350. 两个数组的交集 II(Intersection of Two Arrays II)</a></h3><p>题目难度： <strong>简单</strong></p>
<p>给定两个数组，写一个方法来计算它们的交集。</p>
<p><strong>例如:</strong><br>给定<em>nums1</em> = <code>[1, 2, 2, 1]</code>, <em>nums2</em> = <code>[2, 2]</code>, 返回 <code>[2, 2]</code>.</p>
<p><strong>注意：</strong></p>
<ul>
<li>输出结果中每个元素出现的次数，应与元素在两个数组中出现的次数一致。</li>
<li>我们可以不考虑输出结果的顺序。</li>
</ul>
<p><strong><strong>跟进:</strong></strong></p>
<ul>
<li>如果给定的数组已经排好序呢？你将如何优化你的算法？</li>
<li>如果 _nums1 _的大小比 _nums2 _小很多，哪种方法更优？</li>
<li>如果_nums2_的元素存储在磁盘上，内存是有限的，你不能一次加载所有的元素到内存中，你该怎么办？</li>
</ul>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p><strong>解题思路:</strong><br>先将两个数组排好序，我们需要维护两个指针，指针i用于指向nums1，指针j指向nums2。当<code>nums1[i] &gt; nums2[j]</code>时，j++,当<code>nums1[i] &lt; nums2[j]</code>，i++。我们需要寻找的情况就是有多少对nums1[i] == nums2[j]的情况，记录下来即可，记得把指针i和j往前移一位。</p>
<p>Language: <strong>Java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intersect(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">      <span class="keyword">if</span>(nums1.length ==<span class="number">0</span> || nums2.length == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">        Arrays.sort(nums1);</span><br><span class="line">        Arrays.sort(nums2);</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        List res = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">while</span>(i&lt;nums1.length &amp;&amp; j&lt;nums2.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums1[i]==nums2[j])&#123;</span><br><span class="line">                res.add(nums1[i]);</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums1[i]&gt;nums2[j])&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums1[i]&lt;nums2[j])&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> a[] = <span class="keyword">new</span> <span class="keyword">int</span>[res.size()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;res.size();k++)&#123;</span><br><span class="line">            a[k] = (<span class="keyword">int</span>) res.get(k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/11/%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/11/%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/" class="post-title-link" itemprop="url">只出现一次的数字</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-11 10:55:48" itemprop="dateCreated datePublished" datetime="2018-07-11T10:55:48+08:00">2018-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:13:50" itemprop="dateModified" datetime="2020-04-12T23:13:50+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="只出现一次的数字"><a href="#只出现一次的数字" class="headerlink" title="只出现一次的数字"></a>只出现一次的数字</h1><p>给定一个非空整数数组，除了某个元素只出现一次以外，其余每个元素均出现两次。找出那个只出现了一次的元素。<br>给定一个非空整数数组，除了某个元素只出现一次以外，其余每个元素均出现两次。找出那个只出现了一次的元素。</p>
<p><strong>说明：</strong></p>
<p>你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗？</p>
<p><strong>示例 1:</strong></p>
<p>输入: [2,2,1]<br>输出: 1</p>
<p><strong>示例 2:</strong></p>
<p>输入: [4,1,2,1,2]<br>输出: 4</p>
<h1 id="常规解法"><a href="#常规解法" class="headerlink" title="常规解法"></a>常规解法</h1><p>先排序，排完序在前后两个数字间进行比较，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int singleNumber(int[] nums) &#123;</span><br><span class="line">          Arrays.sort(nums);</span><br><span class="line">        for(int i&#x3D;0;i&lt;nums.length-1;i++)&#123;</span><br><span class="line">            if(nums[i]!&#x3D;nums[i+1])&#123;</span><br><span class="line">                return nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        return nums[nums.length-1];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="高级解法"><a href="#高级解法" class="headerlink" title="高级解法"></a>高级解法</h1><p>利用^,异或，相同为1，不同为0。利用临时变量一直异或，最终得到的一定是与众不同的的那个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int singleNumber(int[] nums) &#123;</span><br><span class="line">        int k&#x3D;0;</span><br><span class="line">        for(int i &#x3D;0 ;i&lt;nums.length;i++)&#123;</span><br><span class="line">            k^&#x3D;nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        return k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">reoger</p>
  <div class="site-description" itemprop="description">reoger</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">reoger</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
