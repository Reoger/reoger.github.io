<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"reoger.tk","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="reoger">
<meta property="og:type" content="website">
<meta property="og:title" content="reoger的记录">
<meta property="og:url" content="http://reoger.tk/page/3/index.html">
<meta property="og:site_name" content="reoger的记录">
<meta property="og:description" content="reoger">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="reoger">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://reoger.tk/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>reoger的记录</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">reoger的记录</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">--以后的你会感激现在那么努力的自己</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/26/android/android%E4%B8%AD%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/26/android/android%E4%B8%AD%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">android中的测试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-26 16:13:55" itemprop="dateCreated datePublished" datetime="2018-08-26T16:13:55+08:00">2018-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:33:22" itemprop="dateModified" datetime="2020-07-18T14:33:22+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><p>在日常的开发过程中，为了保证代码的质量和减少代码出错的机率，我们常常会通过单元测试来验证我们的代码。<br>本篇博客就是用来记录单元测试的用法，以免遗忘。</p>
<h1 id="junit-工具类"><a href="#junit-工具类" class="headerlink" title="junit 工具类"></a>junit 工具类</h1><p>在android中编写单元测试的时候，用的最多的还是<code>junit 4</code>吧，在新版的android studio中，会默认添加依赖，如果是老项目，可能需要module在<code>build.gradle</code>中添加如下的依赖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testImplementation &#39;junit:junit:4.12&#39;</span><br></pre></td></tr></table></figure>
<p>好了，环境准备完毕，然后就可以开始进行单元测试了。首先我们还是编写一个需要测试的类，简单起见就编写一个<code>a+b</code>的实现吧，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Utils &#123;</span><br><span class="line"></span><br><span class="line">    public int add(Integer a, Integer b) throws ParseException&#123;</span><br><span class="line">        if (a &#x3D;&#x3D; null || b&#x3D;&#x3D; null)&#123;</span><br><span class="line">            throw new  ParseException(&quot;param is null&quot;,0);</span><br><span class="line">        &#125;</span><br><span class="line">        return a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，就可以编写单元测试了，在window环境下，直接按<code>ctrl+shift+T</code>即可快速创建一个单元测试。如图：<br><img src="http://ovec6nnof.bkt.clouddn.com/2018-08-27_200102.png" alt="图1"></p>
<p>其中的注解我们稍后介绍，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import static org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line">public class UtilsTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAdd() throws Exception &#123;</span><br><span class="line">        Utils test &#x3D; new Utils();</span><br><span class="line">        assertEquals(3,test.add(1,3));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例如我们可以编写一个这样的测试类，使用<code>@Test</code>标识这是一个测试，利用<code>assertEquals</code>来进行判断结果是否符合预期。<br><img src="http://ovec6nnof.bkt.clouddn.com/2018-08-27_200631.png" alt="图2"><br>很明显，这个测试并没有通过，因为1+3的结果明显不是3，但这是我们的预期的结果就错了，所以就需要更改预期为4，运行后发现测试通过。<br>下面简单介绍其他的注解和方法的使用。</p>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><table>
<thead>
<tr>
<th>注解名</th>
<th>注解含义</th>
</tr>
</thead>
<tbody><tr>
<td>@Test</td>
<td>表示此方法为测试方法</td>
</tr>
<tr>
<td>@Before</td>
<td>在每个测试方法前执行，可做初始化操作</td>
</tr>
<tr>
<td>@After</td>
<td>在每个测试方法后执行，可做释放资源操作</td>
</tr>
<tr>
<td>@Ignore</td>
<td>忽略的测试方法</td>
</tr>
<tr>
<td>@BeforeClass</td>
<td>在类中所有方法前运行。此注解修饰的方法必须是static void</td>
</tr>
<tr>
<td>@AfterClass</td>
<td>在类中最后运行。此注解修饰的方法必须是static void</td>
</tr>
<tr>
<td>@RunWith</td>
<td>指定该测试类使用某个运行器</td>
</tr>
<tr>
<td>@Parameters</td>
<td>指定测试类的测试数据集合</td>
</tr>
<tr>
<td>@Rule</td>
<td>重新制定测试类中方法的行为</td>
</tr>
<tr>
<td>@FixMethodOrder</td>
<td>指定测试类中方法的执行顺序</td>
</tr>
</tbody></table>
<p>在测试流程中，上述注解的方法执行的顺序为：<strong>@BeforeClass –&gt; @Before –&gt; @Test –&gt; @After –&gt; @AfterClass</strong><br>主语其他的非流程类的测试注解，<strong>@RunWith、@Parameters、@Rule、@FixMethodOrder</strong>，稍后会进一步介绍其用法。</p>
<h3 id="使用-Parameters配置多组测试数据"><a href="#使用-Parameters配置多组测试数据" class="headerlink" title="使用@Parameters配置多组测试数据"></a>使用<code>@Parameters</code>配置多组测试数据</h3><p>在需要进行多组数据进行测试的时候，我们可能会这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertArrayEquals(new int[]&#123;3,5,9&#125;,new int[]&#123;test.add(1,2),test.add(2,3),test.add(4,5)&#125;);</span><br></pre></td></tr></table></figure>
<p>是的，上述方式可以实现测试多组数据，我们甚至可以将他们分开一条一条的测试，以便于我们快速找到测试不通过的地方。但是有一种更优雅的方式，我们可以这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(Parameterized.class)</span><br><span class="line">public class UtilsTest &#123;</span><br><span class="line">    public Point point;</span><br><span class="line"></span><br><span class="line">    public UtilsTest(Point point) &#123;</span><br><span class="line">       this.point &#x3D; point;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAdd() throws Exception &#123;</span><br><span class="line">        Utils test &#x3D; new Utils();</span><br><span class="line">        assertEquals(point.x+point.y,test.add(point.x,point.y));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Parameterized.Parameters</span><br><span class="line">    public static Collection params()&#123;</span><br><span class="line">        return Arrays.asList(new Point(1,2),new Point(3,4),new Point(5,6));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，我们在<code>UtilsTest</code>，添加了注解<code>@RunWith(Parameterized.class)</code>，用于表示次测试类的参数是可变的，然后添加了一个有参的构造方法<code>public UtilsTest(Point point)</code>，用于接受可变的参数，最后使用<code>@Parameterized.Parameters</code> 来构造参数列表，如此我们的测试类就可以实现一次运行多个测试样例了。结果如下所示：<br><img src="http://ovec6nnof.bkt.clouddn.com/2018-08-27_205446.png" alt="图3"></p>
<h3 id="测试抛出异常"><a href="#测试抛出异常" class="headerlink" title="测试抛出异常"></a>测试抛出异常</h3><p>当我们需要测试传入异常参数时，是否会如预想的一样抛出异常，这个时候我们就可以使用到<code>@test</code>注解中的<code>expected</code>属性，例如，我们还是测试上面的a+b,测试代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test(expected &#x3D; ParseException.class)</span><br><span class="line">public void testAdd() throws Exception &#123;</span><br><span class="line">    Utils test &#x3D; new Utils();</span><br><span class="line">    assertEquals(5,test.add(null,5));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在测试类中，我们传入了<code>null</code>到<code>add</code>方法中，我们预想这种肯定会出现异常，所以我们在<code>Test</code>注解中添加了<code>expected</code>来捕获<code>ParseException</code>异常，如果捕获到这个异常，此时通过，如果没有捕获到这个异常，则这个测试方法会主动抛出<code>ParseException</code>异常，并说名测试不通过。</p>
<h3 id="Assert类的主要用法"><a href="#Assert类的主要用法" class="headerlink" title="Assert类的主要用法"></a>Assert类的主要用法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>方法描述</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>断言传入的预期值与实际值是相等的</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>断言传入的预期值与实际值是不相等的</td>
</tr>
<tr>
<td>assertArrayEquals</td>
<td>断言传入的预期数组与实际数组是相等的</td>
</tr>
<tr>
<td>assertNull</td>
<td>断言传入的对象是为空</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>断言传入的对象是不为空</td>
</tr>
<tr>
<td>assertTrue</td>
<td>断言条件为真</td>
</tr>
<tr>
<td>assertFalse</td>
<td>断言条件为假</td>
</tr>
<tr>
<td>assertSame</td>
<td>断言两个对象引用同一个对象，相当于“==”</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>断言两个对象引用不同的对象，相当于“!=”</td>
</tr>
<tr>
<td>assertThat</td>
<td>断言实际值是否满足指定的条件</td>
</tr>
</tbody></table>
<h2 id="匹配器"><a href="#匹配器" class="headerlink" title="匹配器"></a>匹配器</h2><table>
<thead>
<tr>
<th>匹配器</th>
<th>说明</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>is</td>
<td>断言参数等于后面给出的匹配表达式</td>
<td>assertThat(5, is (5));</td>
</tr>
<tr>
<td>not</td>
<td>断言参数不等于后面给出的匹配表达式</td>
<td>assertThat(5, not(6));</td>
</tr>
<tr>
<td>equalTo</td>
<td>断言参数相等</td>
<td>assertThat(30, equalTo(30));</td>
</tr>
<tr>
<td>equalToIgnoringCase</td>
<td>断言字符串相等忽略大小写</td>
<td>assertThat(“Ab”, equalToIgnoringCase(“ab”));</td>
</tr>
<tr>
<td>containsString</td>
<td>断言字符串包含某字符串</td>
<td>assertThat(“abc”, containsString(“bc”));</td>
</tr>
<tr>
<td>startsWith</td>
<td>断言字符串以某字符串开始</td>
<td>assertThat(“abc”, startsWith(“a”));</td>
</tr>
<tr>
<td>endsWith</td>
<td>断言字符串以某字符串结束</td>
<td>assertThat(“abc”, endsWith(“c”));</td>
</tr>
<tr>
<td>nullValue</td>
<td>断言参数的值为null</td>
<td>assertThat(null, nullValue());</td>
</tr>
<tr>
<td>notNullValue</td>
<td>断言参数的值不为null</td>
<td>assertThat(“abc”, notNullValue());</td>
</tr>
<tr>
<td>greaterThan</td>
<td>断言参数大于</td>
<td>assertThat(4, greaterThan(3));</td>
</tr>
<tr>
<td>lessThan</td>
<td>断言参数小于</td>
<td>assertThat(4, lessThan(6));</td>
</tr>
<tr>
<td>greaterThanOrEqualTo</td>
<td>断言参数大于等于</td>
<td>assertThat(4, greaterThanOrEqualTo(3));</td>
</tr>
<tr>
<td>lessThanOrEqualTo</td>
<td>断言参数小于等于</td>
<td>assertThat(4, lessThanOrEqualTo(6));</td>
</tr>
<tr>
<td>closeTo</td>
<td>断言浮点型数在某一范围内</td>
<td>assertThat(4.0, closeTo(2.6, 4.3));</td>
</tr>
<tr>
<td>allOf</td>
<td>断言符合所有条件，相当于&amp;&amp;</td>
<td>assertThat(4,allOf(greaterThan(3), lessThan(6)));</td>
</tr>
<tr>
<td>anyOf</td>
<td>断言符合某一条件，相当于或</td>
<td>assertThat(4,anyOf(greaterThan(9), lessThan(6)));</td>
</tr>
<tr>
<td>hasKey</td>
<td>断言Map集合含有此键</td>
<td>assertThat(map, hasKey(“key”));</td>
</tr>
<tr>
<td>hasValue</td>
<td>断言Map集合含有此值</td>
<td>assertThat(map, hasValue(value));</td>
</tr>
<tr>
<td>hasItem</td>
<td>断言迭代对象含有此元素</td>
<td>assertThat(list, hasItem(element));</td>
</tr>
</tbody></table>
<h1 id="UI测试"><a href="#UI测试" class="headerlink" title="UI测试"></a>UI测试</h1><p>上述的单元测试虽然功能很强大，但是局限性也很大，比如不能测试UI相关的，不能测试与<code>Context</code>相关的方法。我们可以利用Ui测试来进行这方面的测试。<br>关于ui测试，请参考这篇<a href="https://juejin.im/post/5b66de2c6fb9a04fbd1b4725" target="_blank" rel="noopener">博客</a>，实在写的太好了。<br>关于android studio中的Ui测试，可以参考<a href="https://developer.android.com/studio/test/espresso-test-recorder" target="_blank" rel="noopener">官方文档</a>。<br>这里仅记录一下使用心得：</p>
<h2 id="espresso必要的依赖"><a href="#espresso必要的依赖" class="headerlink" title="espresso必要的依赖"></a>espresso必要的依赖</h2><p>在<code>module</code>中的<code>build.gradle</code>中添加下面三条依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">androidTestImplementation &#39;com.android.support.test:runner:1.0.2&#39;</span><br><span class="line">androidTestImplementation &#39;com.android.support.test:rules:1.0.2&#39;</span><br><span class="line">androidTestImplementation &#39;com.android.support.test.espresso:espresso-core:3.0.2&#39;</span><br></pre></td></tr></table></figure>
<p>使用示例：<br>譬如在<code>MainActivity</code>中添加有一个如下的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity  &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">    * 需要测试的方法,简单的调起浏览器打开baidu首页</span><br><span class="line">    **&#x2F;</span><br><span class="line">    public static void startActiviy(Context context)&#123;</span><br><span class="line">        Uri uri &#x3D; Uri.parse(&quot;http:&#x2F;&#x2F;wwww.baidu.com&quot;);</span><br><span class="line">        Intent t &#x3D; new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        t.setData(uri);</span><br><span class="line">        t.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        context.startActivity(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，我们还是可以选择<code>ctrl+shift+T</code>来创建测试类，选择<code>android test</code>目录即可。<br>然后我们可以编写一个类似于这样类来进行测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * Instrumented test, which will execute on an Android device.</span><br><span class="line"> *</span><br><span class="line"> * @see &lt;a href&#x3D;&quot;http:&#x2F;&#x2F;d.android.com&#x2F;tools&#x2F;testing&quot;&gt;Testing documentation&lt;&#x2F;a&gt;</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">public class ExampleInstrumentedTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void useAppContext() throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F; Context of the app under test.</span><br><span class="line">        Context appContext &#x3D; InstrumentationRegistry.getTargetContext();</span><br><span class="line"></span><br><span class="line">        assertEquals(&quot;com.example.cm.testpulgin&quot;, appContext.getPackageName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testOpenUrl()&#123;</span><br><span class="line">        MainActivity.startActiviy(InstrumentationRegistry.getTargetContext());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test1()&#123;</span><br><span class="line">        assertEquals(1,1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们选择运行，选择目标手机，即可在手机上实现测试。这里关键的一点是利用<code>InstrumentationRegistry.getTargetContext()</code>获取到了<code>Context</code>对象。<br>我们可以利用这个<code>Context</code>对象来测试与手机密切相关的一些属性了，前面的单元测试只能测试代码在jvm上是否运行正常，而到了这里我们就可以测试代码是否在手机上运行正常了。<br>譬如我们要测试一些用户的操作的行为是否符合预期，我们可以写一个类似于这样的测试类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@LargeTest</span><br><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">public class MainActivityTest &#123;</span><br><span class="line"></span><br><span class="line">    @Rule</span><br><span class="line">    public ActivityTestRule&lt;MainActivity&gt; mActivityTestRule &#x3D; new ActivityTestRule&lt;&gt;(MainActivity.class);</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void mainActivityTest() &#123;</span><br><span class="line">        ViewInteraction button &#x3D; onView(</span><br><span class="line">                allOf(withId(R.id.but1),</span><br><span class="line">                        childAtPosition(</span><br><span class="line">                                childAtPosition(</span><br><span class="line">                                        withId(android.R.id.content),</span><br><span class="line">                                        0),</span><br><span class="line">                                0),</span><br><span class="line">                        isDisplayed()));</span><br><span class="line">        button.check(matches(isDisplayed()));</span><br><span class="line"></span><br><span class="line">        ViewInteraction appCompatButton &#x3D; onView(</span><br><span class="line">                allOf(withId(R.id.but1), withText(&quot;测试hook-ams&quot;),</span><br><span class="line">                        childAtPosition(</span><br><span class="line">                                childAtPosition(</span><br><span class="line">                                        withId(android.R.id.content),</span><br><span class="line">                                        0),</span><br><span class="line">                                0),</span><br><span class="line">                        isDisplayed()));</span><br><span class="line">        appCompatButton.perform(click());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static Matcher&lt;View&gt; childAtPosition(</span><br><span class="line">            final Matcher&lt;View&gt; parentMatcher, final int position) &#123;</span><br><span class="line"></span><br><span class="line">        return new TypeSafeMatcher&lt;View&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void describeTo(Description description) &#123;</span><br><span class="line">                description.appendText(&quot;Child at position &quot; + position + &quot; in parent &quot;);</span><br><span class="line">                parentMatcher.describeTo(description);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public boolean matchesSafely(View view) &#123;</span><br><span class="line">                ViewParent parent &#x3D; view.getParent();</span><br><span class="line">                return parent instanceof ViewGroup &amp;&amp; parentMatcher.matches(parent)</span><br><span class="line">                        &amp;&amp; view.equals(((ViewGroup) parent).getChildAt(position));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对其中的一些方法进行简单说明：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>click()</td>
<td>点击view</td>
</tr>
<tr>
<td>clearText()</td>
<td>清除文本内容</td>
</tr>
<tr>
<td>swipeLeft()</td>
<td>从右往左滑</td>
</tr>
<tr>
<td>swipeRight()</td>
<td>从左往右滑</td>
</tr>
<tr>
<td>swipeDown()</td>
<td>从上往下滑</td>
</tr>
<tr>
<td>swipeUp()</td>
<td>从下往上滑</td>
</tr>
<tr>
<td>click()</td>
<td>点击view</td>
</tr>
<tr>
<td>closeSoftKeyboard()</td>
<td>关闭软键盘</td>
</tr>
<tr>
<td>pressBack()</td>
<td>按下物理返回键</td>
</tr>
<tr>
<td>doubleClick()</td>
<td>双击</td>
</tr>
<tr>
<td>longClick()</td>
<td>长按</td>
</tr>
<tr>
<td>scrollTo()</td>
<td>滚动</td>
</tr>
<tr>
<td>replaceText()</td>
<td>替换文本</td>
</tr>
<tr>
<td>openLinkWithText()</td>
<td>打开指定超链</td>
</tr>
</tbody></table>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/qq_17766199/article/details/78243176" target="_blank" rel="noopener">Android单元测试(一)：JUnit框架的使用</a></li>
<li><a href="https://developer.android.com/studio/test/espresso-test-recorder" target="_blank" rel="noopener">使用 Espresso 测试记录器创建界面测试</a></li>
<li><a href="https://developer.android.com/studio/test/#run_a_test" target="_blank" rel="noopener">测试应用</a></li>
<li><a href="https://juejin.im/post/5b66de2c6fb9a04fbd1b4725" target="_blank" rel="noopener">解放双手 - Android 开发应该尝试的 UI 自动化测试</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/22/reprint/WebView%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/22/reprint/WebView%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">散记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-22 14:44:55" itemprop="dateCreated datePublished" datetime="2018-08-22T14:44:55+08:00">2018-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:41:01" itemprop="dateModified" datetime="2020-07-18T14:41:01+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reprint/" itemprop="url" rel="index"><span itemprop="name">reprint</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="WebView缓存原理分析和应用"><a href="#WebView缓存原理分析和应用" class="headerlink" title="WebView缓存原理分析和应用"></a>WebView缓存原理分析和应用</h1><p>发表于 2017-05-13 | 分类于 <a href="http://unclechen.github.io/2017/05/13/WebView%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8/" target="_blank" rel="noopener">技术</a> |<a href="/2017/05/13/WebView缓存原理分析和应用/#comments"></a></p>
<h1 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a><a href="#一、背景" title="一、背景"></a>一、背景</h1><p>现在的App开发，或多或少都会用到Hybrid模式，到了WebView这边，经常会加载一些js文件（例如和WebView用来Native通信的bridge.js），而这些js文件不会经常发生变化，所以我们希望js在WebView里面加载一次之后，如果js没有发生变化，下次就不用再发起网络请求去加载，从而减少流量和资源的占用。那么有什么方式可以达到这个目的呢？先得从WebView的缓存原理入手。</p>
<h1 id="二、WebView的缓存类型"><a href="#二、WebView的缓存类型" class="headerlink" title="二、WebView的缓存类型"></a><a href="#二、WebView的缓存类型" title="二、WebView的缓存类型"></a>二、WebView的缓存类型</h1><p>WebView主要包括两类缓存，<strong>一类是浏览器自带的网页数据缓存</strong>，这是所有的浏览器都支持的、由HTTP协议定义的缓存；<strong>另一类是H5缓存</strong>，这是由web页面的开发者设置的，H5缓存主要包括了App Cache、DOM Storage、Local Storage、Web SQL Database 存储机制等，这里我们主要介绍App Cache来缓存js文件。</p>
<h1 id="三、浏览器自带的网页数据缓存"><a href="#三、浏览器自带的网页数据缓存" class="headerlink" title="三、浏览器自带的网页数据缓存"></a><a href="#三、浏览器自带的网页数据缓存" title="三、浏览器自带的网页数据缓存"></a>三、浏览器自带的网页数据缓存</h1><h2 id="1-工作原理"><a href="#1-工作原理" class="headerlink" title="1.工作原理"></a><a href="#1-工作原理" title="1.工作原理"></a>1.工作原理</h2><p>浏览器缓存机制是通过HTTP协议Header里的Cache-Control（或Expires）和Last-Modified（或 Etag）等字段来控制文件缓存的机制。关于这几个字段的作用和浏览器的缓存更新机制，大家可以看看这两篇文章(<a href="http://bugly.qq.com/bbs/forum.php?mod=viewthread&tid=267" target="_blank" rel="noopener">H5 缓存机制浅析 移动端 Web 加载性能优化</a>，<a href="http://www.jianshu.com/p/5e7075f4875f" target="_blank" rel="noopener">Android：手把手教你构建 WebView 的缓存机制 &amp; 资源预加载方案</a>)，里面有详细的介绍。下面从我实际应用的角度，介绍一下通常会在HTTP协议中遇到的Header。</p>
<p>这两个字段是<strong>接收响应时，浏览器决定文件是否需要被缓存；或者需要加载文件时，浏览器决定是否需要发出请求</strong>的字段。</p>
<ul>
<li><p><strong>Cache-Control:max-age=315360000，</strong>这表示缓存时长为315360000秒。如果315360000秒内需要再次请求这个文件，那么浏览器不会发出请求，直接使用本地的缓存的文件。这是HTTP/1.1标准中的字段。</p>
</li>
<li><p><strong>Expires: Thu, 31 Dec 2037 23:55:55 GMT，</strong>这表示这个文件的过期时间是2037年12月31日晚上23点55分55秒，在这个时间之前浏览器都不会再次发出请求去获取这个文件。这是HTTP/1.0中的字段，如果客户端和服务器时间不同步会导致缓存出现问题，因此才有了上面的Cache-Control，当它们同时出现在HTTP Response的Header中时，Cache-Control优先级更高。</p>
</li>
</ul>
<p>下面两个字段是<strong>发起请求时，服务器决定文件是否需要更新</strong>的字段。</p>
<ul>
<li><p><strong>Last-Modified:Wed, 28 Sep 2016 09:24:35 GMT，</strong>这表示这个文件最后的修改时间是2016年9月28日9点24分35秒。这个字段对于浏览器来说，会在下次请求的时候，作为Request Header的If-Modified-Since字段带上。例如浏览器缓存的文件已经超过了Cache-Control（或者Expires），那么需要加载这个文件时，就会发出请求，请求的Header有一个字段为<code>If-Modified-Since：Wed, 28 Sep 2016 09:24:35 GMT</code>，服务器接收到请求后，会把文件的Last-Modified时间和这个时间对比，如果时间没变，那么浏览器将返回<code>304 Not Modified</code>给浏览器，且content-length肯定是0个字节。如果时间有变化，那么服务器会返回<code>200 OK</code>，并返回相应的内容给浏览器。</p>
</li>
<li><p><strong>ETag:”57eb8c5c-129”，</strong>这是文件的特征串。功能同上面的Last-Modified是一样的。只是在浏览器下次请求时，ETag是作为Request Header中的<code>If-None-Match:&quot;57eb8c5c-129&quot;</code>字段传到服务器。服务器和最新的文件特征串对比，如果相同那么返回<code>304 Not Modified</code>，不同则返回<code>200 OK</code>。当ETag和Last-Modified同时出现时，任何一个字段只要生效了，就认为文件是没有更新的。</p>
</li>
</ul>
<h2 id="2-WebView如何设置才能支持上面的协议"><a href="#2-WebView如何设置才能支持上面的协议" class="headerlink" title="2.WebView如何设置才能支持上面的协议"></a><a href="#2-WebView如何设置才能支持上面的协议" title="2.WebView如何设置才能支持上面的协议"></a>2.WebView如何设置才能支持上面的协议</h2><p>由上面的介绍可知，只要是个主流的、合格的浏览器，都应该能够支持HTTP协议层面的这几个字段。这不是我们开发者可以修改的，也不是我们应该修改的配置。在Android上，我们的WebView也支持这几个字段。但是我们可以通过代码去<strong>设置WebView的Cache Mode</strong>，而使得协议生效或者无效。WebView有下面几个Cache Mode：</p>
<ul>
<li>LOAD_CACHE_ONLY: 不使用网络，只读取本地缓存数据。</li>
<li>LOAD_DEFAULT: 根据cache-control决定是否从网络上取数据。</li>
<li>LOAD_CACHE_NORMAL: API level 17中已经废弃，从API level 11开始作用同LOAD_DEFAULT模式</li>
<li>LOAD_NO_CACHE: 不使用缓存，只从网络获取数据。</li>
<li>LOAD_CACHE_ELSE_NETWORK，只要本地有，无论是否过期，或者no-cache，都使用缓存中的数据。本地没有缓存时才从网络上获取。</li>
</ul>
<p>设置WebView缓存的Cache Mode示例代码如下：</p>
<p>1</p>
<p>2</p>
<p>WebSettings settings = webView.getSettings();</p>
<p>settings.setCacheMode(WebSettings.LOAD_DEFAULT);</p>
<p>网上很多人都说根据网络条件去选择Cache Mode，当有网络时，设置为LOAD_DEFAULT，当没有网络时设置为LOAD_CACHE_ELSE_NETWORK。但是在我的业务中，js文件的更新都是非覆盖式的更新，也就是时候每次改变js文件的时候，文件的url地址一定会发生变化，所以我希望浏览器能够缓存下来js，并且一直使用它，那么我就给它只设置为LOAD_CACHE_ELSE_NETWORK。当然如果你要是可以改js的cdn服务器的Cache-Control字段，那也行啊，用LOAD_DEFAULT就ok了。至于文件是应该采用覆盖式or非覆盖式的更新，不是我今天要讨论的内容，在web前端领域，这是一个可以聊聊的topic。</p>
<blockquote>
<p>关于iOS的WebView，我同事在实际测试的时候竟然发现，控制文件缓存的Response Header是Expires字段。。而且iOS无法针对整个WebView设置Cache Mode，只能针对每一个URLRequest去设置。。后续有机会要学习一下iOS那块的情况。</p>
</blockquote>
<h2 id="3-在手机里面的存储路径"><a href="#3-在手机里面的存储路径" class="headerlink" title="3.在手机里面的存储路径"></a><a href="#3-在手机里面的存储路径" title="3.在手机里面的存储路径"></a>3.在手机里面的存储路径</h2><p>浏览器默认缓存下来的文件是怎么被存储到了哪里呢？这个问题在接触到WebView以来，就一直是一个谜题。这次由于工作的需要，我特意root了两台手机，一台红米1（Android 4.4）和一台小米4c（Android 5.1），在root高系统版本（6.0和7.1）的两台Nexus都以失败告终之后，我决定还是先看看4.4和5.1系统上，WebView自带的缓存存到了哪里。</p>
<p>首先，不用思考就知道，这些文件一定是在<strong>/data/data/包名/</strong>目录下，在我之前的一篇博客里面提到过，这是每一个应用自己的内部存储目录。</p>
<p>接着，我们打开终端，使用adb连接手机，然后按照下面命令操作一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 1.先进入shell</span><br><span class="line"></span><br><span class="line">adb shell</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 2.开启root账号 </span><br><span class="line"></span><br><span class="line">su</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 3.修改文件夹权限</span><br><span class="line"></span><br><span class="line">chmod 777 data&#x2F;data&#x2F;你的应用包名&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 4.修改子文件夹的权限，因为Android命令行不支持向Linux那样的-R命令实现递归式的chmod。。。</span><br><span class="line"></span><br><span class="line">chmod 777 data&#x2F;data&#x2F;你的应用包名&#x2F;*</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 5.所以如果你对应用目录层级更深，你就要进一步地chmod。。。</span><br><span class="line"></span><br><span class="line">chmod 777 data&#x2F;data&#x2F;你的应用包名&#x2F;*&#x2F;*</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 6.直到终端里提示你说，no such file or directory时，说明chmod完了，所有的内部存储里面的文件夹和文件都可以看到了，如果大家有更好的方法请一定告诉我，多谢了~</span><br></pre></td></tr></table></figure>

<ul>
<li>Android 4.4的目录：<code>/data/data/包名/app_webview/cache/</code>，如下图所示的第二个文件夹。</li>
</ul>
<p><a href="https://ww4.sinaimg.cn/large/006tNc79ly1ffjvarjyijj30jg05k0yr.jpg" target="_blank" rel="noopener"><img src="https://ww4.sinaimg.cn/large/006tNc79ly1ffjvarjyijj30jg05k0yr.jpg" alt="Android4.4系统WebView自带缓存路径"></a></p>
<p>可能你注意到了，第一个文件夹是叫Application Cache，我们后面再说它。</p>
<ul>
<li>Android 5.1的目录：<code>/data/data/包名/cache/org.chromium.android_webview/</code>下面，如下图所示。</li>
</ul>
<p><a href="https://ww2.sinaimg.cn/large/006tNc79ly1ffjvztg93zj30jg0a247x.jpg" target="_blank" rel="noopener"><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ffjvztg93zj30jg0a247x.jpg" alt=""></a></p>
<p>但是在5.1系统上，<code>/data/data/包名/app_webview/</code>文件夹依然存在，只是4.4系统上面存储WebView自带缓存的<code>app_webview/cache</code>文件夹不再存在了（注意下App Cache目录还在），如下图所示。</p>
<p><a href="https://ww3.sinaimg.cn/large/006tNc79ly1ffjw46ygoqj30jg06443v.jpg" target="_blank" rel="noopener"><img src="https://ww3.sinaimg.cn/large/006tNc79ly1ffjw46ygoqj30jg06443v.jpg" alt="Android5.1系统WebView自带缓存路径"></a></p>
<p>综上所述，WebView自带的浏览器协议支持的缓存，在不同的系统版本上，位置是不一样的。也许除了我root过的4.4、5.1以外，其他版本系统的WebView自带缓存还可能存在于不同的目录里面。</p>
<p>另外一个是关于<strong>缓存文件的存储格式和索引格式</strong>，在不同的手机上可能也有差别，因为之前看到网上的人都说有叫<strong>webview.db</strong>或者<strong>webviewCache.db</strong>的文件，这个文件呢，还不是在<code>app_webview/cache</code>或者<code>org.chromium.android_webview</code>下面，而是在<code>/data/data/包名/database/</code>里面。但是，我这两台root过的手机都没有看到这种文件，而且我把<code>/data/data/包名/</code>下面所有的db文件都打开看了，并没有发现有存储url记录的table。。</p>
<p>实际上，以5.1系统为例，我看到了<code>/data/data/包名/cache/org.chromium.android_webview/</code>下面有叫<strong>index</strong>和<strong>/index-dir/the-real-index</strong>的文件，以及一堆名称为<strong>md5+下划线+数字</strong>的文件，上面的图中也可以看得到，这块的原理仍然有些疑问，也希望专业的大神可以解答一下。</p>
<h1 id="四、H5的缓存"><a href="#四、H5的缓存" class="headerlink" title="四、H5的缓存"></a><a href="#四、H5的缓存" title="四、H5的缓存"></a>四、H5的缓存</h1><p>讲完了WebView自带的缓存，下面讲一下H5里面的App Cache。这个Cache是由开发Web页面的开发者控制的，而不是由Native去控制的，但是Native里面的WebView也需要我们做一下设置才能支持H5的这个特性。</p>
<h2 id="1-工作原理-1"><a href="#1-工作原理-1" class="headerlink" title="1.工作原理"></a><a href="#1-工作原理-1" title="1.工作原理"></a>1.工作原理</h2><p>写Web页面代码时，指定manifest属性即可让页面使用App Cache。通常html页面代码会这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;html manifest&#x3D;&quot;xxx.appcache&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>xxx.appcache文件用的是相对路径，这时appcache文件的路径是和页面一样的。也可以使用的绝对路径，但是域名要保持和页面一致。</p>
<p>完整的xxx.appcache文件一般包括了3个section，基本格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CACHE MANIFEST</span><br><span class="line"></span><br><span class="line">\# 2017-05-13 v1.0.0</span><br><span class="line"></span><br><span class="line">&#x2F;bridge.js</span><br><span class="line"></span><br><span class="line">NETWORK:</span><br><span class="line"></span><br><span class="line">*</span><br><span class="line"></span><br><span class="line">FALLBACK:</span><br><span class="line"></span><br><span class="line">&#x2F;404.html</span><br></pre></td></tr></table></figure>
<ul>
<li>CACHE MANIFEST下面文件就是要被浏览器缓存的文件</li>
<li>NETWORK下面的文件就是要被加载的文件</li>
<li>FALLBACK下面的文件是目标页面加载失败时的显示的页面</li>
</ul>
<p><strong>AppCache工作的原理：</strong>当一个设置了manifest文件的html页面被加载时，CACHE MANIFEST指定的文件就会被缓存到浏览器的App Cache目录下面。当下次加载这个页面时，会首先应用通过manifest已经缓存过的文件，然后发起一个加载xxx.appcache文件的请求到服务器，如果xxx.appcache文件没有被修改过，那么服务器会返回<code>304 Not Modified</code>给到浏览器，如果xxx.appcache文件被修改过，那么服务器会返回<code>200 OK</code>，并返回新的xxx.appcache文件的内容给浏览器，浏览器收到之后，再把新的xxx.appcache文件中指定的内容加载过来进行缓存。</p>
<p>可以看到，AppCache缓存需要在每次加载页面时都发出一个xxx.appcache的请求去检查manifest文件是不是有更新（byte by byte）。根据这篇文章（<a href="http://bugly.qq.com/bbs/forum.php?mod=viewthread&tid=267" target="_blank" rel="noopener">H5 缓存机制浅析 移动端 Web 加载性能优化</a>）的介绍，AppCache有一些坑的地方，且官方已经不推荐使用了，但目前主流的浏览器依然是支持的。文章里主要提到下面这些坑：</p>
<ul>
<li>要更新缓存的文件，需要更新包含它的 manifest 文件，那怕只加一个空格。常用的方法，是修改 manifest 文件注释中的版本号。如：# 2012-02-21 v1.0.0</li>
<li>被缓存的文件，浏览器是先使用，再通过检查 manifest 文件是否有更新来更新缓存文件。这样缓存文件可能用的不是最新的版本。</li>
<li>在更新缓存过程中，如果有一个文件更新失败，则整个更新会失败。</li>
<li>manifest 和引用它的HTML要在相同 HOST。</li>
<li>manifest 文件中的文件列表，如果是相对路径，则是相对 manifest 文件的相对路径。</li>
<li>manifest 也有可能更新出错，导致缓存文件更新失败。</li>
<li>没有缓存的资源在已经缓存的 HTML 中不能加载，即使有网络。例如：[url=]<a href="http://appcache-demo.s3-website-us-east-1.amazonaws.com/without-network/[/url" target="_blank" rel="noopener">http://appcache-demo.s3-website-us-east-1.amazonaws.com/without-network/[/url</a>]</li>
<li>manifest 文件本身不能被缓存，且 manifest 文件的更新使用的是浏览器缓存机制。所以 manifest 文件的 Cache-Control 缓存时间不能设置太长。</li>
</ul>
<h2 id="2-WebView如何设置才能支持AppCache"><a href="#2-WebView如何设置才能支持AppCache" class="headerlink" title="2.WebView如何设置才能支持AppCache"></a><a href="#2-WebView如何设置才能支持AppCache" title="2.WebView如何设置才能支持AppCache"></a>2.WebView如何设置才能支持AppCache</h2><p>WebView默认是没有开启AppCache支持的，需要添加下面这几行代码来设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">WebSettings webSettings &#x3D; webView.getSettings();</span><br><span class="line"></span><br><span class="line">webSettings.setAppCacheEnabled(true);</span><br><span class="line"></span><br><span class="line">String cachePath &#x3D; getApplicationContext().getCacheDir().getPath(); &#x2F;&#x2F; 把内部私有缓存目录&#39;&#x2F;data&#x2F;data&#x2F;包名&#x2F;cache&#x2F;&#39;作为WebView的AppCache的存储路径</span><br><span class="line"></span><br><span class="line">webSettings.setAppCachePath(cachePath);</span><br><span class="line"></span><br><span class="line">webSettings.setAppCacheMaxSize(5 * 1024 * 1024);</span><br></pre></td></tr></table></figure>

<p>注意：WebSettings的setAppCacheEnabled和setAppCachePath都必须要调用才行。</p>
<h2 id="3-存储AppCache的路径"><a href="#3-存储AppCache的路径" class="headerlink" title="3.存储AppCache的路径"></a><a href="#3-存储AppCache的路径" title="3.存储AppCache的路径"></a>3.存储AppCache的路径</h2><p>按照Android SDK的API说明，setAppCachePath是可以用来设置AppCache路径的，但是我实际测试发现，不管你怎么设置这个路径，设置到应用自己的内部私有目录还是外部SD卡，都无法生效。AppCache缓存文件最终都会存到<code>/data/data/包名/app_webview/cache/Application Cache</code>这个文件夹下面，在上面的Android 4.4和5.1系统目录截图可以看得到，<strong>但是如果你不调用setAppCachePath方法，WebView将不会产生这个目录</strong>。这里有点让我觉得奇怪，我猜测可能从某一个系统版本开始，为了缓存文件的完整性和安全性考虑，SDK实现的时候就吧AppCache缓存目录设置到了内部私有存储。</p>
<h1 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a><a href="#五、总结" title="五、总结"></a>五、总结</h1><h2 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a><a href="#相同点" title="相同点"></a>相同点</h2><p>WebView自带的缓存和AppCache都是可以用来做文件级别的缓存的，基本上比较好地满足对于非覆盖式的js、css等文件更新。</p>
<h2 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a><a href="#不同点" title="不同点"></a>不同点</h2><ul>
<li>WebView自带的缓存是是协议层实现的（浏览器内核标准实现，开发者无法改变）；而AppCache是应用层实现的。</li>
<li>WebView的缓存目录在不同系统上可能是不同的；而对于AppCache而言，AppCache的存储路径虽然有方法设置，但是最终都存储到了一个固定的内部私有目录下。</li>
<li>WebView自带的缓存可以在缓存生效的时候不用再发HTTP请求；而AppCache一定会发出一个manifest文件的请求。</li>
<li>WebView自带的缓存可以通过设置CacheMode来改变WebView的缓存机制；而AppCache的缓存策略是由manifest文件控制的，也就是说是由web页面开发者控制的。</li>
</ul>
<p>最后说一下，其实很多时候，这两类缓存是共同在工作的，当manifest文件没有控制某些资源加载时，例如我上面写的xxx.appcache文件里，NETWORK section下面用的是*号，意思是所有不缓存的文件都要去网络加载。此时，这些资源就会走到WebView自带的缓存机制去，结合WebView的CacheMode，我们实际上对这些文件进行了一次WebView自带的缓存。搞清楚这两类缓存的原理有利于我们更好的设计自己的页面和App，尽可能减少网络请求，提高App运行效率。</p>
<ul>
<li><strong>本文作者：</strong>unclechen</li>
<li><strong>本文链接：</strong> <a href="/2017/05/13/WebView缓存原理分析和应用/" title="WebView缓存原理分析和应用">2017/05/13/WebView缓存原理分析和应用/</a></li>
<li><strong>版权声明：</strong> 本文采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a>进行许可。转载请注明出处！</li>
</ul>
<p><a href="/tags/Android/"># Android</a> <a href="/tags/WebView/"># WebView</a></p>
<p><a href="/2016/12/11/python利用beautifulsoup+selenium自动翻页抓取网页内容/" title="python利用beautifulsoup+selenium自动翻页抓取网页内容">python利用beautifulsoup+selenium自动翻页抓取网页内容</a></p>
<p><a href="/2017/06/16/使用ReactJS开发Chrome插件/" title="使用React.js开发Chrome插件">使用React.js开发Chrome插件</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/15/java/java%E4%B8%AD%E7%9A%84%E6%B3%9B%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/15/java/java%E4%B8%AD%E7%9A%84%E6%B3%9B%E5%9E%8B/" class="post-title-link" itemprop="url">java中的泛型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-15 14:44:55" itemprop="dateCreated datePublished" datetime="2018-08-15T14:44:55+08:00">2018-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:39:47" itemprop="dateModified" datetime="2020-07-18T14:39:47+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="什么是泛型"><a href="#什么是泛型" class="headerlink" title="什么是泛型"></a>什么是泛型</h1><p>Java 泛型（generics）是 JDK 5 中引入的一个新特性, 泛型提供了编译时类型安全检测机制，该机制允许程序员在编译时检测到非法的类型。<br>泛型的本质是参数化类型，也就是说所操作的数据类型被指定为一个参数。</p>
<hr>
<p>假定我们有这样一个需求：写一个排序方法，能够对整型数组、字符串数组甚至其他任何类型的数组进行排序，该如何实现？</p>
<p>答案是可以使用 Java 泛型。</p>
<p>使用 Java 泛型的概念，我们可以写一个泛型方法来对一个对象数组排序。然后，调用该泛型方法来对整型数组、浮点数数组、字符串数组等进行排序。</p>
<h1 id="泛型的分类"><a href="#泛型的分类" class="headerlink" title="泛型的分类"></a>泛型的分类</h1><p>根据泛型的使用场景，一般可以分成三类，分别是:<strong>泛型类</strong>、<strong>泛型方法</strong>、<strong>和泛型接口</strong>。</p>
<h1 id="泛型类型擦出"><a href="#泛型类型擦出" class="headerlink" title="泛型类型擦出"></a>泛型类型擦出</h1><p>Java中的泛型，只在编译阶段有效。在编译过程中，正确检验泛型结果后，会将泛型的相关信息擦出，并且在对象进入和离开方法的边界处添加类型检查和类型转换的方法。也就是说，泛型信息不会进入到运行时阶段。<br>用代码来说明就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class test &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[])&#123;</span><br><span class="line">        List&lt;Integer&gt; a &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;String&gt;  b &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        System.out.println(a.getClass().toString());</span><br><span class="line">        System.out.println(a.getClass().toString());</span><br><span class="line"></span><br><span class="line">        System.out.println(b.getClass().equals(a.getClass()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class java.util.ArrayList</span><br><span class="line">class java.util.ArrayList</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<p>可以看到，<code>List&lt;Integer&gt;</code>和<code>List&lt;String&gt;</code>的类是相同的。</p>
<p>总结成一句话就是：<strong>泛型类型在逻辑上看以看成是多个不同的类型，实际上都是相同的基本类型。</strong></p>
<h2 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h2><p>泛型类的使用非常简单,在类名添加<code>&lt;T&gt;</code> 或者类似于这类的泛型类声明即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Person&lt;T&gt;&#123;</span><br><span class="line">    private T t;</span><br><span class="line"></span><br><span class="line">    public Person(T t) &#123;</span><br><span class="line">        this.t &#x3D; t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public T getKey()&#123;</span><br><span class="line">        return t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在使用这个泛型类的时候，就可以传入不同类型的参数来进行初始化，可以显示声明数据类型，也可以不声明，<code>jvm</code>会自动帮我们声明。使用实例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Person p1 &#x3D; new Person&lt;Integer&gt;(12345);</span><br><span class="line">Person p2 &#x3D; new Person&lt;Double&gt;(8989.9);</span><br><span class="line">Person p3 &#x3D; new Person&lt;&gt;(true);</span><br><span class="line">Person p4 &#x3D; new Person&lt;&gt;(&quot;i am ok!&quot;);</span><br><span class="line"></span><br><span class="line">System.out.println(&quot;p1 -&gt; &quot;+p1.getKey());</span><br><span class="line">System.out.println(&quot;p2 -&gt; &quot;+p2.getKey());</span><br><span class="line">System.out.println(&quot;p3 -&gt; &quot;+p3.getKey());</span><br><span class="line">System.out.println(&quot;p4 -&gt; &quot;+p4.getKey());</span><br></pre></td></tr></table></figure>
<p>输出的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p1 -&gt; 12345</span><br><span class="line">p2 -&gt; 8989.9</span><br><span class="line">p3 -&gt; true</span><br><span class="line">p4 -&gt; i am ok!</span><br></pre></td></tr></table></figure>
<p>可以看到，使用泛型类非常简单，只需要在定义类的时候添加<code>&lt;T&gt;</code>、<code>&lt;K&gt;</code>、<code>&lt;V&gt;</code>这类的泛型类的定义即可。当然，如果有需要，我们可以限制其使用范围，例如<code>&lt;T extends Number&gt;</code> 就规定了传入的类型是只能是<code>Number</code>的子类。</p>
<h2 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h2><p>泛型方法的规则如下：</p>
<ol>
<li>所有泛型方法声明都有一个类型参数声明部分（由尖括号分隔），该类型参数声明部分在方法返回类型之前（在下面例子中的<E>）。</li>
<li>每一个类型参数声明部分包含一个或多个类型参数，参数间用逗号隔开。一个泛型参数，也被称为一个类型变量，是用于指定一个泛型类型名称的标识符。</li>
<li>类型参数能被用来声明返回值类型，并且能作为泛型方法得到的实际参数类型的占位符。</li>
<li>泛型方法体的声明和其他方法一样。注意类型参数只能代表引用型类型，不能是原始类型（像int,double,char的等）。</li>
</ol>
<p>泛型方法与泛型类的定义类似，泛型类的定义是在类名后加<code>&lt;T&gt;</code>这类的泛型修饰词，泛型方法的定义就是在方法的返回值添加<code>&lt;T&gt;</code>这类的修饰词。先来看泛型方法的定义示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private &lt;T&gt; void helloPerson(T t)&#123;</span><br><span class="line">       System.out.println(&quot;t &#x3D; [&quot; + t + &quot;]&quot;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>注意，这里我们称他为泛型方法是因为<code>void</code>前面的<code>&lt;T&gt;</code>，而不是<code>helloPerson(T t)</code>中的<code>T</code>。<br>我们在泛型类的<code>Person</code>中的<code>public T getKey()</code> 就不能算一个泛型方法，因为这里的<code>T</code>只是<code>getKey</code>方法的一个返回值而已。<br>然后泛型方法的使用也很简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helloPerson(123);</span><br><span class="line">helloPerson(12.3);</span><br><span class="line">helloPerson(true);</span><br><span class="line">helloPerson(&quot;i am ok&quot;);</span><br></pre></td></tr></table></figure>
<p>上面方法的运行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t &#x3D; [123]</span><br><span class="line">t &#x3D; [12.3]</span><br><span class="line">t &#x3D; [true]</span><br><span class="line">t &#x3D; [i am ok]</span><br></pre></td></tr></table></figure>


<h2 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h2><p>泛型接口的定义同样很简单，只需要在接口的名字后加上<code>&lt;T&gt;</code>这类的泛型定义接口。例如下面是一个泛型接口的示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface IFunction&lt;T&gt; &#123;</span><br><span class="line">    void doSomeThing(T t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在泛型接口里面定义了泛型，我们就可以在对应的方法中使用其类型。<br>当然，接口的定义好之后还是需要去实现这个接口的，实现的方式有两种，一种是声明类型，一种是不声明类型。<br>下面是第一种，申明类型的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Eat implements IFunction&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doSomeThing(String s) &#123;</span><br><span class="line">        System.out.println(&quot;s &#x3D; [&quot; + s + &quot;]&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，在<code>Eat</code>的实现中，我们讲泛型显示声明成了<code>String</code>，如此我们在使用<code>Eat</code>类中的<code>doSomeThing</code>方法时，就只能传入<code>String</code>类型的。<br>另一种，是不声明具体类型的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Read&lt;T&gt; implements IFunction&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doSomeThing(T t) &#123;</span><br><span class="line">        System.out.println(&quot;t &#x3D; [&quot; + t + &quot;]&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，其实<code>Read</code>就已经被声明成了一个泛型类，因为实现了泛型接口，我们要继续使用泛型来实现的话，就需要将类实现成泛型类。<br>我们来看其调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">IFunction f1 &#x3D; new Eat();</span><br><span class="line">IFunction f2 &#x3D; new Read();</span><br><span class="line"></span><br><span class="line">f1.doSomeThing(&quot;f1-&gt; only eat!&quot;);</span><br><span class="line">&#x2F;&#x2F;f1.doSomeThing(123456);</span><br><span class="line">&#x2F;&#x2F;这句编译不会报错，运行会抛出java.lang.Integer cannot be cast to java.lang.String 异常</span><br><span class="line"></span><br><span class="line">f2.doSomeThing(132);</span><br><span class="line">f2.doSomeThing(&quot;read&quot;);</span><br><span class="line">f2.doSomeThing(true);</span><br><span class="line">f2.doSomeThing(52.1);</span><br></pre></td></tr></table></figure>
<p>输出的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s &#x3D; [f1-&gt; only eat!]</span><br><span class="line">t &#x3D; [132]</span><br><span class="line">t &#x3D; [read]</span><br><span class="line">t &#x3D; [true]</span><br><span class="line">t &#x3D; [52.1]</span><br></pre></td></tr></table></figure>
<p>可以看到，我们在继承泛型接口时，显示申明了其类型之后，我们调用时也只能使用对应的类型，如果传入其他的类型，编译器并不会报错，但是运行时会抛出 类型强转失败的异常 。</p>
<h1 id="泛型通配符"><a href="#泛型通配符" class="headerlink" title="泛型通配符"></a>泛型通配符</h1><p>类型通配符一般是使用<code>?</code>代替具体的类型参数。例如 List&lt;?&gt; 在逻辑上是List<String>,List<Integer> 等所有List&lt;具体类型实参&gt;的父类。注意，<code>?</code>可以代表<code>String</code>,<code>Interger</code>等其他具体的类型，但它是不确定的，而<code>&lt;T&gt;</code>表示一个类型参数，不能当作实际参数使用。说白了，就是<code>?</code>,表示不确定的类型，和<code>String</code>，<code>Integer</code>这种类型一样，是实实在在的类型，而<code>T</code>，只是表示类型参数，在使用时还是会转化成对应的实际参数的。<br>使用实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class TypeTest &#123;</span><br><span class="line">    public static void main(String args[])&#123;</span><br><span class="line">        TypeTest typeTest  &#x3D; new TypeTest();</span><br><span class="line">        typeTest.helloMan(Arrays.asList(&quot;1&quot;,&quot;hello&quot;));</span><br><span class="line">        typeTest.helloMan(Arrays.asList(1,2,3));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void helloMan(List&lt;?&gt; a)&#123;</span><br><span class="line">        System.out.println(&quot;a &#x3D; [&quot; + a + &quot;]&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，我往同一个方法出入不同类型的参数也时可以正常运行的，输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; [[1, hello]]</span><br><span class="line">a &#x3D; [[1, 2, 3]]</span><br></pre></td></tr></table></figure>
<p>还有，补充两点;</p>
<ol>
<li><code>&lt;? extends T&gt;</code>表示该通配符所代表的类型是<code>T</code>类型的子类。</li>
<li><code>&lt;? super T&gt;</code>表示该通配符所代表的类型是<code>T</code>类型的父类</li>
</ol>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/s10461/article/details/53941091" target="_blank" rel="noopener">java 泛型详解</a></li>
<li><a href="http://www.runoob.com/java/java-generics.html" target="_blank" rel="noopener">Java 泛型</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/15/java/java%E4%B8%AD%E7%9A%84%E5%8F%8D%E5%B0%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/15/java/java%E4%B8%AD%E7%9A%84%E5%8F%8D%E5%B0%84/" class="post-title-link" itemprop="url">java中的反射</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-15 14:44:55" itemprop="dateCreated datePublished" datetime="2018-08-15T14:44:55+08:00">2018-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:39:41" itemprop="dateModified" datetime="2020-07-18T14:39:41+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="java中的反射"><a href="#java中的反射" class="headerlink" title="java中的反射"></a>java中的反射</h1><p>在java中，有一种可以跨越常规语法的用法，它就是反射。通过反射，我们可以访问到我们原本访问不到的类和对象，也不能调用我们原本调用不到的方法。虽然反射很强大，但是它违反了程序设计的初衷，且用反射的性能会有一定的影响，所以我们应该避免使用反射。但是反射功能实在强大，正确的使用能使得我们的代码变得很简洁，所以我们还是有必要学习一下反射的相关知识。</p>
<h1 id="反射的原理"><a href="#反射的原理" class="headerlink" title="反射的原理"></a>反射的原理</h1><p><a href="http://www.importnew.com/23902.html" target="_blank" rel="noopener">深入分析Java方法反射的实现原理</a></p>
<h2 id="获取类实例"><a href="#获取类实例" class="headerlink" title="获取类实例"></a>获取类实例</h2><p>获取类实例一般有两种写法，一种是<code>类名.class</code>,另一种则是<code>class.forName()</code>。假如我们已经有了一个<code>Person</code>的类，那么我们可以通过如下三种方式来获取类实例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;方式1</span><br><span class="line">Class person1 &#x3D; Person.class;</span><br><span class="line">&#x2F;&#x2F;方式2</span><br><span class="line">Class person2 &#x3D; Class.forName(&quot;day18.Person&quot;);</span><br><span class="line">&#x2F;&#x2F;方式3,如果能用这种肯定用这种！</span><br><span class="line">Person person3 &#x3D; new Person();</span><br></pre></td></tr></table></figure>
<p>两种方式的区别是，一种是我们能直接拿到那个类对象，另一种是我们无法中拿到类对象，必须通过反射才能获取到类对象。</p>
<h2 id="通过反射获取构造方法"><a href="#通过反射获取构造方法" class="headerlink" title="通过反射获取构造方法"></a>通过反射获取构造方法</h2><p>假设我们有这个一个<code>Person</code>类，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">    public String name;</span><br><span class="line">    public char sex;</span><br><span class="line">    public int height;</span><br><span class="line">    protected float id;</span><br><span class="line">    private String des;</span><br><span class="line"></span><br><span class="line">    private Person() &#123;</span><br><span class="line">        this.name &#x3D; &quot;jone&quot;;</span><br><span class="line">        this.sex &#x3D; &#39;f&#39;;</span><br><span class="line">        this.height &#x3D; 155;</span><br><span class="line">        this.id &#x3D; 420458188603268922F;</span><br><span class="line">        this.des &#x3D; &quot;just a normal person&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Person(String name) &#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Person(String name, char sex) &#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">        this.sex &#x3D; sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Person(String name, char sex, int height) &#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">        this.sex &#x3D; sex;</span><br><span class="line">        this.height &#x3D; height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么我们如何去创建对应的<code>Person</code>对象呢，不能因为我们没有对象就不创建对象呀！答案是我们可以利用反射获得对应的构造方法，然后利用<code>newInstance()</code>方法，即可创建对应的<code>Person</code>对象。例如我们可以这么写，来获得对应的构造方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> try &#123;</span><br><span class="line">    &#x2F;&#x2F;获取对应的类对象，如果直接获取不到，可以用Class.forName(&quot;packageName.Person&quot;); 来获取</span><br><span class="line">    Class person1 &#x3D; Person.class;</span><br><span class="line">    &#x2F;&#x2F;获取无参的构造方法</span><br><span class="line">    Constructor constructor &#x3D; person1.getDeclaredConstructor();</span><br><span class="line">    &#x2F;&#x2F;设置属性为可访问，因为其构造方法是private的，所以这句必不可少，</span><br><span class="line">    &#x2F;&#x2F;否则会报  can not access a member of class day18.Person with modifiers &quot;private&quot; 的错误</span><br><span class="line">    constructor.setAccessible(true);</span><br><span class="line">    &#x2F;&#x2F;利用newInstance 创建对应的对象</span><br><span class="line">    Person p1 &#x3D; (Person) constructor.newInstance();</span><br><span class="line"></span><br><span class="line">    Constructor constructor2 &#x3D; person1.getDeclaredConstructor(String.class);</span><br><span class="line">    constructor2.setAccessible(true);</span><br><span class="line">    Person p2 &#x3D; (Person) constructor2.newInstance(&quot;p2&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(p1.name);</span><br><span class="line">    System.out.println(p2.name);</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jone</span><br><span class="line">p2</span><br></pre></td></tr></table></figure>
<p>我们可以利用<code>getDeclaredConstructor()</code>，来获取对应的构造方法。当然，还有其他方法可以获取到构造方法，我们这里以他为例。<code>getDeclaredConstructor()</code>，中间可以添加任意个参数，表示有多少个参数的构造方法。例如<code>getDeclaredConstructor(String.class)</code> ，对应的构造方法就是<code>private Person(String name)</code>,然后在<code>newInstance</code>，传入对应的参数即可。</p>
<p><strong>获取构造方法的四个方法</strong>：</p>
<table>
<thead>
<tr>
<th align="center">方法名</th>
<th>作用</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>public Constructor&lt;T&gt; getDeclaredConstructor(Class&lt;?&gt;... parameterTypes)</code></td>
<td>获得对应的构造方法</td>
<td>获取的构造方法必须是当前类申明的，无法获取到父类的构造方法</td>
</tr>
<tr>
<td align="center"><code>public Annotation[] getDeclaredAnnotations()</code></td>
<td>获得所有的构造方法</td>
<td>获取所有的构造方法都是当前类申明的，无法获取到父类的构造方法</td>
</tr>
<tr>
<td align="center"><code>public Constructor&lt;T&gt; getConstructor(Class&lt;?&gt;... parameterTypes)</code></td>
<td>获得指定的构造方法</td>
<td>获得的构造方法必须是<code>public</code>的，可以获取从父类继承的构造方法</td>
</tr>
<tr>
<td align="center"><code>public Constructor&lt;?&gt;[] getConstructors()</code></td>
<td>获得所有的构造方法</td>
<td>获取构造方法都是<code>public</code>的，可以获取到父类的<code>phblic</code>构造方法</td>
</tr>
</tbody></table>
<h2 id="通过反射获取属性"><a href="#通过反射获取属性" class="headerlink" title="通过反射获取属性"></a>通过反射获取属性</h2><p>还是沿用上次的<code>Person</code>类，我们这次来获取他的<code>des</code>属性。观察一下，发现<code>des</code>属性为<code>private</code>,常规就无法获取到其属性值，下面我们通过反射来获取其<code>des</code>属性的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> try &#123;</span><br><span class="line">    &#x2F;&#x2F;获取对应的类对象，如果直接获取不到，可以用Class.forName(&quot;packageName.Person&quot;); 来获取</span><br><span class="line">    Class person1 &#x3D; Person.class;</span><br><span class="line">    &#x2F;&#x2F;获取无参构造方法</span><br><span class="line">    Constructor constructor &#x3D; person1.getDeclaredConstructor();</span><br><span class="line">    &#x2F;&#x2F;设置构造方法可访问</span><br><span class="line">    constructor.setAccessible(true);</span><br><span class="line">    &#x2F;&#x2F;创建Person对象</span><br><span class="line">    Person p1 &#x3D; (Person) constructor.newInstance();</span><br><span class="line">    &#x2F;&#x2F;获取des 属性值</span><br><span class="line">    Field des &#x3D; person1.getDeclaredField(&quot;des&quot;);</span><br><span class="line">    &#x2F;&#x2F;设置 des 可访问</span><br><span class="line">    des.setAccessible(true);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;des&#x3D; &quot;+des.get(p1));</span><br><span class="line"></span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注释很详细，不在赘述了，这里打印的结果就是<code>Person</code>类里无参构造方法赋值的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">des&#x3D; just a normal person</span><br></pre></td></tr></table></figure>
<p><strong>获取属性的方法</strong></p>
<table>
<thead>
<tr>
<th align="center">方法名</th>
<th>作用</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>public Field[] getDeclaredFields()</code></td>
<td>获取所有的属性</td>
<td>只能获取本类的属性（包括private的），不能获取到父类的属性</td>
</tr>
<tr>
<td align="center"><code>public Field getDeclaredField(String name)</code></td>
<td>获取指定的的属性</td>
<td>只能到获取本类的属性（包括private的），不能获取到父类的属性</td>
</tr>
<tr>
<td align="center"><code>public Field[] getFields()</code></td>
<td>获取所有的属性</td>
<td>只能到获取<code>public</code>的属性，也可以获取到父类的<code>public</code>属性</td>
</tr>
<tr>
<td align="center"><code>public Field getField(String name)</code></td>
<td>获取指定的的属性</td>
<td>只能到获取<code>public</code>的属性，也可以获取到父类的<code>public</code>属性</td>
</tr>
</tbody></table>
<h2 id="通过反射获取方法"><a href="#通过反射获取方法" class="headerlink" title="通过反射获取方法"></a>通过反射获取方法</h2><p>我们还是是假设有一个<code>Person</code>类，我们将其改造成如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">    public String name;</span><br><span class="line">    public char sex;</span><br><span class="line">    public int height;</span><br><span class="line">    protected float id;</span><br><span class="line">    private String des;</span><br><span class="line"></span><br><span class="line">    private Person() &#123;</span><br><span class="line">        this.name &#x3D; &quot;jone&quot;;</span><br><span class="line">        this.sex &#x3D; &#39;f&#39;;</span><br><span class="line">        this.height &#x3D; 155;</span><br><span class="line">        this.id &#x3D; 420458188603268922F;</span><br><span class="line">        this.des &#x3D; &quot;just a normal person&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    private void showInfo()&#123;</span><br><span class="line">        System.out.println(&quot;name&#x3D;&quot;+name);</span><br><span class="line">        System.out.println(&quot;sex&#x3D;&quot;+sex);</span><br><span class="line">        System.out.println(&quot;height&#x3D;&quot;+height);</span><br><span class="line">        System.out.println(&quot;id&#x3D;&quot;+id);</span><br><span class="line">        System.out.println(&quot;des&#x3D;&quot;+des);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void showInfo(String name)&#123;</span><br><span class="line">        System.out.println(&quot;name &#x3D; [&quot; + name + &quot;]&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String showInfo(String name,String des)&#123;</span><br><span class="line">        return &quot;the people name is&quot;+name+&quot; and des is &quot;+des;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上，我们实现了三个<code>ShowInfo()</code>的重载方法，但是都是<code>private</code>类型的，一般情况下在外部是无法调用的，下面我们通过反射来进行调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    &#x2F;&#x2F;获取对应的类对象，如果直接获取不到，可以用Class.forName(&quot;packageName.Person&quot;); 来获取</span><br><span class="line">    Class person1 &#x3D; Person.class;</span><br><span class="line">    &#x2F;&#x2F;获取无参构造方法</span><br><span class="line">    Constructor constructor &#x3D; person1.getDeclaredConstructor();</span><br><span class="line">    &#x2F;&#x2F;设置构造方法可访问</span><br><span class="line">    constructor.setAccessible(true);</span><br><span class="line">    &#x2F;&#x2F;创建Person对象</span><br><span class="line">    Person p1 &#x3D; (Person) constructor.newInstance();</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;获取无参的showInfo方法</span><br><span class="line">    Method method1 &#x3D; person1.getDeclaredMethod(&quot;showInfo&quot;);</span><br><span class="line">    &#x2F;&#x2F;设置showInfo方法访问</span><br><span class="line">    method1.setAccessible(true);</span><br><span class="line">    &#x2F;&#x2F;执行无参的showInfo方法</span><br><span class="line">    method1.invoke(p1);</span><br><span class="line">    System.out.println();</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;获取一个参数的的showInfo方法</span><br><span class="line">    Method method2 &#x3D; person1.getDeclaredMethod(&quot;showInfo&quot;,String.class);</span><br><span class="line">    &#x2F;&#x2F;设置showInfo方法访问</span><br><span class="line">    method2.setAccessible(true);</span><br><span class="line">    &#x2F;&#x2F;执行无参的showInfo方法</span><br><span class="line">    method2.invoke(p1,&quot;call from outside:&quot;);</span><br><span class="line">    System.out.println();</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;获取两个参数的的showInfo方法</span><br><span class="line">    Method method3 &#x3D; person1.getDeclaredMethod(&quot;showInfo&quot;,String.class,String.class);</span><br><span class="line">    &#x2F;&#x2F;设置showInfo方法访问</span><br><span class="line">    method3.setAccessible(true);</span><br><span class="line">    &#x2F;&#x2F;执行无参的showInfo方法</span><br><span class="line">    String dsc &#x3D; (String) method3.invoke(p1,&quot; arche&quot;,&quot;call from outside:&quot;);</span><br><span class="line">    System.out.println(dsc);</span><br><span class="line"></span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过反射分别调用了上述的三个参数，输出的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;jone</span><br><span class="line">sex&#x3D;f</span><br><span class="line">height&#x3D;155</span><br><span class="line">id&#x3D;4.20458194E17</span><br><span class="line">des&#x3D;just a normal person</span><br><span class="line"></span><br><span class="line">name &#x3D; [call from outside:]</span><br><span class="line"></span><br><span class="line">the people name is arche and des is call from outside:</span><br></pre></td></tr></table></figure>
<p>下面总结一下反射方法相关的函数：</p>
<h2 id="通过反射获取参数"><a href="#通过反射获取参数" class="headerlink" title="通过反射获取参数"></a>通过反射获取参数</h2><table>
<thead>
<tr>
<th align="center">方法名</th>
<th>作用</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>public Method getDeclaredMethod(String name, Class&lt;?&gt;... parameterTypes)</code></td>
<td>获取指定的方法</td>
<td>只能获取本类的方法（包括private的），不能获取到父类的方法</td>
</tr>
<tr>
<td align="center"><code>public Field[] getDeclaredFields()</code></td>
<td>获取所有的的方法</td>
<td>只能获取本类的方法（包括private的），不能获取到父类的方法</td>
</tr>
<tr>
<td align="center"><code>public Method getMethod(String name, Class&lt;?&gt;... parameterTypes)</code></td>
<td>获取指定的的方法</td>
<td>只能获取<code>public</code>的方法，也能获取到父类的<code>public</code>方法</td>
</tr>
<tr>
<td align="center"><code>public Method[] getMethods()</code></td>
<td>获取所有的的方法</td>
<td>只能获取<code>public</code>的方法，能获取到父类的<code>public</code>方法</td>
</tr>
<tr>
<td align="center"><code>public Object invoke(Object obj, Object... args)</code></td>
<td>执行对应的方法</td>
<td>执行方法的参数应和获取方法时的参数类型相同,可以为null</td>
</tr>
<tr>
<td align="center"><code>public Class&lt;?&gt; getReturnType()</code></td>
<td>获取方法的返回值类型</td>
<td>使用示例<code>Class&lt;?&gt; type = method1.getReturnType();</code></td>
</tr>
<tr>
<td align="center"><code>public Class&lt;?&gt;[] getParameterTypes()</code></td>
<td>获得方法的传入参数类型</td>
<td>使用示例<code>Class&lt;?&gt;[] Parametertypes = method1.getParameterTypes();</code></td>
</tr>
<tr>
<td align="center"><code>public Class&lt;?&gt;[] getParameterTypes()</code></td>
<td>获得方法的传入参数类型</td>
<td>使用示例<code>Class&lt;?&gt;[] Parametertypes = method1.getParameterTypes();</code></td>
</tr>
</tbody></table>
<h2 id="通过反射获取注解"><a href="#通过反射获取注解" class="headerlink" title="通过反射获取注解"></a>通过反射获取注解</h2><h2 id="通过反射获取泛型"><a href="#通过反射获取泛型" class="headerlink" title="通过反射获取泛型"></a>通过反射获取泛型</h2><p>假设<code>Person</code>对象如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">     private List&lt;String&gt; friends;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们要获取其 friends对象的泛型，可以用下面的方式实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> try &#123;</span><br><span class="line">    Class&lt;?&gt; p &#x3D; Person.class;</span><br><span class="line">    Field friends &#x3D; p.getDeclaredField(&quot;friends&quot;);</span><br><span class="line">    Type genericType &#x3D; friends.getGenericType();&#x2F;&#x2F;获取对应的类型</span><br><span class="line">    ParameterizedTypeImpl parameterizedType &#x3D; (ParameterizedTypeImpl) genericType; &#x2F;&#x2F;强转成具体的实现类</span><br><span class="line">    Type[] genericTypes &#x3D; parameterizedType.getActualTypeArguments();  &#x2F;&#x2F;取得包含的泛型类型</span><br><span class="line">    System.out.println(genericTypes[0]);</span><br><span class="line"></span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如此我们就获取的了<code>friends</code>的泛型类，打印的结果为：</p>
<blockquote>
<p>class java.lang.String</p>
</blockquote>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/liujiahan629629/article/details/18013523" target="_blank" rel="noopener">JAVA中的反射机制</a></li>
<li><a href="https://blog.csdn.net/gdutxiaoxu/article/details/68947735" target="_blank" rel="noopener">Java 反射机制详解</a></li>
<li><a href="https://blog.csdn.net/u012585964/article/details/52011138" target="_blank" rel="noopener">深入理解java反射机制</a></li>
<li><a href="http://www.importnew.com/23902.html" target="_blank" rel="noopener">深入分析Java方法反射的实现原理</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/07/java/java%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/07/java/java%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" class="post-title-link" itemprop="url">java中的动态代理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-07 16:44:55" itemprop="dateCreated datePublished" datetime="2018-08-07T16:44:55+08:00">2018-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:39:36" itemprop="dateModified" datetime="2020-07-18T14:39:36+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h1><p>什么是代理模式？代理模式给某一个对象提供一个代理对象，并由代理对象控制对原对象的引用。通俗的来讲代理模式就是我们生活中常见的中介。<br>下面以一个简单的例子来说明代理模式。<br>小明有两件事要做，用代码表示为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface IDoSomething &#123;</span><br><span class="line">    String[] doShopping(int money);</span><br><span class="line">    Object doOtherThing(String thing);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，小明要做这些事情，他也知道怎么去做，购物和做其他事情的实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class DoSomethingImpl implements IDoSomething &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String[] doShopping(int money) &#123;</span><br><span class="line">        System.out.println(&quot;买买买！！&quot;);</span><br><span class="line">        System.out.println(String.format(&quot;花费%d $&quot;,money));</span><br><span class="line">        return new String[]&#123;&quot;零食&quot;,&quot;游戏机&quot;,&quot;mac&quot;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object doOtherThing(String thing) &#123;</span><br><span class="line">        System.out.println(&quot; Other Thing -&gt;&quot;+thing);</span><br><span class="line"></span><br><span class="line">        return thing+&quot; is done&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然，小明有这两件事要做，他也知道怎么去做，但是他现在就是不想自己去做。那怎么办？<br>找人帮他做呗，也就是找个<code>代理</code>，代理的简单实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class ProxyDoSomething implements IDoSomething&#123;</span><br><span class="line">    private IDoSomething base;</span><br><span class="line"></span><br><span class="line">    public ProxyDoSomething(IDoSomething base) &#123;</span><br><span class="line">        this.base &#x3D; base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String[] doShopping(int money) &#123;</span><br><span class="line">        &#x2F;&#x2F;先扣点手续费</span><br><span class="line">        int realMoney &#x3D; (int) (money*0.1);</span><br><span class="line">        String [] object &#x3D; base.doShopping(realMoney);</span><br><span class="line">        if (object !&#x3D; null &amp;&amp; object.length &gt; 1)&#123;</span><br><span class="line">            object[0]&#x3D; &quot;把这个换成拼多多的货&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object doOtherThing(String thing) &#123;</span><br><span class="line">        String str &#x3D; thing+&quot; 这件事是代理出面做的&quot;;</span><br><span class="line">        String res &#x3D; (String) base.doOtherThing(str);</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找人做代理，难免要点手续费，然后可能还会动点手脚。当然，最终事情还是帮我们做好了，接下来我们看不要小明亲自出面，怎么来实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String args[])&#123;</span><br><span class="line">        IDoSomething iDoSomething &#x3D; new DoSomethingImpl();</span><br><span class="line">        ProxyDoSomething proxyDoSomething &#x3D; new ProxyDoSomething(iDoSomething);</span><br><span class="line">        System.out.print(proxyDoSomething.doOtherThing(&quot; clean house&quot;).toString());</span><br><span class="line">        System.out.println(Arrays.toString(proxyDoSomething.doShopping(1000)));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，本来是小明要做的事情，最终代理给了<code>ProxyDoSomething</code>去完成，当然，代价也比较惨重。<br>最终打印的结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> Other Thing -&gt; clean house 这件事是代理出面做的</span><br><span class="line"> clean house 这件事是代理出面做的 is done买买买！！</span><br><span class="line">花费100 $</span><br><span class="line">[把这个换成拼多多的货, 游戏机, mac]</span><br></pre></td></tr></table></figure>

<h1 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h1><p>通过前一个例子理解了什么是代理，那么什么是动态代理呢？<br>通俗的理解就是，这个代理的对象可以代理很多事情，不会局限于静态代理一对一的关系，动态代理可以实现一 对多。类似于一个万能的代理，既能给代理购物，也能给别人代理做家务等等。<br>废话不多说，先上代理的核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 动态代理实现的核心，很多事情就是在这里进行实现的。</span><br><span class="line"> * 首先，我们需要拿到需要代理的对象</span><br><span class="line"> * 然后，需要判断对应的方法</span><br><span class="line"> * 最后，通过反射进行调用</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class DoSomethingHandler implements InvocationHandler &#123;</span><br><span class="line">    private IDoSomething doSomething;</span><br><span class="line"></span><br><span class="line">    public DoSomethingHandler(IDoSomething doSomething) &#123;</span><br><span class="line">        this.doSomething &#x3D; doSomething;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        if (&quot;doShopping&quot;.equals(method.getName()))&#123;</span><br><span class="line">            int money &#x3D; (int) ((int) args[0]*0.8);</span><br><span class="line">            doSomething.doShopping(money);</span><br><span class="line">            String[] things &#x3D; (String[]) method.invoke(doSomething, money);</span><br><span class="line">            if (things !&#x3D; null &amp;&amp; things.length &gt; 1)&#123;</span><br><span class="line">                things[0] &#x3D; &quot;这个我要掉包，换个来自拼多多的好货&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">            return things;</span><br><span class="line">        &#125;else if(&quot;doOtherThing&quot;.equals(method.getName()))&#123;</span><br><span class="line">            String str &#x3D; args[0] +&quot; by DosomeThingHadler&quot;;</span><br><span class="line">            Object o &#x3D; method.invoke(doSomething,str);</span><br><span class="line">            return o+&quot; 来自 DosomeThingHadler 的问候&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单的介绍在代码里进行介绍了，这里就不多介绍了。我们来看调用的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(&quot;开始啦啦啦啦~ &quot;);</span><br><span class="line">      IDoSomething people &#x3D; new DoSomethingImpl();</span><br><span class="line">      &#x2F;&#x2F;不使用代理，自己来</span><br><span class="line">      System.out.println(Arrays.toString(people.doShopping(1000)));</span><br><span class="line">      &#x2F;&#x2F;动态代理</span><br><span class="line">      people &#x3D; (IDoSomething) Proxy.newProxyInstance(IDoSomething.class.getClassLoader(),people.getClass().getInterfaces()</span><br><span class="line">              ,new DoSomethingHandler(people));</span><br><span class="line">      System.out.println(Arrays.toString(people.doShopping(1000)));</span><br><span class="line">      System.out.print(people.doOtherThing(&quot; clean house&quot;));</span><br></pre></td></tr></table></figure>
<p>通过<code>Proxy.newProxyInstance</code>创建出动态代理实例，然后进行调用即可。<br>上例运行的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">开始啦啦啦啦~ </span><br><span class="line">买买买！！</span><br><span class="line">花费1000 $</span><br><span class="line">[零食, 游戏机, mac]</span><br><span class="line"></span><br><span class="line">买买买！！</span><br><span class="line">花费800 $</span><br><span class="line">买买买！！</span><br><span class="line">花费800 $</span><br><span class="line">[这个我要掉包，换个来自拼多多的好货, 游戏机, mac]</span><br><span class="line"> Other Thing -&gt; clean house by DosomeThingHadler</span><br><span class="line"> clean house by DosomeThingHadler is done 来自 DosomeThingHadler 的问候</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>动态代理的实现主要是基于<code>Proxy.newProxyInstance</code>创建出我们需要的代理对象，而创建这个对象又依赖于一个<code>InvocationHandler</code>，通过他来实现我们要代理的事情。</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="http://weishu.me/2016/01/28/understand-plugin-framework-proxy-hook/" target="_blank" rel="noopener">http://weishu.me/2016/01/28/understand-plugin-framework-proxy-hook/</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/07/reprint/Android%E6%8F%92%E4%BB%B6%E5%8C%96%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%E2%80%94%E2%80%94%E6%A6%82%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/07/reprint/Android%E6%8F%92%E4%BB%B6%E5%8C%96%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%E2%80%94%E2%80%94%E6%A6%82%E8%A6%81/" class="post-title-link" itemprop="url">Android插件化原理解析——概要</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-07 16:44:55" itemprop="dateCreated datePublished" datetime="2018-08-07T16:44:55+08:00">2018-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:41:05" itemprop="dateModified" datetime="2020-07-18T14:41:05+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reprint/" itemprop="url" rel="index"><span itemprop="name">reprint</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Android插件化原理解析——概要"><a href="#Android插件化原理解析——概要" class="headerlink" title="Android插件化原理解析——概要"></a>Android插件化原理解析——概要</h1><p>发表于 2016-01-28   |   63874次阅读</p>
<p>2015年是Android插件化技术突飞猛进的一年，随着业务的发展各大厂商都碰到了Android Native平台的瓶颈：</p>
<ol>
<li>从技术上讲，业务逻辑的复杂导致代码量急剧膨胀，各大厂商陆续出到65535方法数的天花板；同时，运营为王的时代对于模块热更新提出了更高的要求。</li>
<li>在业务层面上，功能模块的解耦以及维护团队的分离也是大势所趋；各个团队维护着同一个App的不同模块，如果每个模块升级新功能都需要对整个app进行升级，那么发布流程不仅复杂而且效率低下；在讲究小步快跑和持续迭代的移动互联网必将遭到淘汰。</li>
</ol>
<p>H5和Hybird可以解决这些问题，但是始终比不上native的用户体验；于是，国外的FaceBook推出了<code>react-native</code>；而国内各大厂商几乎都选择纯native的插件化技术。可以说，Android的未来必将是<code>react-native</code>和插件化的天下。</p>
<p><code>react-native</code>资料很多，但是讲述插件化的却凤毛菱角；插件化技术听起来高深莫测，实际上要解决的就是两个问题：</p>
<ol>
<li>代码加载</li>
<li>资源加载</li>
</ol>
<h2 id="代码加载"><a href="#代码加载" class="headerlink" title="代码加载"></a>代码加载</h2><p>类的加载可以使用Java的<code>ClassLoader</code>机制，但是对于Android来说，并不是说类加载进来就可以用了，很多组件都是有“生命”的；因此对于这些有血有肉的类，必须给它们注入活力，也就是所谓的<strong>组件生命周期管理</strong>；</p>
<p>另外，如何管理加载进来的类也是一个问题。假设多个插件依赖了相同的类，是抽取公共依赖进行管理还是插件单独依赖？这就是<strong>ClassLoader的管理问题</strong>；</p>
<h2 id="资源加载"><a href="#资源加载" class="headerlink" title="资源加载"></a>资源加载</h2><p>资源加载方案大家使用的原理都差不多，都是用<code>AssetManager</code>的隐藏方法<code>addAssetPath</code>；但是，不同插件的资源如何管理？是公用一套资源还是插件独立资源？共用资源如何避免资源冲突？对于资源加载，有的方案共用一套资源并采用资源分段机制解决冲突（要么修改<code>aapt</code>要么添加编译插件）；有的方案选择独立资源，不同插件管理自己的资源。</p>
<p>目前国内开源的较成熟的插件方案有<a href="https://github.com/singwhatiwanna/dynamic-load-apk" target="_blank" rel="noopener">DL</a>和<a href="https://github.com/Qihoo360/DroidPlugin" target="_blank" rel="noopener">DroidPlugin</a>；但是DL方案仅仅对Frameworl的表层做了处理，严重依赖<code>that</code>语法，编写插件代码和主程序代码需单独区分；而DroidPlugin通过Hook增强了Framework层的很多系统服务，开发插件就跟开发独立app差不多；就拿Activity生命周期的管理来说，DL的代理方式就像是牵线木偶，插件只不过是操纵傀儡而已；而DroidPlugin则是借尸还魂，插件是有血有肉的系统管理的真正组件；DroidPlugin Hook了系统几乎所有的Sevice，欺骗了大部分的系统API；掌握这个Hook过程需要掌握很多系统原理，因此学习DroidPlugin对于整个Android FrameWork层大有裨益。</p>
<p>接下来的一系列文章将以DroidPlugin为例讲解插件框架的原理，揭开插件化的神秘面纱；同时还能帮助深入理解Android Framewrok；主要内容如下：</p>
<ul>
<li><a href="http://weishu.me/2016/01/28/understand-plugin-framework-proxy-hook/" target="_blank" rel="noopener">Hook机制之动态代理</a></li>
<li><a href="http://weishu.me/2016/02/16/understand-plugin-framework-binder-hook/" target="_blank" rel="noopener">Hook机制之Binder Hook</a></li>
<li><a href="http://weishu.me/2016/03/07/understand-plugin-framework-ams-pms-hook/" target="_blank" rel="noopener">Hook机制之AMS&amp;PMS</a></li>
<li><a href="http://weishu.me/2016/03/21/understand-plugin-framework-activity-management/" target="_blank" rel="noopener">Activity生命周期管理</a></li>
<li><a href="http://weishu.me/2016/04/05/understand-plugin-framework-classloader/" target="_blank" rel="noopener">插件加载机制</a></li>
<li><a href="http://weishu.me/2016/04/12/understand-plugin-framework-receiver/" target="_blank" rel="noopener">广播的管理方式</a></li>
<li><a href="http://weishu.me/2016/05/11/understand-plugin-framework-service/" target="_blank" rel="noopener">Service的插件化</a></li>
<li><a href="http://weishu.me/2016/07/12/understand-plugin-framework-content-provider/" target="_blank" rel="noopener">ContentProvider的插件化</a></li>
<li>DroidPlugin插件通信机制</li>
<li>插件机制之资源管理</li>
<li>不同插件框架方案对比</li>
<li>插件化的未来</li>
</ul>
<p>另外，对于每一章内容都会有详细的demo，具体见<a href="https://github.com/tiann/understand-plugin-framework" target="_blank" rel="noopener">understand-plugin-framework</a>；喜欢就点个关注吧～定期更新，敬请期待！</p>
<p><a href="/tags/android/">#android</a> <a href="/tags/droidplugin/">#droidplugin</a> <a href="/tags/plugin-framework/">#plugin framework</a></p>
<p><a href="/2016/01/28/understand-plugin-framework-proxy-hook/">Android插件化原理解析——Hook机制之动态代理</a></p>
<p><a href="/2016/01/18/dive-into-asynctask/">你真的了解AsyncTask？</a></p>
<p><a href="/archives">37 日志</a></p>
<p><a href="/atom.xml">RSS</a></p>
<p> <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank" rel="noopener"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a> </p>
<ol>
<li><a href="#代码加载">1. 代码加载</a></li>
<li><a href="#资源加载">2. 资源加载</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/04/android/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87%E5%B9%B6%E6%B7%BB%E5%8A%A0%E8%BE%B9%E6%A1%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/04/android/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87%E5%B9%B6%E6%B7%BB%E5%8A%A0%E8%BE%B9%E6%A1%86/" class="post-title-link" itemprop="url">自定义View之将图片显示圆形图片并添加边框</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-04 16:44:55" itemprop="dateCreated datePublished" datetime="2018-08-04T16:44:55+08:00">2018-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:35:41" itemprop="dateModified" datetime="2020-07-18T14:35:41+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h1><p><img src="http://ovec6nnof.bkt.clouddn.com/image1.png" alt="效果预览"></p>
<p>本次的图片效果是基于上一篇博客的三种方法进行扩展实现图片的外边框效果。上一篇博客的<a href="https://blog.csdn.net/Reoger/article/details/81394579" target="_blank" rel="noopener">传送门</a>。<br>下面开始进行到整体，针对上次实现圆形图片的三个方式添加一个外边框效果。</p>
<h1 id="使用PorterDuffXfermode方式来实现"><a href="#使用PorterDuffXfermode方式来实现" class="headerlink" title="使用PorterDuffXfermode方式来实现"></a>使用PorterDuffXfermode方式来实现</h1><p>我们使用这个方式实现圆形图片的原理是通过图片的设置图片的叠加显示效果。还是这张图：<br><img src="https://upload-images.jianshu.io/upload_images/2041548-d964105abf4be5d9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/312" alt="官方的说明图"></p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>实现圆形图片，我们只需要绘制一个圆，并将模式设置为<code>SRC_IN</code>即可。但是我们需要在外围添加一个边框的话，就不会那么简单了。我们需要绘制三次图片，通过合理的设置他们的<code>Xfermode</code>模式来达到我们的要求。具体步骤为：</p>
<ol>
<li>将原图片绘制出来(如果有需要，进行必要的比例缩放处理，使其是一个正方形)</li>
<li>绘制一个等大的正方形，颜色为边框要显示的颜色。(这一步的目的是为了将外围的边框也绘制出来)</li>
<li>绘制一个半径为二分之一边长减去边框长度的圆，模式为<code>DST_OUT</code></li>
<li>绘制一个半径为二分之一边长的圆，模式为<code>DST_IN</code><br>通过上面四步，基本就实现了我们想要的外边框的效果。<br>用图表示为：<br><img src="http://ovec6nnof.bkt.clouddn.com/%E6%BC%94%E7%A4%BA%E6%96%87%E7%A8%BF1.png" alt=""><br>具体细节可以参考代码实现。<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2>自定义view<code>CircleImageView1</code>的代码如下。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView1 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    public static final int DEFAULT_BORDER_WIDTH &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private Paint mBorderPaint;</span><br><span class="line">    private Shape mShape;</span><br><span class="line">    private Shape mBorderShape;</span><br><span class="line">    private float mRadius;</span><br><span class="line">    private float mBorderWidth;</span><br><span class="line">    private int mBorderColor;</span><br><span class="line">    private PorterDuffXfermode mBorderDuffMode;</span><br><span class="line">    private Bitmap mBorderBitmap;</span><br><span class="line"></span><br><span class="line">    private float[] outerRadii &#x3D; new float[8];</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(AttributeSet attrs) &#123;</span><br><span class="line">        if (attrs !&#x3D; null) &#123;</span><br><span class="line">            TypedArray a &#x3D; getContext().obtainStyledAttributes(attrs, R.styleable.CircleImageView1);</span><br><span class="line">            mBorderWidth &#x3D; a.getDimensionPixelSize(R.styleable.CircleImageView1_circle_border_width1, DEFAULT_BORDER_WIDTH);</span><br><span class="line">            mBorderColor &#x3D; a.getInt(R.styleable.CircleImageView1_circle_border_color1, Color.BLACK);</span><br><span class="line">            a.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">        setLayerType(LAYER_TYPE_HARDWARE, null);</span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setColor(Color.BLACK);</span><br><span class="line">        mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.DST_IN));</span><br><span class="line"></span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH) &#123;</span><br><span class="line">            mBorderPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">            mBorderPaint.setColor(mBorderColor);</span><br><span class="line">            mBorderPaint.setFilterBitmap(true);</span><br><span class="line">            mBorderDuffMode &#x3D; new PorterDuffXfermode(PorterDuff.Mode.DST_OUT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int width &#x3D; getMeasuredWidth();</span><br><span class="line">        int height &#x3D; getMeasuredHeight();</span><br><span class="line">        int min &#x3D; Math.min(width, height);</span><br><span class="line">        mRadius &#x3D; min &#x2F; 2;</span><br><span class="line">        setMeasuredDimension(min, min);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">        super.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        if (changed) &#123;</span><br><span class="line">            if (mShape &#x3D;&#x3D; null) &#123;</span><br><span class="line">                Arrays.fill(outerRadii, mRadius);</span><br><span class="line">                mShape &#x3D; new RoundRectShape(outerRadii, null, null);</span><br><span class="line">                if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH &amp;&amp; mBorderShape &#x3D;&#x3D; null) &#123;</span><br><span class="line">                    mBorderShape &#x3D; new RoundRectShape(outerRadii, null, null);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            mShape.resize(getWidth(), getHeight());</span><br><span class="line">            if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH &amp;&amp; mBorderShape !&#x3D; null) &#123;</span><br><span class="line">                mBorderShape.resize(getWidth() - mBorderWidth * 2, getHeight() - mBorderWidth * 2);</span><br><span class="line">                makeStrokeBitmap();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        int saveCount &#x3D; canvas.getSaveCount();</span><br><span class="line">        canvas.save();</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH &amp;&amp; mBorderShape !&#x3D; null &amp;&amp; mBorderBitmap !&#x3D; null) &#123;</span><br><span class="line">            int i &#x3D; canvas.saveLayer(0, 0, getMeasuredWidth(), getMeasuredHeight(), null, Canvas.ALL_SAVE_FLAG);</span><br><span class="line">            &#x2F;&#x2F;1.绘制外边框颜色的正方形</span><br><span class="line">            mBorderPaint.setXfermode(null);</span><br><span class="line">            canvas.drawBitmap(mBorderBitmap, 0, 0, mBorderPaint);</span><br><span class="line">            &#x2F;&#x2F;2.适当画布的中心位置</span><br><span class="line">            canvas.translate(mBorderWidth, mBorderWidth);</span><br><span class="line">            &#x2F;&#x2F;3.绘制减去边框长度的图片，模式为DST_OUT</span><br><span class="line">            mBorderPaint.setXfermode(mBorderDuffMode);</span><br><span class="line">            mBorderShape.draw(canvas, mBorderPaint);</span><br><span class="line">            canvas.restoreToCount(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (mShape !&#x3D; null) &#123;</span><br><span class="line">            mShape.draw(canvas, mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restoreToCount(saveCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void makeStrokeBitmap() &#123;</span><br><span class="line">        if (mBorderWidth &lt;&#x3D; 0) return;</span><br><span class="line"></span><br><span class="line">        int w &#x3D; getMeasuredWidth();</span><br><span class="line">        int h &#x3D; getMeasuredHeight();</span><br><span class="line"></span><br><span class="line">        if (w &#x3D;&#x3D; 0 || h &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        releaseBorderBitmap();</span><br><span class="line"></span><br><span class="line">        mBorderBitmap &#x3D; Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);</span><br><span class="line">        Canvas c &#x3D; new Canvas(mBorderBitmap);</span><br><span class="line">        Paint p &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        p.setColor(mBorderColor);</span><br><span class="line">        c.drawRect(new RectF(0, 0, w, h), p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void releaseBorderBitmap() &#123;</span><br><span class="line">        if (mBorderBitmap !&#x3D; null) &#123;</span><br><span class="line">            mBorderBitmap.recycle();</span><br><span class="line">            mBorderBitmap &#x3D; null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext()).load(url).into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在代码中使用到了自定义的属性，所以需要在<code>value/attrs</code>文件中添加支持，代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;declare-styleable name&#x3D;&quot;CircleImageView1&quot;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_border_width1&quot; format&#x3D;&quot;dimension&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_border_color1&quot; format&#x3D;&quot;color&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_border_overlay1&quot; format&#x3D;&quot;boolean&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_fill_color1&quot; format&#x3D;&quot;color&quot; &#x2F;&gt;</span><br><span class="line">        &lt;attr name&#x3D;&quot;circle_circle_background_color1&quot; format&#x3D;&quot;color&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;declare-styleable&gt;</span><br><span class="line">&lt;&#x2F;resources&gt;</span><br></pre></td></tr></table></figure>
使用也很简单，在xml中使用的代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.example.cm.circleview.view2.CircleImageView1</span><br><span class="line">           android:id&#x3D;&quot;@+id&#x2F;image2_id1&quot;</span><br><span class="line">           app:circle_border_width1&#x3D;&quot;5dp&quot;</span><br><span class="line">           app:circle_border_color1&#x3D;&quot;#fff&quot;</span><br><span class="line">           android:layout_width&#x3D;&quot;200dp&quot;</span><br><span class="line">           android:layout_height&#x3D;&quot;200dp&quot;</span><br><span class="line">           android:layout_marginTop&#x3D;&quot;10dp&quot;</span><br><span class="line">           android:layout_marginBottom&#x3D;&quot;10dp&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
通过java代码设置图片来源，代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    public static final String URL &#x3D; &quot;https:&#x2F;&#x2F;timgsa.baidu.com&#x2F;timg?image&amp;quality&#x3D;80&amp;size&#x3D;b9999_10000&amp;sec&#x3D;1533911636&amp;di&#x3D;04ec95ec44a1623d52b20ff08727ac78&amp;imgtype&#x3D;jpg&amp;er&#x3D;1&amp;src&#x3D;http%3A%2F%2Fimg4.duitang.com%2Fuploads%2Fitem%2F201312%2F05%2F20131205172342_P3nwv.jpeg&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        CircleImageView1 circleImageView21 &#x3D; findViewById(R.id.image2_id1);</span><br><span class="line">        circleImageView21.build(URL);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>能够实现对图片不同边框形状的支持。</p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>实现较复杂，性能代价也比较高，且不支持设置外边框透明度。</p>
<h1 id="使用BitmapShader重新绘制实现圆形图片"><a href="#使用BitmapShader重新绘制实现圆形图片" class="headerlink" title="使用BitmapShader重新绘制实现圆形图片"></a>使用BitmapShader重新绘制实现圆形图片</h1><h2 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h2><p>和上一种方式比起来，第二种方式就显得简单很多了。主要思路就是利用<code>bitmapShader</code>将原图绘制出来，然后通过<code>canvas.drawCircle</code>绘制我们想要的边框即可。</p>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><p>这里只贴出自定义view<code>CircleImageView2</code>的代码，完整代码可以参考我后面给出的代码链接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class CircleImageView2 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    public static final int DEFAULT_BORDER_WIDTH &#x3D; 0;</span><br><span class="line">    private Paint mBorderPaint;</span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private int mRadius;</span><br><span class="line">    private Matrix mMatrix;</span><br><span class="line">    private int mBorderWidth;</span><br><span class="line">    private int mBorderColor;</span><br><span class="line">    private BitmapShader mBitmapShader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(AttributeSet attrs) &#123;</span><br><span class="line">        if (attrs !&#x3D; null) &#123;</span><br><span class="line">            TypedArray a &#x3D; getContext().obtainStyledAttributes(attrs, R.styleable.CircleImageView2);</span><br><span class="line">            mBorderWidth &#x3D; a.getDimensionPixelSize(R.styleable.CircleImageView2_circle_border_width2, DEFAULT_BORDER_WIDTH);</span><br><span class="line">            mBorderColor &#x3D; a.getInt(R.styleable.CircleImageView2_circle_border_color2, Color.BLACK);</span><br><span class="line">            a.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">        super.setScaleType(ScaleType.CENTER_CROP);</span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setAntiAlias(true);</span><br><span class="line">        mMatrix &#x3D; new Matrix();</span><br><span class="line"></span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH) &#123;</span><br><span class="line">            mBorderPaint &#x3D; new Paint();</span><br><span class="line">            mBorderPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">            mBorderPaint.setAntiAlias(true);</span><br><span class="line">            mBorderPaint.setColor(mBorderColor);</span><br><span class="line">            mBorderPaint.setStrokeWidth(mBorderWidth);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(), getMeasuredWidth());</span><br><span class="line">        mRadius &#x3D; min &#x2F; 2;</span><br><span class="line">        setMeasuredDimension(min, min);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">        super.onLayout(changed, left, top, right, bottom);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        if (mBitmapShader &#x3D;&#x3D; null) &#123;</span><br><span class="line">            Bitmap bitmap &#x3D; drawableToBitmap(getDrawable());</span><br><span class="line">            &#x2F;&#x2F;CLAMP表示，当所画图形的尺寸大于Bitmap的尺寸的时候，会用Bitmap四边的颜色填充剩余空间。</span><br><span class="line">            &#x2F;&#x2F;REPEAT表示，当我们绘制的图形尺寸大于Bitmap尺寸时，会用Bitmap重复平铺整个绘制的区域</span><br><span class="line">            &#x2F;&#x2F;MIRROR与REPEAT类似，当绘制的图形尺寸大于Bitmap尺寸时，MIRROR也会用Bitmap重复平铺整个绘图区域，与REPEAT不同的是，两个相邻的Bitmap互为镜像。</span><br><span class="line">            if (bitmap &#x3D;&#x3D; null) &#123;</span><br><span class="line">                super.onDraw(canvas);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mBitmapShader &#x3D; new BitmapShader(bitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class="line">            &#x2F;&#x2F;这里可以进行图片相关的处理，注释的代码是设置比例缩放</span><br><span class="line">&#x2F;&#x2F;            float mScale &#x3D; (mRadius * 2.0f) &#x2F; Math.min(bitmap.getHeight(), bitmap.getWidth());</span><br><span class="line">&#x2F;&#x2F;            mMatrix.setScale(mScale, mScale);</span><br><span class="line">&#x2F;&#x2F;            mBitmapShader.setLocalMatrix(mMatrix);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mPaint.setShader(mBitmapShader);</span><br><span class="line">        canvas.drawCircle(mRadius, mRadius, mRadius, mPaint);</span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH) &#123;</span><br><span class="line">            canvas.drawCircle(mRadius, mRadius, mRadius-mBorderWidth&#x2F;2, mBorderPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Bitmap drawableToBitmap(Drawable drawable) &#123;</span><br><span class="line">        if (drawable &#x3D;&#x3D; null)</span><br><span class="line">            return null;</span><br><span class="line">        if (drawable instanceof BitmapDrawable) &#123;</span><br><span class="line">            return ((BitmapDrawable) drawable).getBitmap();</span><br><span class="line">        &#125;</span><br><span class="line">        int width &#x3D; drawable.getIntrinsicWidth();</span><br><span class="line">        int height &#x3D; drawable.getIntrinsicHeight();</span><br><span class="line">        &#x2F;&#x2F;ARGB_8888 表示颜色色由4个8位组成即32位</span><br><span class="line">        Bitmap bitmap &#x3D; Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</span><br><span class="line">        Canvas canvas &#x3D; new Canvas(bitmap);</span><br><span class="line">        drawable.setBounds(0, 0, width, height);</span><br><span class="line">        drawable.draw(canvas);</span><br><span class="line">        return bitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与用这种方式实现没有边框的圆形图片相比，并添加复杂的逻辑，只是再次基础上画了一个圆，我们将画圆的画笔<code>setStrokeWidth</code>设置我们要实现的边框即可。</p>
<h2 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h2><p>实现比较简单，支持复杂的图片处理。</p>
<h2 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h2><p>需要两次处理<code>drawable</code>，性能还是有一点的开销。</p>
<h1 id="通过clipPath裁剪的方式"><a href="#通过clipPath裁剪的方式" class="headerlink" title="通过clipPath裁剪的方式"></a>通过clipPath裁剪的方式</h1><h2 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h2><p>我们在裁剪好的图片上画一个圆边框即可。与第二种方式实现圆类似。</p>
<h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView3 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    public static final int DEFAULT_BORDER_WIDTH &#x3D; 0;</span><br><span class="line">    private float mRadius;</span><br><span class="line">    private int mBorderWidth;</span><br><span class="line">    private int mBorderColor;</span><br><span class="line">    private Paint mBorderPaint;</span><br><span class="line">    private Path mPath;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context) &#123;</span><br><span class="line">        this(context,null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs,0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(@Nullable AttributeSet attrs) &#123;</span><br><span class="line">        if (attrs!&#x3D;null)&#123;</span><br><span class="line">            TypedArray a &#x3D; getContext().obtainStyledAttributes(attrs, R.styleable.CircleImageView3);</span><br><span class="line">            mBorderWidth &#x3D; a.getDimensionPixelSize(R.styleable.CircleImageView3_circle_border_width3, DEFAULT_BORDER_WIDTH);</span><br><span class="line">            mBorderColor &#x3D; a.getInt(R.styleable.CircleImageView3_circle_border_color3, Color.BLACK);</span><br><span class="line">            a.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">        if (mBorderWidth !&#x3D; DEFAULT_BORDER_WIDTH)&#123;</span><br><span class="line">            mBorderPaint &#x3D; new Paint();</span><br><span class="line">            mBorderPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">            mBorderPaint.setAntiAlias(true);</span><br><span class="line">            mBorderPaint.setColor(mBorderColor);</span><br><span class="line">            mBorderPaint.setStrokeWidth(mBorderWidth);</span><br><span class="line">        &#125;</span><br><span class="line">        mPath &#x3D; new Path();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(),getMaxWidth());</span><br><span class="line">        mRadius &#x3D; min&#x2F;2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        mPath.addCircle(mRadius, mRadius, mRadius,Path.Direction.CW);</span><br><span class="line">        canvas.clipPath(mPath);</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        canvas.drawCircle(mRadius, mRadius, mRadius-mBorderWidth&#x2F;2, mBorderPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h2><p>实现简单，不需要额外操作<code>drawble</code>，简单粗暴。</p>
<h2 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h2><p>不支持复杂的图片处理。</p>
<p>源代码链接:<a href="https://github.com/Reoger/CurtomViewTest" target="_blank" rel="noopener">https://github.com/Reoger/CurtomViewTest</a><br>上一篇链接:<a href="https://blog.csdn.net/Reoger/article/details/81394579" target="_blank" rel="noopener">https://blog.csdn.net/Reoger/article/details/81394579</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/08/02/android/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E6%88%90%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/02/android/%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B9%8B%E5%B0%86%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E6%88%90%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87/" class="post-title-link" itemprop="url">自定义View之将图片裁剪成圆形图片</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-02 16:44:55" itemprop="dateCreated datePublished" datetime="2018-08-02T16:44:55+08:00">2018-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:35:34" itemprop="dateModified" datetime="2020-07-18T14:35:34+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="自定义View之将图片裁剪成圆形图片"><a href="#自定义View之将图片裁剪成圆形图片" class="headerlink" title="自定义View之将图片裁剪成圆形图片"></a>自定义View之将图片裁剪成圆形图片</h1><h2 id="使用PorterDuffXfermode方式来实现"><a href="#使用PorterDuffXfermode方式来实现" class="headerlink" title="使用PorterDuffXfermode方式来实现"></a>使用PorterDuffXfermode方式来实现</h2><p>在使用这中方式之前，我们有必要弄清楚<code>PorterBuddx</code>究竟是什么。<br>简单来说，他是定义的一种图像融合的方式，具体的模式有如下几种，效果如图：<br><img src="https://upload-images.jianshu.io/upload_images/2041548-d964105abf4be5d9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/312" alt="官方的说明图"></p>
<p>在次，不多做介绍，想深入了解<code>PorterDuffXfermode</code>可以参考<a href="https://www.jianshu.com/p/d11892bbe055" target="_blank" rel="noopener">各个击破搞明白PorterDuff.Mode</a><br>本次使用mode是<code>SRCIN</code>,由图效果可知，我们需要在原图上绘制一个圆，原图与我们绘制得圆重叠得区域就会显示出来，原理很简单，下面开始代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView1 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private Shape mShape;</span><br><span class="line">    private float mRadius;</span><br><span class="line"></span><br><span class="line">    private float[] outerRadii &#x3D; new float[8];;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context) &#123;</span><br><span class="line">        this(context,null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context,attrs,0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView1(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView() &#123;</span><br><span class="line">        setLayerType(LAYER_TYPE_HARDWARE,null);</span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setColor(Color.BLACK);</span><br><span class="line">        &#x2F;&#x2F;注意这里，将画笔的PorterDuffXfermode模式设置为了DST_IN模式！！！</span><br><span class="line">        mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.DST_IN));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int width &#x3D; getMeasuredWidth();</span><br><span class="line">        int height &#x3D; getMeasuredHeight();</span><br><span class="line">        int min &#x3D; Math.min(width,height);</span><br><span class="line">        mRadius &#x3D; min&#x2F;2;</span><br><span class="line">        setMeasuredDimension(min,min);</span><br><span class="line">        &#x2F;&#x2F;因为是圆，所以要设置为长宽相等</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">        super.onLayout(changed, left, top, right, bottom);</span><br><span class="line">        if (changed)&#123;</span><br><span class="line">            if (mShape &#x3D;&#x3D; null)&#123;</span><br><span class="line">                Arrays.fill(outerRadii,mRadius);</span><br><span class="line">                mShape &#x3D; new RoundRectShape(outerRadii,null,null);</span><br><span class="line">                &#x2F;&#x2F;</span><br><span class="line">            &#125;</span><br><span class="line">            mShape.resize(getWidth(),getHeight());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        int saveCount &#x3D; canvas.getSaveCount();</span><br><span class="line">        canvas.save();</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        if (mShape !&#x3D; null)&#123;</span><br><span class="line">            mShape.draw(canvas,mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restoreToCount(saveCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 这里直接使用Glide库来加载图片，也可以在xml文件或者java代码中设置图片</span><br><span class="line">    public void build(String url)&#123;</span><br><span class="line">        Glide.with(getContext()).load(url).into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在布局中的引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;ScrollView xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class="line">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:background&#x3D;&quot;#333&quot;</span><br><span class="line">    tools:context&#x3D;&quot;com.example.cm.circleview.MainActivity&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center_horizontal&quot;</span><br><span class="line">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;com.example.cm.circleview.view.CircleImageView1</span><br><span class="line">            android:layout_marginTop&#x3D;&quot;10dp&quot;</span><br><span class="line">            android:layout_marginBottom&#x3D;&quot;10dp&quot;</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;image_id1&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;200dp&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;200dp&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;ScrollView&gt;</span><br></pre></td></tr></table></figure>
<p>通过java代码设置图片来源，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    public static final String URL &#x3D; &quot;https:&#x2F;&#x2F;timgsa.baidu.com&#x2F;timg?image&amp;quality&#x3D;80&amp;size&#x3D;b9999_10000&amp;sec&#x3D;1533271076118&amp;di&#x3D;&quot; +</span><br><span class="line">            &quot;4ef2b0b50abb957177874a76d828126a&amp;imgtype&#x3D;0&amp;src&#x3D;http%3A%2F%2Fwww.91danji.com%2Fattachments%2F201503%2F24%2F11%2F3q8s74tc8.jpeg&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        CircleImageView1 circleImageView1 &#x3D; findViewById(R.id.image_id1);</span><br><span class="line">        circleImageView1.build(URL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为项目使用到了<code>Glide</code>,所以需要在module的<code>build.grade</code>文件中添加必要的依赖，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;com.github.bumptech.glide:glide:3.8.0&#39;</span><br></pre></td></tr></table></figure>
<p>因为图片来自网路，需在<code>androidMainFest</code>中添加联网权限。<br>显示效果如图：<br><img src="http://ovec6nnof.bkt.clouddn.com/dump_4314198875772344884.png" alt="效果图"></p>
<p>此次的实现都是最简单的实现，没有添加额外的逻辑，代码比较少，便于理解。<br>后续会在这个的基础上添加稍微复杂点的图像处理。</p>
<h3 id="使用小结"><a href="#使用小结" class="headerlink" title="使用小结"></a>使用小结</h3><p>通过该方式使得图片展现成圆形，需要开启硬件加速，否则图片的渲染效果达不到理想的效果，具体原因可以参照：<a href="https://blog.csdn.net/hqdoremi/article/details/8307496" target="_blank" rel="noopener">硬件加速 setlayertype</a>。<br>我们可以通过<code>shape</code>或者<code>drawable</code>来绘制圆，使用然后通过图片的叠加显示来显示我们需要的原型图片的效果。这种方式就是通过绘制一个圆盖在原来的图片上，通过设置两张图片叠加显示效果来实现显示圆角图片</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>该方式不需要操作原来的<code>drawable</code>,使用起来风险比较小，也比较方便。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>需要启动硬件加速，否则可能会出现意想不到的结果。</p>
<h2 id="使用BitmapShader重新绘制实现圆形图片"><a href="#使用BitmapShader重新绘制实现圆形图片" class="headerlink" title="使用BitmapShader重新绘制实现圆形图片"></a>使用BitmapShader重新绘制实现圆形图片</h2><p>整体思路： 通过对原来图片进行处理，将原图片裁剪成圆形然后绘制展示。<br>贴上<code>CircleImageView2</code>的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView2 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    private Paint mPaint;</span><br><span class="line">    private int mRadius;</span><br><span class="line">    private float mScale;</span><br><span class="line">    private Matrix mMatrix;</span><br><span class="line"></span><br><span class="line">    private BitmapShader mBitmapShader;</span><br><span class="line"></span><br><span class="line">    public static final String TAG &#x3D; &quot;CircleImageView2&quot;;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView2(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(AttributeSet attrs) &#123;</span><br><span class="line"></span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setAntiAlias(true);</span><br><span class="line">        mMatrix &#x3D; new Matrix();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(), getMeasuredWidth());</span><br><span class="line">        mRadius &#x3D; min &#x2F; 2;</span><br><span class="line">        setMeasuredDimension(min, min);</span><br><span class="line">        &#x2F;&#x2F;强制设置成宽度和高度一致</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        if (mBitmapShader &#x3D;&#x3D; null) &#123;</span><br><span class="line">            Bitmap bitmap &#x3D; drawableToBitmap(getDrawable());</span><br><span class="line">            &#x2F;&#x2F;CLAMP表示，当所画图形的尺寸大于Bitmap的尺寸的时候，会用Bitmap四边的颜色填充剩余空间。</span><br><span class="line">            &#x2F;&#x2F;REPEAT表示，当我们绘制的图形尺寸大于Bitmap尺寸时，会用Bitmap重复平铺整个绘制的区域</span><br><span class="line">            &#x2F;&#x2F;MIRROR与REPEAT类似，当绘制的图形尺寸大于Bitmap尺寸时，MIRROR也会用Bitmap重复平铺整个绘图区域，与REPEAT不同的是，两个相邻的Bitmap互为镜像。</span><br><span class="line">            mBitmapShader &#x3D; new BitmapShader(bitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class="line">            &#x2F;&#x2F;计算缩放比例</span><br><span class="line">            mScale &#x3D; (mRadius * 2.0f) &#x2F; Math.min(bitmap.getHeight(), bitmap.getWidth());</span><br><span class="line">            mMatrix.setScale(mScale, mScale);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;设置图片缩放</span><br><span class="line">        mBitmapShader.setLocalMatrix(mMatrix);</span><br><span class="line">        mPaint.setShader(mBitmapShader);</span><br><span class="line">        canvas.drawCircle(mRadius, mRadius, mRadius, mPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 将圆图片转化成bitmap</span><br><span class="line">    private Bitmap drawableToBitmap(Drawable drawable) &#123;</span><br><span class="line">        if (drawable instanceof BitmapDrawable) &#123;</span><br><span class="line">            return ((BitmapDrawable) drawable).getBitmap();</span><br><span class="line">        &#125;</span><br><span class="line">        int width &#x3D; drawable.getIntrinsicWidth();</span><br><span class="line">        int height &#x3D; drawable.getIntrinsicHeight();</span><br><span class="line">        &#x2F;&#x2F;ARGB_8888 表示颜色色由4个8位组成即32位</span><br><span class="line">        Bitmap bitmap &#x3D; Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</span><br><span class="line">        Canvas canvas &#x3D; new Canvas(bitmap);</span><br><span class="line">        drawable.setBounds(0, 0, width, height);</span><br><span class="line">        drawable.draw(canvas);</span><br><span class="line">        return bitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现逻辑：</strong><br>首先将获得的<code>drawable</code>转化成<code>bitmap</code>,然后通过<a href="https://www.cnblogs.com/tianzhijiexian/p/4298660.html" target="_blank" rel="noopener">BitmapShader</a>处理<code>bitmap</code>,并将其设置给画笔，当使用此画笔绘制时，该<code>bitmap</code>就会展示出来，如此我们只需要使用画布绘制一个圆形即可。</p>
<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><p>可以实现对图片复杂的处理，可扩展性较强。</p>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><p>实现起来较为复杂，且有对</p>
<h1 id="通过clipPath裁剪的方式"><a href="#通过clipPath裁剪的方式" class="headerlink" title="通过clipPath裁剪的方式"></a>通过clipPath裁剪的方式</h1><p>这种方式最简单暴力，直接在原来的图片上进行裁剪就ok了，如果不需要对图片进行处理的画，推荐用这种方式，因为，简单，粗暴！<br>直接上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public class CircleImageView3 extends ImageView &#123;</span><br><span class="line"></span><br><span class="line">    private float mRadius;</span><br><span class="line">    private Path mPath;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context) &#123;</span><br><span class="line">        this(context,null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs,0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CircleImageView3(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView() &#123;</span><br><span class="line">        mPath &#x3D; new Path();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int min &#x3D; Math.min(getMeasuredHeight(),getMaxWidth());</span><br><span class="line">        mRadius &#x3D; min&#x2F;2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        mPath.addCircle(mRadius, mRadius, mRadius,Path.Direction.CW);</span><br><span class="line">        canvas.clipPath(mPath);</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void build(String url) &#123;</span><br><span class="line">        Glide.with(getContext())</span><br><span class="line">                .load(url)</span><br><span class="line">                .into(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>没什么好说的，关键就一句<code>canvas.clipPath(mPath);</code>，需要关注一下<a href="https://blog.csdn.net/xiangzhihong8/article/details/78278931" target="_blank" rel="noopener">path</a>的用法。</p>
<h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><p>简单粗暴，不涉及<code>drwable</code> 相关的操作，效率较高，实现也简单。</p>
<h3 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h3><p>因为是对图片的直接剪裁，不能实现对图片相关的处理，也没有抗锯齿效果，如果图片不是正方形图片可能会影响最终的效果。</p>
<p>源程序下载地址:<a href="https://github.com/Reoger/CurtomViewTest" target="_blank" rel="noopener">https://github.com/Reoger/CurtomViewTest</a></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>上述三种方式都能实现圆形图片的需求，但是各有优缺点。如果只是需要展示圆形图片而不需要对图片进行任何处理，可以选用第三种方式，需要对图片进行比较复杂的处理的画，则推荐第一种或者第二种方式。<br>本篇博客到此结束，下一篇将会使用上述的三种方式实现圆形外边框的效果。</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/lmj623565791/article/details/42094215" target="_blank" rel="noopener">Android Xfermode 实战 实现圆形、圆角图片</a></li>
<li><a href="https://blog.csdn.net/lmj623565791/article/details/24555655" target="_blank" rel="noopener">Android 完美实现图片圆角和圆形（对实现进行分析</a></li>
<li><a href="https://blog.csdn.net/a369414641/article/details/53198671" target="_blank" rel="noopener">Android圆形图片不求人，自定义View实现（BitmapShader使用）</a></li>
<li><a href="https://www.jianshu.com/p/626dbd93207d" target="_blank" rel="noopener">关于圆角ImageView的几种实现方式</a></li>
<li><a href="https://blog.csdn.net/iispring/article/details/50500106" target="_blank" rel="noopener">Android中Canvas绘图之Shader使用图文详解</a></li>
<li><a href="https://github.com/gavinliu/ShapedImageView" target="_blank" rel="noopener">ShapedImageView</a></li>
<li><a href="https://github.com/hdodenhof/CircleImageView" target="_blank" rel="noopener">CircleImageView</a></li>
<li><a href="https://blog.csdn.net/harvic880925/article/details/52039081" target="_blank" rel="noopener">自定义控件三部曲之绘图篇（十八）——BitmapShader与望远镜效果</a></li>
<li><a href="https://blog.csdn.net/aigestudio/article/details/41960507" target="_blank" rel="noopener">自定义控件其实很简单5/12</a></li>
<li><a href="https://blog.csdn.net/xiangzhihong8/article/details/78278931" target="_blank" rel="noopener">Android开发之Path详解</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/30/reprint/%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E6%90%AD%E5%BB%BASS(R)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/30/reprint/%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E6%90%AD%E5%BB%BASS(R)/" class="post-title-link" itemprop="url">一键脚本搭建SS/搭建SSR服务并开启BBR加速</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-30 15:44:55" itemprop="dateCreated datePublished" datetime="2018-07-30T15:44:55+08:00">2018-07-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:41:08" itemprop="dateModified" datetime="2020-07-18T14:41:08+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reprint/" itemprop="url" rel="index"><span itemprop="name">reprint</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一键脚本搭建SS-搭建SSR服务并开启BBR加速"><a href="#一键脚本搭建SS-搭建SSR服务并开启BBR加速" class="headerlink" title="一键脚本搭建SS/搭建SSR服务并开启BBR加速"></a>一键脚本搭建SS/搭建SSR服务并开启BBR加速</h1><p> 2018年1月20日 497条评论 127,696次阅读 293人点赞</p>
<p>自己写的一键搭建shadowsocks/搭建shadowsocksR的shell脚本，一键脚本适用<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr</a>上的和<a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener">搬瓦工</a>所有机型（CentOS、Ubuntu、Debian），搭建ss服务器支持所有<strong>客户端类型</strong>，本机你是iOS，Android，Windows，Mac，或者是Linux，搭建ss/ssr都是适用的科学上网方式。一键脚本搭建SS/SSR服务器，<strong>绝对没有任何问题</strong>，任何问题欢迎留言。一键脚本内容包括一键搭建shadowsocks/一键搭建shadowsocksR+一键开启bbr加速，适合新手小白。</p>
<p><strong>纯新手</strong>也可以搭建ss/ssr，录了个<strong>视频教程</strong>，不想看文字的可以看视频，或者结合起来一起看：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/#vultrss" target="_blank" rel="noopener">搭建ss视频教程</a>。</p>
<p>文章目录</p>
<ul>
<li><a href="#shadowsocks" title="什么是shadowsocks">什么是shadowsocks</a></li>
<li><a href="#ssssr" title="一键脚本搭建ss/ssr支持系统版本">一键脚本搭建ss/ssr支持系统版本</a></li>
<li><a href="#i" title="代理服务器购买">代理服务器购买</a></li>
<li><a href="#Linux" title="连接远程Linux服务器">连接远程Linux服务器</a></li>
<li><a href="#SSSSR" title="一键搭建SS/搭建SSR服务">一键搭建SS/搭建SSR服务</a><ul>
<li><a href="#shadowsocks-2" title="一键搭建shadowsocks">一键搭建shadowsocks</a></li>
<li><a href="#shadowsocksR" title="一键搭建shadowsocksR">一键搭建shadowsocksR</a></li>
</ul>
</li>
<li><a href="#BBR" title="一键开启BBR加速">一键开启BBR加速</a></li>
<li><a href="#shadowsocksshadowsockR" title="客户端搭建shadowsocks/shadowsockR代理实现科学上网">客户端搭建shadowsocks/shadowsockR代理实现科学上网</a><ul>
<li><a href="#ss" title="客户端搭建ss代理">客户端搭建ss代理</a></li>
<li><a href="#ssr" title="客户端搭建ssr代理">客户端搭建ssr代理</a></li>
</ul>
</li>
<li><a href="#vultrss" title="vultr搭建ss视频教程">vultr搭建ss视频教程</a></li>
<li><a href="#i-2" title="一键脚本更新日志">一键脚本更新日志</a></li>
</ul>
<h2 id="什么是shadowsocks"><a href="#什么是shadowsocks" class="headerlink" title="什么是shadowsocks"></a><strong>什么是shadowsocks</strong></h2><p>shadowsocks可以指一种SOCKS5的加密传输协议，也可以指基于这种加密协议的各种数据传输包。</p>
<p><strong>shadowsocks实现科学上网原理？</strong>shadowsocks正常工作需要服务器端和客户端两端合作实现，首先，客户端（本机）通过ss（shadowsocks）对正常的访问请求进行SOCK5加密，将加密后的访问请求传输给ss服务器端，服务器端接收到客户端的加密请求后，解密得到原始的访问请求，根据请求内容访问指定的网站（例如Google，YouTube，Facebook，instagram等），得到网站的返回结果后，再利用SOCKS5加密并返回给客户端，客户端通过ss解密后得到正常的访问结果，于是就可以实现你直接访问该网站的“假象”。</p>
<p><strong>为什么选择shadowsocks？</strong>不限终端（安卓，苹果，Windows，Mac都可用），流量便宜（服务器500G只要15元），方便（一键脚本，不需要专业知识）。</p>
<p><strong>为什么要自己搭建ss/ssr？</strong>你也许会觉得买ss服务也很方便，但是你得要考虑以下几个问题。首先，买的ss服务，限制很多，终端可能只能同时在线2个，每个月就一点点流量可能价格却不便宜，有时候还被别人做手脚，流量跑的贼快；其次，别人收钱跑路怎么办？很多这种情况的；更重要的是，如第一个问题中描述的shadowsocks原理，如果有心人做了一点手脚，是可以得到你的访问记录的；而自己搭建ss/ssr服务，一键脚本也就10来分钟就可以搞定。</p>
<h2 id="一键脚本搭建ss-ssr支持系统版本"><a href="#一键脚本搭建ss-ssr支持系统版本" class="headerlink" title="一键脚本搭建ss/ssr支持系统版本"></a><strong>一键脚本搭建ss/ssr支持系统版本</strong></h2><p>脚本系统支持：CentOS 6+，Debian 7+，Ubuntu 12+</p>
<p>注：这个脚本支持的系统版本是指ss服务器的版本（都没看过也没关系，不影响搭建），你本机是Windows、Mac、Linux，或者你想用手机端搭建ss/ssr服务器，安卓和苹果，都是可以的。</p>
<h2 id="代理服务器购买"><a href="#代理服务器购买" class="headerlink" title="代理服务器购买"></a><strong>代理服务器购买</strong></h2><p>作为跳板的代理服务器推荐<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr</a>和<a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener">搬瓦工</a>，一是因为本脚本在这两家的所有VPS都做了测试，二是因为都是老牌VPS服务商，不怕跑路。</p>
<p>推荐你们使用Vultr：<a href="https://www.flyzy2005.win/goto/vultr" target="_blank" rel="noopener">优惠注册链接</a>，购买图解与节点推荐可以参考<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr购买图解步骤</a>，最低月付2.5刀，也是目前博主自用以及运行小站的VPS，月付方便，随时重置。</p>
<p>对于宽带是电信或者是联通的用户，可以试一下搬瓦工的CN2<strong>电信/联通直连线路</strong>（季付/半年付/年付），<strong>GT线路</strong>详情可以参考<a href="https://www.flyzy2005.win/vps/bandwagon-cn2/" target="_blank" rel="noopener">搬瓦工洛杉矶CN2 GT线路测评</a>。如果想体验最优的<strong>GIA线路</strong>，也可以尝试搬瓦工CN2 GIA线路（<strong>强力推荐</strong>，效果爆炸，全程CN2，年付平均下来一个月30元左右，晚上高峰时期线路也不拥堵。2018年5月15日正式启动，<a href="https://www.flyzy2005.win/vps/bandwagonhost-cn2-gia/" target="_blank" rel="noopener">搬瓦工洛杉矶CN2 GIA线路测评</a>），当然你也可以直接用<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">Vultr</a>，搬瓦工暂时不支持月付。</p>
<p>Vultr和搬瓦工上的所有机型是绝对可以一键脚本搭建shadowsocks/搭建shadowsocksR+开启bbr加速成功的，任何问题<strong>欢迎留言</strong>~</p>
<h2 id="连接远程Linux服务器"><a href="#连接远程Linux服务器" class="headerlink" title="连接远程Linux服务器"></a><strong>连接远程Linux服务器</strong></h2><p>购买完成后根据<a href="https://www.flyzy2005.win/tech/linux/xshell-connect-linux/" target="_blank" rel="noopener">Windows通过Xshell连接Linux</a>或者<a href="https://www.flyzy2005.win/tech/linux/mac-connect-vps-linux/" target="_blank" rel="noopener">Mac通过Terminal远程连接Linux</a>即可。</p>
<p>你如果身边没有电脑，一定要搞什么手机搭建ss服务器 <img src="https://www.flyzy2005.win/wp-content/themes/Kratos/images/smilies/symbols.png" alt=":symbols:"> 也是可以的，毕竟一键脚本只需要复制几行脚本命令就行了。iOS用户可以使用Termius这个工具，直接在App Store下载就行。Android没有用过，反正能ssh连接的软件就行~</p>
<h2 id="一键搭建SS-搭建SSR服务"><a href="#一键搭建SS-搭建SSR服务" class="headerlink" title="一键搭建SS/搭建SSR服务"></a><strong>一键搭建SS/搭建SSR服务</strong></h2><p>注意，shadowsocks/shadowsocksR这两个<strong>只需要搭建一个</strong>就可以了！！！！SS与SSR之间的比较一直是各有各的说法，王婆卖瓜自卖自夸。我用的是SS，因为SS的iOS版本比较容易下载，并且被没有觉得ss容易被探查到~</p>
<h3 id="一键搭建shadowsocks"><a href="#一键搭建shadowsocks" class="headerlink" title="一键搭建shadowsocks"></a><strong>一键搭建shadowsocks</strong></h3><p>在<a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener">购买VPS</a>并用<a href="https://www.flyzy2005.win/tech/linux/xshell-connect-linux/" target="_blank" rel="noopener">Xshell连接上你刚购买的VPS</a>后，你将看到如下图所示的界面：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/vutlr-connect-result.png" alt="vutlr-connect-result"></p>
<p>如红框中所示，root@vult（root@ubuntu）说明已经连接成功了，之后你只需要<strong>在绿色光标处直接复制以下代码</strong>就可以了（直接复制即可，如每段代码下方截图中所示）。</p>
<p>1.下载一键搭建ss脚本文件（直接在绿色光标处复制该行命令回车即可，<strong>只需要执行一次</strong>，卸载ss后也不需要重新下载）</p>
<p> <textarea class="crayon-plain print-no" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" readonly="readonly" wrap="soft" data-settings="dblclick">git clone <a href="https://github.com/flyzy2005/ss-fly" target="_blank" rel="noopener">https://github.com/flyzy2005/ss-fly</a></textarea></p>
<p> <code>git clone https://github.com/flyzy2005/ss-fly</code></p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/shadowsocks-ss-fly-clone.png" alt="shadowsocks-ss-fly-clone"></p>
<p>如果提示<code>bash: git: command not found</code>，则先安装git：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Centos执行这个： yum -y install git</span><br><span class="line">Ubuntu&#x2F;Debian执行这个： apt-get -y install git</span><br></pre></td></tr></table></figure>


<p>2.运行搭建ss脚本代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -i flyzy2005.com 1024</span><br></pre></td></tr></table></figure>

<p>其中<strong>flyzy2005.com</strong>换成你要设置的shadowsocks的密码即可（这个<strong>flyzy2005.com</strong>就是你ss的密码了，是需要填在客户端的密码那一栏的），密码随便设置，最好<strong>只包含字母+数字</strong>，一些特殊字符可能会导致冲突。而第二个参数<strong>1024</strong>是<strong>端口号</strong>，也可以不加，不加默认是1024~（<strong>举个例子</strong>，脚本命令可以是ss-fly/ss-fly.sh -i qwerasd，也可以是ss-fly/ss-fly.sh -i qwerasd 8585，后者指定了服务器端口为8585，前者则是默认的端口号1024，两个命令设置的ss密码都是qwerasd）：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/shadowsocks-install.png" alt="shadowsocks-install"></p>
<p>界面如下就表示一键搭建ss成功了：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-success-new.png" alt="ss-fly-success-new"></p>
<p>注：如果需要改密码或者改端口，只需要重新<strong>再执行一次搭建ss脚本代码</strong>就可以了，或者修改<code>/etc/shadowsocks.json</code>这个配置文件。</p>
<p>3.相关ss操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">修改配置文件：vim &#x2F;etc&#x2F;shadowsocks.json</span><br><span class="line"></span><br><span class="line">停止ss服务：ssserver -c &#x2F;etc&#x2F;shadowsocks.json -d stop</span><br><span class="line"></span><br><span class="line">启动ss服务：ssserver -c &#x2F;etc&#x2F;shadowsocks.json -d start</span><br><span class="line"></span><br><span class="line">重启ss服务：ssserver -c &#x2F;etc&#x2F;shadowsocks.json -d restart</span><br></pre></td></tr></table></figure>
<p>4.卸载ss服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -uninstall</span><br></pre></td></tr></table></figure>

<h3 id="一键搭建shadowsocksR"><a href="#一键搭建shadowsocksR" class="headerlink" title="一键搭建shadowsocksR"></a><strong>一键搭建shadowsocksR</strong></h3><p><strong>再次提醒</strong>，如果安装了SS，就不需要再安装SSR了，如果要改装SSR，请按照上一部分内容的教程先卸载SS！！！</p>
<p>1.下载一键搭建ssr脚本（<strong>只需要执行一次</strong>，卸载ssr后也不需要重新执行）</p>
<p><code>git clone https://github.com/flyzy2005/ss-fly</code>，此步骤与一键搭建ss一致，可以参考：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/#shadowsocks" target="_blank" rel="noopener">下载脚本</a></p>
<p>2.运行搭建ssr脚本代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -ssr</span><br></pre></td></tr></table></figure>

<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-insall-ssr.png" alt="ss-fly-insall-ssr"></p>
<p>3.输入对应的参数</p>
<p>执行完上述的脚本代码后，会进入到输入参数的界面，包括服务器端口，密码，加密方式，协议，混淆。可以直接输入回车选择默认值，也可以输入相应的值选择对应的选项：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-bbr-options.png" alt="ss-fly-ssr-options"></p>
<p>全部选择结束后，会看到如下界面，就说明搭建ssr成功了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Congratulations, ShadowsocksR server install completed!</span><br><span class="line"></span><br><span class="line">Your Server IP        :你的服务器ip</span><br><span class="line"></span><br><span class="line">Your Server Port      :你的端口</span><br><span class="line"></span><br><span class="line">Your Password :你的密码</span><br><span class="line"></span><br><span class="line">Your Protocol :你的协议</span><br><span class="line"></span><br><span class="line">Your obfs :你的混淆</span><br><span class="line"></span><br><span class="line">Your Encryption Method:your_encryption_method</span><br><span class="line"></span><br><span class="line">Welcome to visit:https:&#x2F;&#x2F;shadowsocks.be&#x2F;9.html</span><br><span class="line"></span><br><span class="line">Enjoy it!</span><br></pre></td></tr></table></figure>

<p>4.相关操作ssr命令<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">启动：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks start</span><br><span class="line"></span><br><span class="line">停止：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks stop</span><br><span class="line"></span><br><span class="line">重启：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks restart</span><br><span class="line"></span><br><span class="line">状态：&#x2F;etc&#x2F;init.d&#x2F;shadowsocks status</span><br><span class="line"></span><br><span class="line">配置文件路径：&#x2F;etc&#x2F;shadowsocks.json</span><br><span class="line"></span><br><span class="line">日志文件路径：&#x2F;var&#x2F;log&#x2F;shadowsocks.log</span><br><span class="line"></span><br><span class="line">代码安装目录：&#x2F;usr&#x2F;local&#x2F;shadowsocks</span><br></pre></td></tr></table></figure><br>5.卸载ssr服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;shadowsocksR.sh uninstall</span><br></pre></td></tr></table></figure>

<h2 id="一键开启BBR加速"><a href="#一键开启BBR加速" class="headerlink" title="一键开启BBR加速"></a><strong>一键开启BBR加速</strong></h2><p>BBR是Google开源的一套内核加速算法，可以让你搭建的shadowsocks/shadowsocksR速度上一个台阶，本一键搭建ss/ssr脚本支持一键升级最新版本的内核并开启BBR加速。</p>
<p>BBR支持4.9以上的，如果低于这个版本则会自动下载最新内容版本的内核后开启BBR加速并重启，如果高于4.9以上则自动开启BBR加速，执行如下脚本命令即可自动开启BBR加速：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-fly&#x2F;ss-fly.sh -bbr</span><br></pre></td></tr></table></figure>

<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ss-fly-bbr-success-new.png" alt="ss-fly-bbr-success-new"></p>
<p>装完后需要重启系统，输入y即可立即重启，或者之后输入<code>reboot</code>命令重启。</p>
<p>判断BBR加速有没有开启成功。输入以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br></pre></td></tr></table></figure>

<p>如果返回值为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_available_congestion_control &#x3D; bbr cubic reno</span><br></pre></td></tr></table></figure>

<p>后面有bbr，则说明已经开启成功了。</p>
<h2 id="客户端搭建shadowsocks-shadowsockR代理实现科学上网"><a href="#客户端搭建shadowsocks-shadowsockR代理实现科学上网" class="headerlink" title="客户端搭建shadowsocks/shadowsockR代理实现科学上网"></a><strong>客户端搭建shadowsocks/shadowsockR代理实现科学上网</strong></h2><h3 id="客户端搭建ss代理"><a href="#客户端搭建ss代理" class="headerlink" title="客户端搭建ss代理"></a><strong>客户端搭建ss代理</strong></h3><p>各种客户端版本下载地址：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/ss-clients-download/" target="_blank" rel="noopener">各版本shadowsocks客户端下载地址</a></p>
<p>以Windows为例（<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-pc-windows-config/" target="_blank" rel="noopener">shadowsocks电脑版（windows）客户端配置教程</a>）：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/shadowsocks-pc-windows.png" alt="shadowsocks-pc-windows"></p>
<p>在状态栏右击shadowsocks，勾选<strong>开机启动</strong>和<strong>启动系统代理</strong>，在<strong>系统代理模式</strong>中选择<strong>PAC模式</strong>，<strong>服务器</strong>-&gt;<strong>编辑服务器</strong>，一键安装shadowsocks的脚本默认服务器端口是1024，加密方式是aes-256-cfb，密码是你设置的密码，ip是你自己的VPS ip，保存即可~</p>
<p><strong>PAC模式</strong>是指国内可以访问的站点直接访问，不能直接访问的再走shadowsocks代理~</p>
<p>OK！一键脚本搭建shadowsocks完毕！科学上网吧，兄弟！<a href="https://www.flyzy2005.win/go/go.php?url=https://www.google.com/" target="_blank" rel="noopener">Google</a></p>
<h3 id="客户端搭建ssr代理"><a href="#客户端搭建ssr代理" class="headerlink" title="客户端搭建ssr代理"></a><strong>客户端搭建ssr代理</strong></h3><p>各种客户端版本下载地址：<a href="https://www.flyzy2005.win/fan-qiang/shadowsocksr/ss-ssr-clients/" target="_blank" rel="noopener">各版本SS客户端&amp;SSR客户端官方下载地址</a></p>
<p>以Windows为例：</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2018/01/ssr-pc-windows-config.png" alt="ssr-pc-windows-config"></p>
<p>在状态栏右击shadowsocksR，在<strong>系统代理模式</strong>中选择<strong>PAC模式</strong>，再左击两次状态栏的图标打开编辑服务器界面，如上图所示，按照自己的服务器配置填充内容<strong>，</strong>保存即可~</p>
<p><strong>PAC模式</strong>是指国内可以访问的站点直接访问，不能直接访问的再走shadowsocksR代理~</p>
<p>OK！一键脚本搭建shadowsocksR完毕！科学上网吧，兄弟！<a href="https://www.flyzy2005.win/go/go.php?url=https://www.google.com/" target="_blank" rel="noopener">Google</a></p>
<h2 id="vultr搭建ss视频教程"><a href="#vultr搭建ss视频教程" class="headerlink" title="vultr搭建ss视频教程"></a><strong>vultr搭建ss视频教程</strong></h2><p>应读者要求录了个视频教程，如果你觉得这些文字还不够生动，不够清楚的话，可以看一下视频教程。</p>
<p>视频获取方式：关注微信公众号<strong>flyzy小站</strong>，发送<strong>视频</strong>即可获得。</p>
<p><img src="https://www.flyzy2005.win/wp-content/uploads/2017/12/flyzy.jpg" alt="flyzy小站"></p>
<h2 id="一键脚本更新日志"><a href="#一键脚本更新日志" class="headerlink" title="一键脚本更新日志"></a><strong>一键脚本更新日志</strong></h2><p>一键脚本源码：<a href="https://www.flyzy2005.win/go/go.php?url=https://github.com/flyzy2005/ss-fly" target="_blank" rel="noopener">一键搭建shadowoscks/搭建shadowsocksR并开启bbr内核加速</a></p>
<p>2018年1月20日，上传一键安装shadowsocks脚本</p>
<p>2018年1月24日，添加升级内核并开启BBR加速功能</p>
<p>2018年3月28日，将升级内核&amp;&amp;开启BBR加速集成在一个命令中</p>
<p>2018年4月4日，添加一键安装shadowsocksR功能（调用的teddysun大大的<a href="https://www.flyzy2005.win/go/go.php?url=https://shadowsocks.be/9.html" target="_blank" rel="noopener">一键搭建SSR脚本</a> <img src="https://www.flyzy2005.win/wp-content/themes/Kratos/images/smilies/eek.png" alt=":eek:"> ）</p>
<p>2018年4月27日，支持Ubuntu/CentOS/Debian</p>
<p>2018年5月29日，支持<a href="https://www.flyzy2005.win/v2ray/how-to-build-v2ray/" target="_blank" rel="noopener">一键安装V2Ray</a></p>
<p>关注公众号<strong>flyzy小站</strong>，上面有一些搭建shadowsocks<strong>常见问题</strong>的总结<del>如果还是不行，欢迎在公众号留言</del></p>
<p><strong>声明</strong>：本文只作为技术分享，请遵守相关法律，严禁做违法乱纪的事情！</p>
<p>Telegram频道已经开通，关注<a href="https://www.flyzy2005.win/go/?https://t.me/flyzythink" target="_blank" rel="noopener">flyzythink</a>，随手分享正能量，了解VPS优惠与补货<br>Telegram群组已经开通，加入<a href="https://www.flyzy2005.win/go/?https://t.me/flyzyxiaozhan" target="_blank" rel="noopener">flyzy小站</a>，FREE TO TALK<br>QQ群开通：780593286 <a href="https://www.flyzy2005.win/go/?url=https://shang.qq.com/wpa/qunwpa?idkey=1e8e1c9e5c8056b05aaaa5e34f6dc9faa7b655610cc790884043b738ceebb753" target="_blank" rel="noopener"><img src="//pub.idqqimg.com/wpa/images/group.png" alt="flyzy小站" title="flyzy小站"></a></p>
<h3 id="原创声明"><a href="#原创声明" class="headerlink" title="原创声明"></a>原创声明</h3><p>该日志由 <a href="https://www.flyzy2005.win" target="_blank" rel="noopener" title="flyzy小站">flyzy小站</a> 于2018年01月20日发表在<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/" target="_blank" rel="noopener">shadowsocks</a>分类下， 你可以<a href="#respond">发表评论</a>，并在保留<a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/" target="_blank" rel="noopener">原文地址</a>及作者的情况下转载到你的网站或博客。<br>转载请注明: <a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/" target="_blank" rel="noopener" title="本文固定链接 https://www.flyzy2005.win/fan-qiang/shadowsocks/install-shadowsocks-in-one-command/">一键脚本搭建SS/搭建SSR服务并开启BBR加速 | flyzy小站</a><br>关键字: <a href="https://www.flyzy2005.win/tag/bbr%e4%b8%80%e9%94%ae/" target="_blank" rel="noopener">bbr一键</a>, <a href="https://www.flyzy2005.win/tag/shadowsock/" target="_blank" rel="noopener">shadowsock</a>, <a href="https://www.flyzy2005.win/tag/ss-ssr%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">ss/ssr脚本</a>, <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e6%90%ad%e5%bb%bass%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">一键搭建ss脚本</a>, <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e8%84%9a%e6%9c%ac%e6%90%ad%e5%bb%bassr/" target="_blank" rel="noopener">一键脚本搭建ssr</a>, <a href="https://www.flyzy2005.win/tag/fan-qiang/" target="_blank" rel="noopener">科学上网</a></p>
<p> <img src="https://www.flyzy2005.win/wp-content/uploads/2017/12/flyzy.jpg" alt="weinxin"><br> <strong>我的微信公众号</strong></p>
<p> “flyzy小站”：关注VPS测评与优惠，玩机教程，技术分享，留言及时回复</p>
<p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
<p> <a href="https://www.flyzy2005.win/tag/bbr%e4%b8%80%e9%94%ae/" target="_blank" rel="noopener">bbr一键</a> <a href="https://www.flyzy2005.win/tag/shadowsock/" target="_blank" rel="noopener">shadowsock</a> <a href="https://www.flyzy2005.win/tag/ss-ssr%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">ss/ssr脚本</a> <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e6%90%ad%e5%bb%bass%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">一键搭建ss脚本</a> <a href="https://www.flyzy2005.win/tag/%e4%b8%80%e9%94%ae%e8%84%9a%e6%9c%ac%e6%90%ad%e5%bb%bassr/" target="_blank" rel="noopener">一键脚本搭建ssr</a> <a href="https://www.flyzy2005.win/tag/fan-qiang/" target="_blank" rel="noopener">科学上网</a></p>
<p> <a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/ss-clients-download/" target="_blank" rel="noopener" title="各版本shadowsocks客户端下载地址">&lt; 上一篇</a></p>
<p> <a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/free-ss-account/" target="_blank" rel="noopener" title="科学上网ss账号分享">下一篇 &gt;</a></p>
<h3 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h3><ul>
<li><a href="https://www.flyzy2005.win/v2ray/how-to-build-v2ray/" target="_blank" rel="noopener" title="一键脚本搭建V2Ray V2Ray配置与优化">一键脚本搭建V2Ray V2Ray配置与优化</a></li>
<li><a href="https://www.flyzy2005.win/tech/shadowsocks-google-scholar/" target="_blank" rel="noopener" title="shadowsocks无法打开谷歌学术或出现验证码">shadowsocks无法打开谷歌学术或出现验证码</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-mac-os-config/" target="_blank" rel="noopener" title="shadowsocks电脑版（Mac）客户端配置教程">shadowsocks电脑版（Mac）客户端配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-android-config/" target="_blank" rel="noopener" title="shadowsocks手机版（Android/安卓）客户端影梭配置教程">shadowsocks手机版（Android/安卓）客户端影梭配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-iphone-ios-config/" target="_blank" rel="noopener" title="shadowsocks手机版（iOS/苹果）客户端配置教程">shadowsocks手机版（iOS/苹果）客户端配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-pc-windows-config/" target="_blank" rel="noopener" title="shadowsocks电脑版（windows）客户端配置教程">shadowsocks电脑版（windows）客户端配置教程</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/ss-clients-baidu-cloud-download/" target="_blank" rel="noopener" title="各版本shadowsocks客户端百度云下载地址">各版本shadowsocks客户端百度云下载地址</a></li>
<li><a href="https://www.flyzy2005.win/fan-qiang/shadowsocks/shadowsocks-manager-config/" target="_blank" rel="noopener" title="shadowsocks-manager实现ss多用户管理与流量限制">shadowsocks-manager实现ss多用户管理与流量限制</a></li>
</ul>
<h4 id="热门标签"><a href="#热门标签" class="headerlink" title="热门标签"></a>热门标签</h4><p> <a href="https://www.flyzy2005.win/tag/%e6%90%ac%e7%93%a6%e5%b7%a5/" target="_blank" rel="noopener">搬瓦工</a> <a href="https://www.flyzy2005.win/tag/linux/" target="_blank" rel="noopener">Linux</a> <a href="https://www.flyzy2005.win/tag/shadowsock%e9%85%8d%e7%bd%ae/" target="_blank" rel="noopener">shadowsock配置</a> <a href="https://www.flyzy2005.win/tag/multi-users/" target="_blank" rel="noopener">多用户</a> <a href="https://www.flyzy2005.win/tag/java%e7%bc%96%e7%a8%8b%e6%80%9d%e6%83%b3%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0/" target="_blank" rel="noopener">Java编程思想读书笔记</a> <a href="https://www.flyzy2005.win/tag/baidu-union/" target="_blank" rel="noopener">百度联盟</a> <a href="https://www.flyzy2005.win/tag/vps/" target="_blank" rel="noopener">VPS</a> <a href="https://www.flyzy2005.win/tag/iptables/" target="_blank" rel="noopener">iptables</a> <a href="https://www.flyzy2005.win/tag/jvm/" target="_blank" rel="noopener">JVM</a> <a href="https://www.flyzy2005.win/tag/shadowsock/" target="_blank" rel="noopener">shadowsock</a> <a href="https://www.flyzy2005.win/tag/utils/" target="_blank" rel="noopener">工具</a> <a href="https://www.flyzy2005.win/tag/seo/" target="_blank" rel="noopener">SEO</a> <a href="https://www.flyzy2005.win/tag/wordpress/" target="_blank" rel="noopener">WordPress</a> <a href="https://www.flyzy2005.win/tag/vultr/" target="_blank" rel="noopener">vultr</a> <a href="https://www.flyzy2005.win/tag/digitalocean/" target="_blank" rel="noopener">DigitalOcean</a> <a href="https://www.flyzy2005.win/tag/ss/" target="_blank" rel="noopener">ss</a> <a href="https://www.flyzy2005.win/tag/fan-qiang/" target="_blank" rel="noopener">科学上网</a> <a href="https://www.flyzy2005.win/tag/build-page/" target="_blank" rel="noopener">建站</a> <a href="https://www.flyzy2005.win/tag/data-structure/" target="_blank" rel="noopener">数据结构</a> <a href="https://www.flyzy2005.win/tag/cn2-vps%e6%8e%a8%e8%8d%90/" target="_blank" rel="noopener">CN2 vps推荐</a></p>
<h4 id="VPS推荐"><a href="#VPS推荐" class="headerlink" title="VPS推荐"></a>VPS推荐</h4><p>| <a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener"><img src="https://www.flyzy2005.win/wp-content/uploads/2018/04/bandwagon.png" alt="搬瓦工优惠券优惠码"></a><br><a href="https://www.flyzy2005.win/vps/bandwagon-coupon-buy/" target="_blank" rel="noopener"><strong>搬瓦工：</strong>年付最低仅需18.79美元</a> |<br>| <a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener"><img src="https://www.flyzy2005.win/wp-content/uploads/2018/06/vultr-logo-300-new.png" alt="vultr优惠码"></a><br><a href="https://www.flyzy2005.win/vps/vultr-deploy/" target="_blank" rel="noopener"><strong>Vultr：</strong>15个数据中心，最低2.5美元/月</a> |<br>| <a href="https://www.flyzy2005.win/vps/gigsgigscloud-hk-vps/" target="_blank" rel="noopener"><img src="https://www.flyzy2005.win/wp-content/uploads/2018/07/ggc-logo.png" alt="gigsgigscloud优惠码"></a><br><a href="https://www.flyzy2005.win/vps/gigsgigscloud-hk-vps/" target="_blank" rel="noopener"><strong>GigsGigsCloud：</strong>香港VPS，三网直连</a> |</p>
<h4 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h4><ul>
<li><a href="https://www.vultryhw.com" target="_blank" rel="noopener" title="Vultr优惠网 分享Vultr的最新优惠券/优惠码/优惠活动">Vultr优惠网</a></li>
<li><a href="https://www.bwgyhw.com" target="_blank" rel="noopener" title="搬瓦工优惠网 分享BandwagonHost的最新优惠卷/优惠码/优惠活动">搬瓦工优惠网</a></li>
<li><a href="https://www.flyzy2005.win/go/?url=https://shang.qq.com/wpa/qunwpa?idkey=1e8e1c9e5c8056b05aaaa5e34f6dc9faa7b655610cc790884043b738ceebb753" target="_blank" rel="noopener" title="flyzy小站QQ交流群">QQ群组</a></li>
<li><a href="https://www.flyzy2005.win/go/go.php?url=https://t.me/flyzyxiaozhan" target="_blank" rel="noopener" title="加入群组，随意聊天">Telegram群组</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/07/27/android/%E6%82%AC%E6%B5%AE%E7%AA%97%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/27/android/%E6%82%AC%E6%B5%AE%E7%AA%97%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93/" class="post-title-link" itemprop="url">悬浮窗使用小结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-27 09:44:55" itemprop="dateCreated datePublished" datetime="2018-07-27T09:44:55+08:00">2018-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:35:48" itemprop="dateModified" datetime="2020-07-18T14:35:48+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="window简介"><a href="#window简介" class="headerlink" title="window简介"></a>window简介</h1><p>Window 有三种类型，分别是应用 Window、子 Window 和系统 Window。应用类 Window 对应一个 Acitivity，子 Window 不能单独存在，需要依附在特定的父 Window 中，比如常见的一些 Dialog 就是一个子 Window。系统 Window是需要声明权限才能创建的 Window，比如 Toast 和系统状态栏都是系统 Window。</p>
<p>Window 是分层的，每个 Window 都有对应的 z-ordered，层级大的会覆盖在层级小的 Window 上面，这和 HTML 中的 z-index 概念是完全一致的。在三种 Window 中，应用 Window 层级范围是 1<del>99，子 Window 层级范围是 1000</del>1999，系统 Window 层级范围是 2000<del>2999，我们可以用一个表格来直观的表示：<br>|Window|层级|<br>|—|—-|<br>|应用 Window|1</del>99|<br>|子 Window|1000<del>1999|<br>|应用 Window|2000</del>2999|<br>这些层级范围对应着 WindowManager.LayoutParams 的 type 参数，如果想要 Window 位于所有 Window 的最顶层，那么采用较大的层级即可，很显然系统 Window 的层级是最大的，当我们采用系统层级时，需要声明权限。</p>
<h1 id="悬浮窗简单使用"><a href="#悬浮窗简单使用" class="headerlink" title="悬浮窗简单使用"></a>悬浮窗简单使用</h1><p>悬浮窗通过<code>WindowManager</code>来实现，它提供的三个重要的方法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void addView(View view, ViewGroup.LayoutParams params);</span><br><span class="line">public void updateViewLayout(View view, ViewGroup.LayoutParams params);</span><br><span class="line">public void removeView(View view);</span><br></pre></td></tr></table></figure>
<p>我们只需要将需要显示的view添加到<code>windowManager</code>中即可。但是因为是系统层的显示，在<code>addView</code>时需要必要的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name&#x3D;&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>并且在android 6.0及以上的版本时，还需要申请动态权限，这里就不展开了。</p>
<h1 id="悬浮窗工具类"><a href="#悬浮窗工具类" class="headerlink" title="悬浮窗工具类"></a>悬浮窗工具类</h1><p>通过一个工具类实现通过悬浮窗实现类似于toast的效果。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">public class FloatWindowManager &#123;</span><br><span class="line"></span><br><span class="line">    private WindowManager.LayoutParams mParams;</span><br><span class="line">    private WindowManager mWindowManager;</span><br><span class="line"></span><br><span class="line">    private boolean mIsRunning &#x3D; false;</span><br><span class="line">    private boolean mIsAutoDisMiss &#x3D; true;</span><br><span class="line"></span><br><span class="line">    private TimerTask mTask;</span><br><span class="line">    private Timer mTimer;</span><br><span class="line"></span><br><span class="line">    public final static int DEFAULT_FINISH_TIME &#x3D; 2000;</span><br><span class="line">    private int mAutoDismissTime &#x3D; DEFAULT_FINISH_TIME;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager() &#123;</span><br><span class="line">        mWindowManager &#x3D; (WindowManager) HostHelper.getAppContext().getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">        mParams &#x3D; new WindowManager.LayoutParams();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager initParams() &#123;</span><br><span class="line">        if (mParams !&#x3D; null) &#123;</span><br><span class="line">            if (Build.VERSION.SDK_INT &gt;&#x3D; 26) &#123;</span><br><span class="line">                mParams.type &#x3D; WindowManager.LayoutParams.TYPE_PHONE;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                mParams.type &#x3D; WindowManager.LayoutParams.TYPE_SYSTEM_ALERT;</span><br><span class="line">            &#125;</span><br><span class="line">            mParams.flags &#x3D; WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_SCALED</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_LAYOUT_INSET_DECOR</span><br><span class="line">                    | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN;</span><br><span class="line">            mParams.format &#x3D; PixelFormat.RGBA_8888;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setLocation(int x,int y,int width,int height)&#123;</span><br><span class="line">        if (mParams!&#x3D;null)&#123;</span><br><span class="line">            mParams.x &#x3D; x;</span><br><span class="line">            mParams.y &#x3D; y;</span><br><span class="line">            mParams.height &#x3D; height;</span><br><span class="line">            mParams.width &#x3D; width;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setGravity(int gravity)&#123;</span><br><span class="line">        if (mParams!&#x3D;null)&#123;</span><br><span class="line">            mParams.gravity &#x3D; gravity;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setAnim(int anim)&#123;</span><br><span class="line">        if (mParams!&#x3D;null)&#123;</span><br><span class="line">            mParams.windowAnimations &#x3D; anim;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FloatWindowManager setAutoDismiss(boolean autoDismiss)&#123;</span><br><span class="line">        this.mIsAutoDisMiss &#x3D; autoDismiss;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public boolean show(View view) &#123;</span><br><span class="line">        if(CloudConfigUtils.getToastActivityShow())&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                if (mWindowManager !&#x3D; null &amp;&amp; mParams!&#x3D;null &amp;&amp; !mIsRunning) &#123;</span><br><span class="line">                    mWindowManager.addView(view, mParams);</span><br><span class="line">                    if (mIsAutoDisMiss)&#123;</span><br><span class="line">                        finishByTime(view);</span><br><span class="line">                    &#125;</span><br><span class="line">                    Log.d(&quot;FloatWindowManager&quot;,&quot; view is added!&quot;);</span><br><span class="line">                    mIsRunning &#x3D; true;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                mIsRunning &#x3D; false;</span><br><span class="line">                Log.d(&quot;FloatWindowManager&quot;, &quot;addView go something wrong!&quot;);</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void finishByTime(final View view)&#123;</span><br><span class="line">        mTimer &#x3D; new Timer();</span><br><span class="line">        mTask &#x3D; new TimerTask() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                finisSelf(view);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        mTimer.schedule(mTask, mAutoDismissTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void finisSelf(final View view)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            if (mWindowManager !&#x3D;null &amp;&amp; mParams!&#x3D;null &amp;&amp; mIsRunning)&#123;</span><br><span class="line">                mWindowManager.removeView(view);</span><br><span class="line">                mIsRunning &#x3D; false;</span><br><span class="line">                if (mTask!&#x3D;null)</span><br><span class="line">                    mTask &#x3D; null;</span><br><span class="line">                if (mTimer!&#x3D;null)</span><br><span class="line">                    mTimer &#x3D; null;</span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(&quot;FloatWindowManager&quot;,&quot; view is remove!&quot;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            mIsRunning &#x3D; false;</span><br><span class="line">            if (mTask!&#x3D;null)</span><br><span class="line">                mTask &#x3D; null;</span><br><span class="line">            if (mTimer!&#x3D;null)</span><br><span class="line">                mTimer &#x3D; null;</span><br><span class="line">            Log.d(&quot;FloatWindowManager&quot;, &quot;remove go something wrong!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用也很简单，只需要一行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;自定义view</span><br><span class="line">final AccountToastLayout layout &#x3D; new AccountToastLayout(mContext);</span><br><span class="line">&#x2F;&#x2F;通知测量自定义view的宽和高</span><br><span class="line">layout.measure(View.MeasureSpec.UNSPECIFIED,View.MeasureSpec.UNSPECIFIED);</span><br><span class="line">int weight &#x3D; layout.getMeasuredWidth();</span><br><span class="line">final int height &#x3D; layout.getMeasuredHeight();</span><br><span class="line">FloatWindowManager windowManager &#x3D; new FloatWindowManager();</span><br><span class="line">windowManager.initParams().setAutoDismiss(true).setAnim(R.style.anim).setGravity(Gravity.BOTTOM|Gravity.END)</span><br><span class="line">                    .setLocation(0,y,weight,height).show(layout);</span><br></pre></td></tr></table></figure>

<h2 id="windowManager中相关属性的介绍"><a href="#windowManager中相关属性的介绍" class="headerlink" title="windowManager中相关属性的介绍"></a>windowManager中相关属性的介绍</h2><h3 id="type字段介绍"><a href="#type字段介绍" class="headerlink" title="type字段介绍"></a>type字段介绍</h3><table>
<thead>
<tr>
<th>value</th>
<th>key</th>
<th align="center">作用</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>2031</td>
<td><code>TYPE_ACCESSIBILITY_OVERLAY</code></td>
<td align="center">用于拦截用户交互而不更改窗口，可访问性服务可以内省。</td>
<td>added in API level 22</td>
</tr>
<tr>
<td>2</td>
<td><code>TYPE_APPLICATION</code></td>
<td align="center">正常的应用程序窗口。token必须是标识activity所属window的标记。</td>
<td>added in API level 1</td>
</tr>
<tr>
<td>1003</td>
<td><code>TYPE_APPLICATION_ATTACHED_DIALOG</code></td>
<td align="center">类似于<code>TYPE_APPLICATION_PANEL</code>,但窗口的布局与顶层窗口的布局相同，而不是其容器的子窗口。</td>
<td>added in API level 3</td>
</tr>
<tr>
<td>1001</td>
<td><code>TYPE_APPLICATION_MEDIA</code></td>
<td align="center">用于显示媒体的窗口（例如视频）。这些窗口显示在其附加窗口后面。</td>
<td>added in API level 3</td>
</tr>
</tbody></table>
<p>….</p>
<h3 id="flag字段介绍"><a href="#flag字段介绍" class="headerlink" title="flag字段介绍"></a>flag字段介绍</h3><p>看这里<a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams" target="_blank" rel="noopener">https://developer.android.com/reference/android/view/WindowManager.LayoutParams</a></p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://blog.csdn.net/yhaolpz/article/details/68936932" target="_blank" rel="noopener">Android 带你彻底理解 Window 和 WindowManager</a></li>
<li><a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams" target="_blank" rel="noopener">https://developer.android.com/reference/android/view/WindowManager.LayoutParams</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">reoger</p>
  <div class="site-description" itemprop="description">reoger</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/reoger" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;reoger" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:reoger112@gmail.com" title="E-Mail → mailto:reoger112@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">reoger</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
