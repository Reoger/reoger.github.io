<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"reoger.tk","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="reoger">
<meta property="og:type" content="website">
<meta property="og:title" content="reoger的记录">
<meta property="og:url" content="http://reoger.tk/index.html">
<meta property="og:site_name" content="reoger的记录">
<meta property="og:description" content="reoger">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="reoger">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://reoger.tk/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>reoger的记录</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">reoger的记录</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">--以后的你会感激现在那么努力的自己</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2020/07/12/android/android%20%E4%B8%AD%E7%9A%84%20Unsafe%20%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/12/android/android%20%E4%B8%AD%E7%9A%84%20Unsafe%20%E7%B1%BB/" class="post-title-link" itemprop="url">android 中的 Unsafe</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-12 10:23:33" itemprop="dateCreated datePublished" datetime="2020-07-12T10:23:33+08:00">2020-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:45:11" itemprop="dateModified" datetime="2020-07-18T14:45:11+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="unSafe-类之初见"><a href="#unSafe-类之初见" class="headerlink" title="unSafe 类之初见"></a>unSafe 类之初见</h1><p>假设有如下的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data class Person(var name: String, var age: Int)</span><br><span class="line"></span><br><span class="line">private fun test() &#123;</span><br><span class="line"> val person &#x3D; Gson().fromJson(&quot;&#123;  \&quot;age\&quot;:1 &#125;&quot;, Person::class.java)</span><br><span class="line">        Log.d(TAG, &quot;persion :$&#123;person.age&#125; &amp; $&#123;person.name&#125; &quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码，执行 <code>test</code> 函数之后会怎么样？ </p>
<ol>
<li>在执行 <code>fromJson</code> 时就抛出空指针异常？因为 <code>name</code>为<code>null</code> ?</li>
<li>返回的 <code>person</code> 为 <code>null</code>, 导致后续执行抛出空指针?</li>
<li><code>test()</code> 正常执行，输出 <code>persion: 1 null</code></li>
<li><code>test()</code> 正常执行，输出 <code>persion: 1</code></li>
</ol>
<p><strong>答案应该是 3</strong></p>
<p>通过源码的角度来快速了解一下 <code>gson</code> 转换成对应对象的过程<br><code>Gson</code>类中的 <code>fromJson</code>相关实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public &lt;T&gt; T fromJson(String json, Class&lt;T&gt; classOfT) throws JsonSyntaxException &#123;</span><br><span class="line">   &#x2F;&#x2F;转化成功都在 fromJson 方法中, 重点</span><br><span class="line">  Object object &#x3D; fromJson(json, (Type) classOfT);</span><br><span class="line">  return Primitives.wrap(classOfT).cast(object);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">public &lt;T&gt; T fromJson(String json, Type typeOfT) throws JsonSyntaxException &#123;</span><br><span class="line">  if (json &#x3D;&#x3D; null) &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  StringReader reader &#x3D; new StringReader(json);</span><br><span class="line">  &#x2F;&#x2F; 从 StringReader 转化成对应的对象, 重点</span><br><span class="line">  T target &#x3D; (T) fromJson(reader, typeOfT);</span><br><span class="line">  return target;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public &lt;T&gt; T fromJson(Reader json, Type typeOfT) throws JsonIOException, JsonSyntaxException &#123;</span><br><span class="line">  JsonReader jsonReader &#x3D; newJsonReader(json);</span><br><span class="line">  T object &#x3D; (T) fromJson(jsonReader, typeOfT);</span><br><span class="line">  assertFullConsumption(object, jsonReader);</span><br><span class="line">  return object;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> public &lt;T&gt; T fromJson(JsonReader reader, Type typeOfT) throws JsonIOException, JsonSyntaxException &#123;</span><br><span class="line">  boolean isEmpty &#x3D; true;</span><br><span class="line">  boolean oldLenient &#x3D; reader.isLenient();</span><br><span class="line">  reader.setLenient(true);</span><br><span class="line">  try &#123;</span><br><span class="line">    reader.peek();</span><br><span class="line">    isEmpty &#x3D; false;</span><br><span class="line">    TypeToken&lt;T&gt; typeToken &#x3D; (TypeToken&lt;T&gt;) TypeToken.get(typeOfT);</span><br><span class="line">    &#x2F;&#x2F; 通过 typeToken 获得 TypeAdapter&lt;T&gt;,TypeAdapter 就是抓换成目标对象的关键</span><br><span class="line">    TypeAdapter&lt;T&gt; typeAdapter &#x3D; getAdapter(typeToken);</span><br><span class="line">    T object &#x3D; typeAdapter.read(reader);</span><br><span class="line">    return object;</span><br><span class="line">  &#125; catch (EOFException e) &#123;</span><br><span class="line">      ...</span><br><span class="line">      &#x2F;&#x2F;省略了异常处理相关代码</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>从上述源码来看，<code>fromJson</code> 通过将传入的数据转化成 <code>StringReader</code> ，通过 <code>getAdapter</code>方法就传入的 <code>class</code>示例话成对象，然后数据<code>read</code> 到示例化出来的对象之后，返回，就达到了将 json 数据转换成 bean 对象的目的。了解了大致流程之后，我们主要关注 <code>getAdapter(typeToken)</code> 是如何获取到合适的对象，并最终实例化出来的。<br>下面是 <code>getAdapter(typeToken)</code> 部分代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line"> public &lt;T&gt; TypeAdapter&lt;T&gt; getAdapter(TypeToken&lt;T&gt; type) &#123;</span><br><span class="line">  ...</span><br><span class="line">     for (TypeAdapterFactory factory : factories) &#123;</span><br><span class="line">       TypeAdapter&lt;T&gt; candidate &#x3D; factory.create(this, type);</span><br><span class="line">       if (candidate !&#x3D; null) &#123;</span><br><span class="line">         call.setDelegate(candidate);</span><br><span class="line">         typeTokenCache.put(type, candidate);</span><br><span class="line">         return candidate;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>这里是通过 <code>ReflectiveTypeAdapterFactory</code> 来构建具体的 <code>adapter</code> 的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Override public &lt;T&gt; TypeAdapter&lt;T&gt; create(Gson gson, final TypeToken&lt;T&gt; type) &#123;</span><br><span class="line">  Class&lt;? super T&gt; raw &#x3D; type.getRawType();</span><br><span class="line"></span><br><span class="line">  if (!Object.class.isAssignableFrom(raw)) &#123;</span><br><span class="line">    return null; &#x2F;&#x2F; it&#39;s a primitive!</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ObjectConstructor&lt;T&gt; constructor &#x3D; constructorConstructor.get(type);</span><br><span class="line">  return new Adapter&lt;T&gt;(constructor, getBoundFields(gson, type, raw));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重点看一下 <code>constructorConstructor.get(type)</code> 这个方法的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public &lt;T&gt; ObjectConstructor&lt;T&gt; get(TypeToken&lt;T&gt; typeToken) &#123;</span><br><span class="line">    ...</span><br><span class="line">    ObjectConstructor&lt;T&gt; defaultConstructor &#x3D; newDefaultConstructor(rawType);</span><br><span class="line">    if (defaultConstructor !&#x3D; null) &#123;</span><br><span class="line">      return defaultConstructor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ObjectConstructor&lt;T&gt; defaultImplementation &#x3D; newDefaultImplementationConstructor(type, rawType);</span><br><span class="line">    if (defaultImplementation !&#x3D; null) &#123;</span><br><span class="line">      return defaultImplementation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; finally try unsafe</span><br><span class="line">    return newUnsafeAllocator(type, rawType);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到最终，有三个 <code>Constructor</code></p>
<ol>
<li>newDefaultConstructor 尝试获取了无参的构造函数，则通过 <code>newInstance</code>反射方式构建对象</li>
<li>newDefaultImplementationConstructor 集合类相关的构建，如果传入类的不是 <code>Map</code>、<code>Collection</code>等相关的类，则会返回 <code>null</code>,返回返回对应的集合。</li>
<li>newUnsafeAllocator 最后通过 <code>unsafe</code> 的方式来构建</li>
</ol>
<p>我们主要看最后一个方法的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private &lt;T&gt; ObjectConstructor&lt;T&gt; newUnsafeAllocator(</span><br><span class="line">    final Type type, final Class&lt;? super T&gt; rawType) &#123;</span><br><span class="line">  return new ObjectConstructor&lt;T&gt;() &#123;</span><br><span class="line">    private final UnsafeAllocator unsafeAllocator &#x3D; UnsafeAllocator.create();</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    @Override public T construct() &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        Object newInstance &#x3D; unsafeAllocator.newInstance(rawType);</span><br><span class="line">        return (T) newInstance;</span><br><span class="line">      &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new RuntimeException((&quot;Unable to invoke no-args constructor for &quot; + type + &quot;. &quot;</span><br><span class="line">            + &quot;Registering an InstanceCreator with Gson for this type may fix this problem.&quot;), e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看起来就是通过 <code>UnsafeAllocator.create();</code> 获得了一个构造器，最终通过调用 <code>newInstance()</code> 将其构造出来了，那么是什么样的构造器，竟然能跳过 <code>kotlin</code> 的空值判断，创建一个属性值为 null 的对象，下面来看其实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public static UnsafeAllocator create() &#123;</span><br><span class="line">  &#x2F;&#x2F; try JVM</span><br><span class="line">  &#x2F;&#x2F; public class Unsafe &#123;</span><br><span class="line">  &#x2F;&#x2F;   public Object allocateInstance(Class&lt;?&gt; type);</span><br><span class="line">  &#x2F;&#x2F; &#125;</span><br><span class="line">  try &#123;</span><br><span class="line">    Class&lt;?&gt; unsafeClass &#x3D; Class.forName(&quot;sun.misc.Unsafe&quot;);</span><br><span class="line">    Field f &#x3D; unsafeClass.getDeclaredField(&quot;theUnsafe&quot;);</span><br><span class="line">    f.setAccessible(true);</span><br><span class="line">    final Object unsafe &#x3D; f.get(null);</span><br><span class="line">    final Method allocateInstance &#x3D; unsafeClass.getMethod(&quot;allocateInstance&quot;, Class.class);</span><br><span class="line">    return new UnsafeAllocator() &#123;</span><br><span class="line">      @Override</span><br><span class="line">      @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">      public &lt;T&gt; T newInstance(Class&lt;T&gt; c) throws Exception &#123;</span><br><span class="line">        assertInstantiable(c);</span><br><span class="line">        return (T) allocateInstance.invoke(unsafe, c);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; catch (Exception ignored) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到着，终于发现 <code>UnsafeAllocator</code> 的庐山真面目了，原来就是他通过 <code>sun.misc.Unsafe</code> 类绕过了构造方法，直接构建了一个对象。</p>
<p>了解了他的实现原来之后，我们可以给予他，也创建过不需要执行构造方法的对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private fun testCreate() &#123;</span><br><span class="line">        val unsafeAllocator &#x3D; UnsafeAllocator.create()</span><br><span class="line">        val person1 &#x3D; unsafeAllocator.newInstance(Person::class.java)</span><br><span class="line">        person1.age &#x3D; 112;</span><br><span class="line">        Log.d(TAG, &quot; person1 $&#123;person1.name&#125; and $&#123;person1.age&#125;&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，也可以完全不实用他的构建方法，自己通过 <code>UnSafe</code>实现也是一样。</p>
<h2 id="Unsafe-类的作用"><a href="#Unsafe-类的作用" class="headerlink" title="Unsafe 类的作用"></a>Unsafe 类的作用</h2><p><img src="https://p1.meituan.net/travelcube/f182555953e29cec76497ebaec526fd1297846.png" alt="Java魔法类：Unsafe应用解析"></p>
<p>java 中的 CAS 操作也基本上是通过 unSafe 类来实现的，包括 <code>AtomicInteger</code>,``</p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul>
<li><a href="https://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.html" target="_blank" rel="noopener">Java魔法类：Unsafe应用解析</a></li>
<li><a href="https://mp.weixin.qq.com/s/jVRTFTiwTtr7P7vyAj8G7A" target="_blank" rel="noopener">Android避坑指南，发现了一个极度不安全的操作</a></li>
<li><a href="https://blog.csdn.net/zyzzxycj/article/details/89877863" target="_blank" rel="noopener">深入理解sun.misc.Unsafe原理</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2020/07/11/android/android%20%E4%B8%AD%E7%9A%84%20textView%20%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/11/android/android%20%E4%B8%AD%E7%9A%84%20textView%20%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B/" class="post-title-link" itemprop="url">android中的类加载</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-11 10:23:33" itemprop="dateCreated datePublished" datetime="2020-07-11T10:23:33+08:00">2020-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:37:33" itemprop="dateModified" datetime="2020-07-18T14:37:33+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="带着问题看源码"><a href="#带着问题看源码" class="headerlink" title="带着问题看源码"></a>带着问题看源码</h2><ol>
<li>TextView 的整体渲染流程<br> 主要有 staticLayout（分块绘制）、（动作监听）、（文本渲染处理，展示成 ** 之类的）、（）</li>
<li>TextView 怎么做到自动换行，怎么修改换行策略<br> 跑马灯的实现</li>
<li>TextView 在展示不下时，怎么处理的？··· 是怎么添加到末尾的？<br> 待续</li>
<li>TextView 怎么做到在文字末尾添加一个图标（多语言适配）<br> 待续</li>
</ol>
<p>知识点：为什么不能在主线程更新 UI</p>
<p>设计考虑：如果在更新 UI 时需要考虑多线程安全问题的话，会导致性能降低，为了避免这种性能降低，所以规定只能在 UI 线程中更新界面，如果不在主线程中做更新界面的实现的话，就会主动抛出异常。</p>
<p>onMeasure</p>
<p>onLayout</p>
<p>onDraw</p>
<p>三种 mode<br>unspeceieied 没有指定大小，子布局要求多大就多大<br>exatly 指定进行精确的大小，父布局说多大就多大<br>at_most 最大多大，父布局设置的上线，子 view 最大的高度或者宽度</p>
<p>MeasureSpec.UNSPECIFIED（0）<br>、MeasureSpec.EXACTLY（1）<br>、和MeasureSpec.AT_MOST（2）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2020/07/08/kotlin/kotlin-%E4%B8%AD%E7%9A%84%E6%8B%93%E5%B1%95%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/08/kotlin/kotlin-%E4%B8%AD%E7%9A%84%E6%8B%93%E5%B1%95%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">kotlin 中的拓展函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-08 20:43:34" itemprop="dateCreated datePublished" datetime="2020-07-08T20:43:34+08:00">2020-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:40:36" itemprop="dateModified" datetime="2020-07-18T14:40:36+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kotlin/" itemprop="url" rel="index"><span itemprop="name">kotlin</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kotlin/let/" itemprop="url" rel="index"><span itemprop="name">let</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kotlin/let/run/" itemprop="url" rel="index"><span itemprop="name">run</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Kotlin-中的拓展函数"><a href="#Kotlin-中的拓展函数" class="headerlink" title="Kotlin 中的拓展函数"></a>Kotlin 中的拓展函数</h1><h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><p>作用：执行传入的函数，并返回执行结果。<br>调用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val test: String ?&#x3D; &quot;&quot; </span><br><span class="line">test?.run &#123; </span><br><span class="line">    print(&quot;run&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>run</code> 函数最终返回的是 <code>block</code> 执行的结果，<code>run</code> 函数内部没有指向调用者的 it.</p>
<p>实现源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">public inline fun &lt;R&gt; run(block: () -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    return block()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><p><code>with</code>语法糖不再是⼀个拓展函数了，⽽是需要在语法糖的第⼀个参数⾥⾯传⼊接收者对象的实例，第⼆个参数就是带接收者的函数<br>字⾯值实例，返回的也是 <code>block</code> 调⽤的结果，这⼀点和 run 语法糖类似。</p>
<p>调用示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val test: String ?&#x3D; &quot;&quot; </span><br><span class="line">    with(test) &#123;</span><br><span class="line">       print(&quot;with&quot;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>实现源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">public inline fun &lt;T, R&gt; with(receiver: T, block: T.() -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    return receiver.block()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h2><p>apply 函数内部会自带调用者，返回的是调用者本身。<br>调用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val test: String ?&#x3D; &quot;&quot; </span><br><span class="line">    test?.apply &#123; </span><br><span class="line">       substring(1)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>实现源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">public inline fun &lt;T&gt; T.apply(block: T.() -&gt; Unit): T &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    block()</span><br><span class="line">    return this</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="alos"><a href="#alos" class="headerlink" title="alos"></a>alos</h2><p><code>alos</code> 和 <code>let</code> 类似，区别在于 <code>alos</code> 的返回值是 caller 本身，而 <code>let</code> 返回的是 <code>block</code> 的执行结果。<br>调用示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val test: String ?&#x3D; &quot;&quot; </span><br><span class="line">test?.also &#123;</span><br><span class="line">        it.length</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>实现源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">@SinceKotlin(&quot;1.1&quot;)</span><br><span class="line">public inline fun &lt;T&gt; T.also(block: (T) -&gt; Unit): T &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    block(this)</span><br><span class="line">    return this</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="let"><a href="#let" class="headerlink" title="let"></a>let</h2><p><code>let</code> 方法块中，可以通过 it 来调用 caller, 返回值是方法块的执行结果。</p>
<p>调用示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val test: String ?&#x3D; &quot;&quot; </span><br><span class="line">test?.let &#123;</span><br><span class="line">        it.length</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">public inline fun &lt;T, R&gt; T.let(block: (T) -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    return block(this)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="takeIf"><a href="#takeIf" class="headerlink" title="takeIf"></a>takeIf</h2><p><code>takeIf</code> 要求方法块执行结果为 <code>Boolean</code>,如果 <code>block</code>执行的结果为 <code>ture</code>,则 <code>takeIf</code> 返回值为 <code>caller</code>,否则为 ``null。</p>
<p>调用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val test: String ?&#x3D; &quot;ii&quot; </span><br><span class="line">    test?.takeIf &#123; </span><br><span class="line">        !it.isBlank()</span><br><span class="line">    &#125;?.let &#123; </span><br><span class="line">        print(it)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">@SinceKotlin(&quot;1.1&quot;)</span><br><span class="line">public inline fun &lt;T&gt; T.takeIf(predicate: (T) -&gt; Boolean): T? &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(predicate, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    return if (predicate(this)) this else null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="takeUnless"><a href="#takeUnless" class="headerlink" title="takeUnless"></a>takeUnless</h2><p> <code>takeUnless</code> 和 <code>takeIf</code> 相反，当 <code>block</code> 执行结果为 <code>false</code>时，返回 <code>caller</code>，否则返回 <code>null</code></p>
<p> 调用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val test: String ?&#x3D; &quot;ii&quot; </span><br><span class="line">    test?.takeUnless &#123; </span><br><span class="line">        it.isBlank()</span><br><span class="line">    &#125;?.let &#123; </span><br><span class="line">        print(it)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">@SinceKotlin(&quot;1.1&quot;)</span><br><span class="line">public inline fun &lt;T&gt; T.takeUnless(predicate: (T) -&gt; Boolean): T? &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(predicate, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    return if (!predicate(this)) this else null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h2><p>需要重复的 action 模版，传入需要执行的次数，和需要执行的 <code>block</code> 即可。<br>调用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repeat(10) &#123; print(it)&#125;</span><br></pre></td></tr></table></figure>

<p>实现源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">public inline fun repeat(times: Int, action: (Int) -&gt; Unit) &#123;</span><br><span class="line">    contract &#123; callsInPlace(action) &#125;</span><br><span class="line"></span><br><span class="line">    for (index in 0 until times) &#123;</span><br><span class="line">        action(index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="referrers"><a href="#referrers" class="headerlink" title="referrers:"></a>referrers:</h2><ul>
<li><a href="https://aisia.moe/2018/03/25/kotlin-contracts-dsl/" target="_blank" rel="noopener">https://aisia.moe/2018/03/25/kotlin-contracts-dsl/</a></li>
<li><a href="https://segmentfault.com/a/1190000015434807#item-2-5" target="_blank" rel="noopener">https://segmentfault.com/a/1190000015434807#item-2-5</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2020/06/06/kotlin/Kotlin%20%E4%B8%AD%E7%9A%84%20trim%20%E5%92%8C%20Java%20%E4%B8%AD%20trim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/06/kotlin/Kotlin%20%E4%B8%AD%E7%9A%84%20trim%20%E5%92%8C%20Java%20%E4%B8%AD%20trim/" class="post-title-link" itemprop="url">Java 中的 trim() 和 kotlin 中的 trim()</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-06 17:34:05" itemprop="dateCreated datePublished" datetime="2020-06-06T17:34:05+08:00">2020-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:40:25" itemprop="dateModified" datetime="2020-07-18T14:40:25+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kotlin/" itemprop="url" rel="index"><span itemprop="name">kotlin</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="java-中-trim-方法的实现"><a href="#java-中-trim-方法的实现" class="headerlink" title="java 中 trim 方法的实现"></a>java 中 trim 方法的实现</h1><p>源代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public String trim() &#123;</span><br><span class="line">    int len &#x3D; value.length;</span><br><span class="line">    int st &#x3D; 0;</span><br><span class="line">    char[] val &#x3D; value;    &#x2F;* avoid getfield opcode *&#x2F;</span><br><span class="line"></span><br><span class="line">    while ((st &lt; len) &amp;&amp; (val[st] &lt;&#x3D; &#39; &#39;)) &#123;</span><br><span class="line">        st++;</span><br><span class="line">    &#125;</span><br><span class="line">    while ((st &lt; len) &amp;&amp; (val[len - 1] &lt;&#x3D; &#39; &#39;)) &#123;</span><br><span class="line">        len--;</span><br><span class="line">    &#125;</span><br><span class="line">    return ((st &gt; 0) || (len &lt; value.length)) ? substring(st, len) : this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，在 java 实现中， <code>trim</code>方法截取掉了前后 Unicode 小于等于空格的所有控制字符。具体截取的字符可以参考 <a href="https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%88%97%E8%A1%A8" target="_blank" rel="noopener">unicode 字符列表</a>.</p>
<h1 id="kotlin-中-trim-方法的实现"><a href="#kotlin-中-trim-方法的实现" class="headerlink" title="kotlin 中 trim() 方法的实现"></a>kotlin 中 trim() 方法的实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">public inline fun String.trim(): String &#x3D; (this as CharSequence).trim().toString()</span><br><span class="line"></span><br><span class="line">public fun CharSequence.trim(): CharSequence &#x3D; trim(Char::isWhitespace)</span><br><span class="line"></span><br><span class="line">public inline fun CharSequence.trim(predicate: (Char) -&gt; Boolean): CharSequence &#123;</span><br><span class="line">    var startIndex &#x3D; 0</span><br><span class="line">    var endIndex &#x3D; length - 1</span><br><span class="line">    var startFound &#x3D; false</span><br><span class="line"></span><br><span class="line">    while (startIndex &lt;&#x3D; endIndex) &#123;</span><br><span class="line">        val index &#x3D; if (!startFound) startIndex else endIndex</span><br><span class="line">        val match &#x3D; predicate(this[index])</span><br><span class="line"></span><br><span class="line">        if (!startFound) &#123;</span><br><span class="line">            if (!match)</span><br><span class="line">                startFound &#x3D; true</span><br><span class="line">            else</span><br><span class="line">                startIndex +&#x3D; 1</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (!match)</span><br><span class="line">                break</span><br><span class="line">            else</span><br><span class="line">                endIndex -&#x3D; 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return subSequence(startIndex, endIndex + 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，kotlin 中的 trim 方法和 java 中的 trim 方法实现基本差不多，唯一的差别就是匹配的字符规则不一样，在 java 匹配的规则是 <code>&lt;= &#39; &#39;</code>, 而 kotlin 中匹配的规则是 <code>Char::isWhitespace</code>。</p>
<p>接下来我们看看 <code>Char::isWhitespace</code> 的具体实现：<a href="https://github.com/JetBrains/kotlin/blob/deb416484c5128a6f4bc76c39a3d9878b38cec8c/libraries/stdlib/jvm/src/kotlin/text/CharJVM.kt#L72" target="_blank" rel="noopener">参考</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String.kt</span><br><span class="line">expect fun Char.isWhitespace(): Boolean</span><br><span class="line"></span><br><span class="line">实现在 charJVM.kt</span><br><span class="line">public actual fun Char.isWhitespace(): Boolean &#x3D; Character.isWhitespace(this) || Character.isSpaceChar(this)</span><br></pre></td></tr></table></figure>

<p>可以看到, 在 String.kt 中只是通过 <code>expect</code> 声明了这个方法，具体实现还是在 charJVM.kt 中。关于 <code>expect</code> 和 <code>actual</code> 的用法可以参考 <a href="https://www.kotlincn.net/docs/reference/platform-specific-declarations.html" target="_blank" rel="noopener">kotlin 平台相关声明</a>.</p>
<p>而在<code>Charactr</code> 类中，<code>isWhitespace()</code> 和 <code>isSpaceChar()</code>的实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public static boolean isWhitespace(char ch) &#123;</span><br><span class="line">    return isWhitespace((int)ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static boolean isWhitespace(int codePoint) &#123;</span><br><span class="line">    return CharacterData.of(codePoint).isWhitespace(codePoint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public static boolean isSpaceChar(char ch) &#123;</span><br><span class="line">    return isSpaceChar((int)ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static boolean isSpaceChar(int codePoint) &#123;</span><br><span class="line">    return ((((1 &lt;&lt; Character.SPACE_SEPARATOR) |</span><br><span class="line">              (1 &lt;&lt; Character.LINE_SEPARATOR) |</span><br><span class="line">              (1 &lt;&lt; Character.PARAGRAPH_SEPARATOR)) &gt;&gt; getType(codePoint)) &amp; 1)</span><br><span class="line">        !&#x3D; 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里 <code>isWhitespace()</code> 和 <code>isSpaceChar()</code> 的实现其实比较复杂，简单介绍一下其区别。</p>
<p><code>isWhiteSpace()</code>符合下面条件的字符将会返回 <code>true</code></p>
<li> It is a Unicode space character ({@code SPACE_SEPARATOR},
    {@code LINE_SEPARATOR}, or {@code PARAGRAPH_SEPARATOR})
    but is not also a non-breaking space ({@code '\u005Cu00A0'},
    {@code '\u005Cu2007'}, {@code '\u005Cu202F'}).
<li> It is {@code '\u005Ct'}, U+0009 HORIZONTAL TABULATION.
<li> It is {@code '\u005Cn'}, U+000A LINE FEED.
<li> It is {@code '\u005Cu000B'}, U+000B VERTICAL TABULATION.
<li> It is {@code '\u005Cf'}, U+000C FORM FEED.
<li> It is {@code '\u005Cr'}, U+000D CARRIAGE RETURN.
<li> It is {@code '\u005Cu001C'}, U+001C FILE SEPARATOR.
<li> It is {@code '\u005Cu001D'}, U+001D GROUP SEPARATOR.
<li> It is {@code '\u005Cu001E'}, U+001E RECORD SEPARATOR.
<li> It is {@code '\u005Cu001F'}, U+001F UNIT SEPARATOR.


<p><code>isSpaceChar()</code>用于检查<code>Unicodei</code>分割符和空格，参考<a href="https://zh.wikipedia.org/wiki/Unicode%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6" target="_blank" rel="noopener">Unicode控制字符</a>,分割符号包括</p>
<li> U+2028 line separator ，HTML：&#8232;，LSEP
<li> U+2029 paragraph separator ，HTML：&#8233;，PSEP



<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>在 java 中和 kotlin 中，因为 <code>trim</code> 方法中使用到的匹配规则不一样，所以他们对同一个串进行处理之后，结果可能也是不一样的。所以为了保险起见，建议不要使用分别用 java 和 kotlin 语言 trim 之后的字符串在进行比较，可能会得有意料之外的结果。</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%88%97%E8%A1%A8" target="_blank" rel="noopener">Unicode字符列表</a></li>
<li><a href="https://zh.wikipedia.org/wiki/Unicode%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6" target="_blank" rel="noopener">Unicode控制字符</a></li>
<li><a href="https://www.kotlincn.net/docs/reference/platform-specific-declarations.html" target="_blank" rel="noopener">kotlin 平台相关声明</a></li>
<li><a href="https://unicode-table.com/cn/blocks/control-character/" target="_blank" rel="noopener">Unicode 字符百科</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2020/05/17/java/hashMap%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/17/java/hashMap%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">ConcurrentHashMap 详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-17 15:43:05" itemprop="dateCreated datePublished" datetime="2020-05-17T15:43:05+08:00">2020-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:39:30" itemprop="dateModified" datetime="2020-07-18T14:39:30+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>问题：</p>
<ol>
<li>使用 Hashmap 进行 put 操作会引起死循环，导致CPU利用率接近100%，所以在并发情况下不能使用HashMap。<br>为什么会发生死循环？应该如何避免？</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">void transfer(Entry[] newTable, boolean rehash) &#123;</span><br><span class="line">         int newCapacity &#x3D; newTable.length;</span><br><span class="line">         for (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">             while(null !&#x3D; e) &#123;</span><br><span class="line">                 Entry&lt;K,V&gt; next &#x3D; e.next;</span><br><span class="line">                 if (rehash) &#123;</span><br><span class="line">                     e.hash &#x3D; null &#x3D;&#x3D; e.key ? 0 : hash(e.key);</span><br><span class="line">                 &#125;</span><br><span class="line">                 int i &#x3D; indexFor(e.hash, newCapacity);</span><br><span class="line">                 e.next &#x3D; newTable[i];</span><br><span class="line">                 newTable[i] &#x3D; e;</span><br><span class="line">                 e &#x3D; next;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>在多线程环境下，reset 方法中的 trasnsfer 函数中的复制，可能会导致链表成环。<br>因为在 while 循环中，会通过头插法，反序当前链表的顺序，在执行过程中可能会被另外一个线程错误的赋值，从而导致死循环。</p>
<ol start="2">
<li><p><code>HashTable</code> 利用<code>synchronized</code>关键字来证原子性，但是效率差。<br>效率为什么会会差<br>答：因为所有访问<code>HashTable</code>的线程都必须竞争同一把锁</p>
</li>
<li><p>JDK 8 中<code>ConcurrentHashMap</code> 是怎么保证多线程的效率的呢？<br>答：通过 CAS 原子锁 + node + sync 来保证。</p>
</li>
<li><p>JDK 7 <code>ConcurrentHashMap</code>实现远离<br>答：segment 分段锁，size（）这类全局都需要锁住的元素会先按顺序获取分段锁，如果获取失败，在重试两次后，会获取全局 synchronized 锁。</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/11/21/algorithm/Z%20%E5%AD%97%E5%BD%A2%E5%8F%98%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/21/algorithm/Z%20%E5%AD%97%E5%BD%A2%E5%8F%98%E6%8D%A2/" class="post-title-link" itemprop="url">Z 字形变换</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-21 23:23:48" itemprop="dateCreated datePublished" datetime="2018-11-21T23:23:48+08:00">2018-11-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:07:05" itemprop="dateModified" datetime="2020-04-12T23:07:05+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Z-字形变换"><a href="#Z-字形变换" class="headerlink" title="Z 字形变换"></a>Z 字形变换</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>将一个给定字符串根据给定的行数，以从上往下、从左到右进行 Z 字形排列。</p>
<p>比如输入字符串为 “LEETCODEISHIRING” 行数为 3 时，排列如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">L   C   I   R</span><br><span class="line">E T O E S I I G</span><br><span class="line">E   D   H   N</span><br></pre></td></tr></table></figure>
<p>之后，你的输出需要从左往右逐行读取，产生出一个新的字符串，比如：<code>&quot;LCIRETOESIIGEDHN&quot;</code>。</p>
<p>请你实现这个将字符串进行指定行数变换的函数：</p>
<p><code>string convert(string s, int numRows);</code><br>示例 1:</p>
<p>输入: s = “LEETCODEISHIRING”, numRows = 3<br>输出: “LCIRETOESIIGEDHN”<br>示例 2:</p>
<p>输入: s =<code>&quot;LEETCODEISHIRING&quot;</code>, numRows = 4<br>输出: “LDREOEIIECIHNTSG”<br>解释:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">L     D     R</span><br><span class="line">E   O E   I I</span><br><span class="line">E C   I H   N</span><br><span class="line">T     S     G</span><br></pre></td></tr></table></figure>

<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>思路</p>
<p>通过从左向右迭代字符串，我们可以轻松地确定字符位于 Z 字形图案中的哪一行。</p>
<p>算法</p>
<p>我们可以使用 \text{min}( \text{numRows}, \text{len}(s))min(numRows,len(s)) 个列表来表示 Z 字形图案中的非空行。</p>
<p>从左到右迭代 ss，将每个字符添加到合适的行。可以使用当前行和当前方向这两个变量对合适的行进行跟踪。</p>
<p>只有当我们向上移动到最上面的行或向下移动到最下面的行时，当前方向才会发生改变。</p>
<p>##代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public String convert(String s, int numRows) &#123;</span><br><span class="line">       if(numRows &#x3D;&#x3D; 1)&#123;</span><br><span class="line">           return s;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       List&lt;StringBuffer&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">       &#x2F;&#x2F; 初始化数组</span><br><span class="line">       for (int i &#x3D; 0; i &lt; Math.min(numRows, s.length()); i++) &#123;</span><br><span class="line">           list.add(new StringBuffer());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       int row &#x3D; 0;</span><br><span class="line">       boolean isAdd &#x3D; true;</span><br><span class="line">       for (char c : s.toCharArray()) &#123;</span><br><span class="line">           list.get(row).append(c);</span><br><span class="line">           if (isAdd)&#123;</span><br><span class="line">               row++;</span><br><span class="line">               if (row &gt;&#x3D; numRows-1)&#123;</span><br><span class="line">                   isAdd &#x3D; false;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; else&#123;</span><br><span class="line">               row--;</span><br><span class="line">               if (row &lt;&#x3D; 0)&#123;</span><br><span class="line">                   isAdd &#x3D; true;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       StringBuffer sb &#x3D; new StringBuffer();</span><br><span class="line">       for (StringBuffer stringBuffer : list) &#123;</span><br><span class="line">           sb.append(stringBuffer);</span><br><span class="line">       &#125;</span><br><span class="line">       return sb.toString();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/11/19/algorithm/%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/19/algorithm/%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/" class="post-title-link" itemprop="url">无重复字符的最长子串</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-19 23:16:48" itemprop="dateCreated datePublished" datetime="2018-11-19T23:16:48+08:00">2018-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:14:06" itemprop="dateModified" datetime="2020-04-12T23:14:06+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="无重复字符的最长子串"><a href="#无重复字符的最长子串" class="headerlink" title="无重复字符的最长子串"></a>无重复字符的最长子串</h1><hr>
<p>文章转载自<a href="https://leetcode-cn.com/articles/longest-substring-without-repeating-characters/" target="_blank" rel="noopener">https://leetcode-cn.com/articles/longest-substring-without-repeating-characters/</a></p>
<p>给定一个字符串，请你找出其中不含有重复字符的 *<em>最长子串 *</em>的长度。</p>
<p><strong>示例 1:</strong></p>
<p><strong>输入:</strong> “abcabcbb”<br><strong>输出:</strong> 3<br><strong>解释:</strong> 因为无重复字符的最长子串是 <code>&quot;abc&quot;，所以其</code>长度为 3。</p>
<p><strong>示例 2:</strong></p>
<p><strong>输入:</strong> “bbbbb”<br><strong>输出:</strong> 1<br><strong>解释:</strong> 因为无重复字符的最长子串是 <code>&quot;b&quot;</code>，所以其长度为 1。</p>
<p><strong>示例 3:</strong></p>
<p><strong>输入:</strong> “pwwkew”<br><strong>输出:</strong> 3<br><strong>解释:</strong> 因为无重复字符的最长子串是 <code>&quot;wke&quot;</code>，所以其长度为 3。<br>     请注意，你的答案必须是 <strong>子串</strong> 的长度，<code>&quot;pwke&quot;</code> 是一个_子序列，_不是子串。</p>
<ul>
<li><a href="#_1">解决方案</a><ul>
<li><a href="#_2">方法一：暴力法</a></li>
<li><a href="#_3">方法二：滑动窗口</a></li>
<li><a href="#_4">方法三：优化的滑动窗口</a></li>
</ul>
</li>
</ul>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><hr>
<h4 id="方法一：暴力法"><a href="#方法一：暴力法" class="headerlink" title="方法一：暴力法"></a>方法一：暴力法</h4><p><strong>思路</strong></p>
<p>逐个检查所有的子字符串，看它是否不含有重复的字符。</p>
<p><strong>算法</strong></p>
<p>假设我们有一个函数 <code>boolean allUnique(String substring)</code> ，如果子字符串中的字符都是唯一的，它会返回true，否则会返回false。 我们可以遍历给定字符串 <code>s</code> 的所有可能的子字符串并调用函数 <code>allUnique</code>。 如果事实证明返回值为true，那么我们将会更新无重复字符子串的最大长度的答案。</p>
<p>现在让我们填补缺少的部分：</p>
<ol>
<li><p>为了枚举给定字符串的所有子字符串，我们需要枚举它们开始和结束的索引。假设开始和结束的索引分别为 iii 和 jjj。那么我们有 0≤i&lt;j≤n0 \leq i \lt j \leq n0≤i&lt;j≤n （这里的结束索引 jjj 是按惯例排除的）。因此，使用 iii 从0到 n−1n - 1n−1 以及 jjj 从 i+1i+1i+1 到 nnn 这两个嵌套的循环，我们可以枚举出 <code>s</code> 的所有子字符串。</p>
</li>
<li><p>要检查一个字符串是否有重复字符，我们可以使用集合。我们遍历字符串中的所有字符，并将它们逐个放入 <code>set</code> 中。在放置一个字符之前，我们检查该集合是否已经包含它。如果包含，我们会返回 <code>false</code>。循环结束后，我们返回 <code>true</code>。</p>
</li>
</ol>
<p><strong>复杂度分析</strong></p>
<ul>
<li><p>时间复杂度：O(n3)O(n^3)O(n3) 。</p>
<p>要验证索引范围在 [i,j)[i, j)[i,j) 内的字符是否都是唯一的，我们需要检查该范围中的所有字符。 因此，它将花费 O(j−i)O(j - i)O(j−i) 的时间。</p>
<p>对于给定的 <code>i</code>，对于所有 j∈[i+1,n]j \in [i+1, n]j∈[i+1,n] 所耗费的时间总和为：</p>
<p>∑i+1nO(j−i) \sum_{i+1}^{n}O(j - i) i+1∑n​O(j−i)</p>
<p>因此，执行所有步骤耗去的时间总和为：</p>
<p>O(∑i=0n−1(∑j=i+1n(j−i)))=O(∑i=0n−1(1+n−i)(n−i)2)=O(n3) O\left(\sum_{i = 0}^{n - 1}\left(\sum_{j = i + 1}^{n}(j - i)\right)\right) = O\left(\sum_{i = 0}^{n - 1}\frac{(1 + n - i)(n - i)}{2}\right) = O(n^3) O(i=0∑n−1​(j=i+1∑n​(j−i)))=O(i=0∑n−1​2(1+n−i)(n−i)​)=O(n3)</p>
</li>
<li><p>空间复杂度：O(min(n,m))O(min(n, m))O(min(n,m))，我们需要 O(k)O(k)O(k) 的空间来检查子字符串中是否有重复字符，其中 kkk 表示 <code>Set</code> 的大小。而 Set 的大小取决于字符串 nnn 的大小以及字符集/字母 mmm 的大小。  </p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.length();</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">                <span class="keyword">if</span> (allUnique(s, i, j)) ans = Math.max(ans, j - i);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">allUnique</span><span class="params">(String s, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; end; i++) &#123;</span><br><span class="line">            Character ch = s.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (set.contains(ch)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            set.add(ch);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方法二：滑动窗口"><a href="#方法二：滑动窗口" class="headerlink" title="方法二：滑动窗口"></a>方法二：滑动窗口</h4><p><strong>算法</strong></p>
<p>暴力法非常简单。但它太慢了。那么我们该如何优化它呢？</p>
<p>在暴力法中，我们会反复检查一个子字符串是否含有有重复的字符，但这是没有必要的。如果从索引 iii 到 j−1j - 1j−1 之间的子字符串 sijs_{ij}sij​ 已经被检查为没有重复字符。我们只需要检查 s[j]s[j]s[j] 对应的字符是否已经存在于子字符串 sijs_{ij}sij​ 中。</p>
<p>要检查一个字符是否已经在子字符串中，我们可以检查整个子字符串，这将产生一个复杂度为 O(n2)O(n^2)O(n2) 的算法，但我们可以做得更好。</p>
<p>通过使用 HashSet 作为滑动窗口，我们可以用 O(1)O(1)O(1) 的时间来完成对字符是否在当前的子字符串中的检查。</p>
<p>滑动窗口是数组/字符串问题中常用的抽象概念。 窗口通常是在数组/字符串中由开始和结束索引定义的一系列元素的集合，即 [i,j)[i, j)[i,j)（左闭，右开）。而滑动窗口是可以将两个边界向某一方向“滑动”的窗口。例如，我们将 [i,j)[i, j)[i,j) 向右滑动 111 个元素，则它将变为 [i+1,j+1)[i+1, j+1)[i+1,j+1)（左闭，右开）。</p>
<p>回到我们的问题，我们使用 HashSet 将字符存储在当前窗口 [i,j)[i, j)[i,j)（最初 j=ij = ij=i）中。 然后我们向右侧滑动索引 jjj，如果它不在 HashSet 中，我们会继续滑动 jjj。直到 s[j] 已经存在于 HashSet 中。此时，我们找到的没有重复字符的最长子字符串将会以索引 iii 开头。如果我们对所有的 iii 这样做，就可以得到答案。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.length();</span><br><span class="line">        Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>, i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; n &amp;&amp; j &lt; n) &#123;</span><br><span class="line">            <span class="comment">// try to extend the range [i, j]</span></span><br><span class="line">            <span class="keyword">if</span> (!set.contains(s.charAt(j)))&#123;</span><br><span class="line">                set.add(s.charAt(j++));</span><br><span class="line">                ans = Math.max(ans, j - i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                set.remove(s.charAt(i++));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>复杂度分析</strong></p>
<ul>
<li><p>时间复杂度：O(2n)=O(n)O(2n) = O(n)O(2n)=O(n)，在最糟糕的情况下，每个字符将被 iii 和 jjj 访问两次。</p>
</li>
<li><p>空间复杂度：O(min(m,n))O(min(m, n))O(min(m,n))，与之前的方法相同。滑动窗口法需要 O(k)O(k)O(k) 的空间，其中 kkk 表示 <code>Set</code> 的大小。而Set的大小取决于字符串 nnn 的大小以及字符集/字母 mmm 的大小。  </p>
</li>
</ul>
<hr>
<h4 id="方法三：优化的滑动窗口"><a href="#方法三：优化的滑动窗口" class="headerlink" title="方法三：优化的滑动窗口"></a>方法三：优化的滑动窗口</h4><p>上述的方法最多需要执行 2n 个步骤。事实上，它可以被进一步优化为仅需要 n 个步骤。我们可以定义字符到索引的映射，而不是使用集合来判断一个字符是否存在。 当我们找到重复的字符时，我们可以立即跳过该窗口。</p>
<p>也就是说，如果 s[j]s[j]s[j] 在 [i,j)[i, j)[i,j) 范围内有与 j′j&#x27;j′ 重复的字符，我们不需要逐渐增加 iii 。 我们可以直接跳过 [i，j′][i，j&#x27;][i，j′] 范围内的所有元素，并将 iii 变为 j′+1j&#x27; + 1j′+1。</p>
<p><strong>Java（使用 HashMap）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.length(), ans = <span class="number">0</span>;</span><br><span class="line">        Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(); <span class="comment">// current index of character</span></span><br><span class="line">        <span class="comment">// try to extend the range [i, j]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, i = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(s.charAt(j))) &#123;</span><br><span class="line">                i = Math.max(map.get(s.charAt(j)), i);</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.max(ans, j - i + <span class="number">1</span>);</span><br><span class="line">            map.put(s.charAt(j), j + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Java（假设字符集为 ASCII 128）</strong></p>
<p>以前的我们都没有对字符串 <code>s</code> 所使用的字符集进行假设。</p>
<p>当我们知道该字符集比较小的时侯，我们可以用一个整数数组作为直接访问表来替换 <code>Map</code>。</p>
<p>常用的表如下所示：</p>
<ul>
<li><code>int [26]</code> 用于字母 ‘a’ - ‘z’或 ‘A’ - ‘Z’</li>
<li><code>int [128]</code> 用于ASCII码</li>
<li><code>int [256]</code> 用于扩展ASCII码</li>
</ul>
<p><strong>复杂度分析</strong></p>
<ul>
<li><p>时间复杂度：O(n)O(n)O(n)，索引 jjj 将会迭代 nnn 次。</p>
</li>
<li><p>空间复杂度（HashMap）：O(min(m,n))O(min(m, n))O(min(m,n))，与之前的方法相同。</p>
</li>
<li><p>空间复杂度（Table）：O(m)O(m)O(m)，mmm 是字符集的大小。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.length(), ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] index = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">128</span>]; <span class="comment">// current index of character</span></span><br><span class="line">        <span class="comment">// try to extend the range [i, j]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, i = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            i = Math.max(index[s.charAt(j)], i);</span><br><span class="line">            ans = Math.max(ans, j - i + <span class="number">1</span>);</span><br><span class="line">            index[s.charAt(j)] = j + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/11/14/algorithm/%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/14/algorithm/%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86/" class="post-title-link" itemprop="url">两个数组的交集</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-14 23:55:48" itemprop="dateCreated datePublished" datetime="2018-11-14T23:55:48+08:00">2018-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:08:16" itemprop="dateModified" datetime="2020-04-12T23:08:16+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="两个数组的交集"><a href="#两个数组的交集" class="headerlink" title="两个数组的交集"></a><a href="https://leetcode-cn.com/problems/intersection-of-two-arrays/" target="_blank" rel="noopener">两个数组的交集</a></h3><p>难度 <strong>简单</strong></p>
<p>给定两个数组，编写一个函数来计算它们的交集。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**输入:** nums1 &#x3D; [1,2,2,1], nums2 &#x3D; [2,2]</span><br><span class="line">**输出:** [2]</span><br></pre></td></tr></table></figure>

<p><strong>示例 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**输入:** nums1 &#x3D; [4,9,5], nums2 &#x3D; [9,4,9,8,4]</span><br><span class="line">**输出:** [9,4]</span><br></pre></td></tr></table></figure>

<p><strong>说明:</strong></p>
<ul>
<li>输出结果中的每个元素一定是唯一的。</li>
<li>我们可以不考虑输出结果的顺序。</li>
</ul>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p><strong>解题思路</strong><br>计算数组间的交集，最简单的方式肯定是使用<code>Set</code>集合来做。我们将num1数组的数据添加到一个<code>Set</code>集合<code>set</code>中，然后遍历num2数据，只要num2数组有与<code>set</code>相同的数，就认为这个是相同的数，添加到另外一个<code>Set</code>集合<code>res</code>中，最终，<code>res</code>中所有的数据就是我们要返回的数据，将其转化成数组返回即可。</p>
<p>Language: <strong>Java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intersection(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">         <span class="keyword">if</span> (nums1 == <span class="keyword">null</span> || nums1.length ==<span class="number">0</span> || nums2 == <span class="keyword">null</span> || nums2.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        Set&lt;Integer&gt; res = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums1.length; i++) &#123;</span><br><span class="line">            set.add(nums1[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums2.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (set.contains(nums2[i]))&#123;</span><br><span class="line">                res.add(nums2[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> num[] = <span class="keyword">new</span> <span class="keyword">int</span>[res.size()];</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Iterator it = res.iterator(); it.hasNext();)&#123;</span><br><span class="line">            num[i++] = (<span class="keyword">int</span>) it.next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/11/13/algorithm/Nim%E6%B8%B8%E6%88%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/13/algorithm/Nim%E6%B8%B8%E6%88%8F/" class="post-title-link" itemprop="url">Nim游戏</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-13 23:44:55" itemprop="dateCreated datePublished" datetime="2018-11-13T23:44:55+08:00">2018-11-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 23:04:33" itemprop="dateModified" datetime="2020-04-12T23:04:33+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Nim游戏"><a href="#Nim游戏" class="headerlink" title="Nim游戏"></a><a href="https://leetcode-cn.com/problems/nim-game/" target="_blank" rel="noopener">Nim游戏</a></h3><p>难度 <strong>简单</strong></p>
<p>你和你的朋友，两个人一起玩 ：桌子上有一堆石头，每次你们轮流拿掉 1 - 3 块石头。 拿掉最后一块石头的人就是获胜者。你作为先手。</p>
<p>你们是聪明人，每一步都是最优解。 编写一个函数，来判断你是否可以在给定石头数量的情况下赢得游戏。</p>
<p><strong>示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">**输入:** &#96;4&#96;</span><br><span class="line">**输出:** false </span><br><span class="line">**解释:** 如果堆中有 4 块石头，那么你永远不会赢得比赛；</span><br><span class="line">     因为无论你拿走 1 块、2 块 还是 3 块石头，最后一块石头总是会被你的朋友拿走。</span><br></pre></td></tr></table></figure>

<h3 id="结题思路"><a href="#结题思路" class="headerlink" title="结题思路"></a>结题思路</h3><p>简单的罗列一下1-12个石子的情况，发现只有4的倍数才是false。</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>Language: <strong>Java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canWinNim</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> n%<span class="number">4</span>!=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://reoger.tk/2018/11/12/other/%E9%9A%8F%E4%BE%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="reoger">
      <meta itemprop="description" content="reoger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="reoger的记录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/12/other/%E9%9A%8F%E4%BE%BF/" class="post-title-link" itemprop="url">方式论</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-12 23:52:48" itemprop="dateCreated datePublished" datetime="2018-11-12T23:52:48+08:00">2018-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:40:57" itemprop="dateModified" datetime="2020-07-18T14:40:57+08:00">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%B9%E6%B3%95%E8%AE%BA/" itemprop="url" rel="index"><span itemprop="name">方法论</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="解bug思路"><a href="#解bug思路" class="headerlink" title="解bug思路"></a>解bug思路</h1><ol>
<li>了解主流程，把握主要逻辑</li>
<li>按照现有流程思路，一步一步排查问题</li>
<li>主要主要问题，结合其实现，寻求解决方案</li>
<li>思考为什么会出现这种问题，思考如何避免再次出现这种问题。</li>
</ol>
<p><strong>注意</strong> 排查bug最关键的地方可能就是，找不到bug的关键点在哪，这个时候要注意的是，我们可以先按照自己的思路去寻找其实现，当发现我们的思路和程序实现的思路不同时，我们不能再按照我们的思路，而是应该及时修正，按照程序的实现思路去走。并思考要这样实现，与我们设想的思路有什么差别，我们设想的思路可能会有哪些问题。</p>
<p>总的方法论：<br>目标、方法、资源、路径。</p>
<ol>
<li>我们需要指定好合适的目标；指定的目标不能过高，即使自己再怎么努力也达不到要求，目标也不能过低，导致自己不需要努力也能达到。还有目标一定要<strong>量化</strong>，一定要<strong>细化</strong>，一定要<strong>可评估话</strong>。<br>例如，我的下一个目标是xx需求在一天内完成，这样的目标就比较适合，但是如果我的目标是开发能力提高10%，其实这样的目标就不是很好评估到底有没有完成。</li>
<li>在指定好合适的目标之后，我们需要通过合适的方法，适当的渠道去实现他。譬如<code>xx需求在一天内完成</code>这个目标的实现，我们就需要先分析当前这个需求，并确保自己的理解和要求是一致的，然后选择技术方案，最后开始实现，而不是一昧的上手就是干，一昧的上手就是干反而很难如愿按时完成。</li>
<li>大部分情况下，我们的目标仅仅靠我们自己本身的努力是不能完成的，这个时候我们就应该主动寻找合适的资源去协助我们完成目标。还是以<code>xx需求在一天内完成</code>这个目标为例，我们可能需要UI资源、或者服务端资源，或者其他的资源，这个时候我们就应该需要主动的去寻找这些资源，为自己的目标铺路。</li>
<li>当有了方法和资源之后，我们就只需要寻找一条通向目标的路径了。当然，这个寻找的过程可能需要经验的积累，但是相信，在成长的路上，我们一定会找到适合自己通向目标的路径的。</li>
</ol>
<p>方法论：<strong>先钻深度、后拓广度</strong>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">reoger</p>
  <div class="site-description" itemprop="description">reoger</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/reoger" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;reoger" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:reoger112@gmail.com" title="E-Mail → mailto:reoger112@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">reoger</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
